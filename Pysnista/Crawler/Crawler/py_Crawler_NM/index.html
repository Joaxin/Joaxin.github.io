<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Python Web Crawler - Netease Music Comments | Pinsflora</title><meta name="description" content="I"><meta name="keywords" content="Crypto"><meta name="author" content="Joaxin"><meta name="copyright" content="Joaxin"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="shortcut icon" href="/img/favicon.ico"><link rel="canonical" href="https://u.pinsflora.com/Pysnista/Crawler/Crawler/py_Crawler_NM/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//www.google-analytics.com" crossorigin="crossorigin"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta property="og:type" content="article"><meta property="og:title" content="Python Web Crawler - Netease Music Comments"><meta property="og:url" content="https://u.pinsflora.com/Pysnista/Crawler/Crawler/py_Crawler_NM/"><meta property="og:site_name" content="Pinsflora"><meta property="og:description" content="I"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/joaxin/img_bed/img/cover/cover_grass_in_the_snow.jpg"><meta property="article:published_time" content="2018-03-14T16:00:00.000Z"><meta property="article:modified_time" content="2018-03-14T16:00:00.000Z"><meta name="twitter:card" content="summary"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css"><script async="async" src="https://www.googletagmanager.com/gtag/js?id=UA-177831205-1"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-177831205-1');
</script><script>var GLOBAL_CONFIG = { 
  root: '/',
  hexoversion: '5.1.1',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"We didn't find any results for the search: ${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: {"limitDay":500,"position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  bookmark: {
    message_prev: 'Press',
    message_next: 'to bookmark this page'
  },
  runtime: 'days',
  date_suffix: {"one_hour":"Just","hours":"hours ago","day":"days ago"},
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: {"bookmark":{"message_prev":"Press","message_next":"to bookmark this page"},"chs_to_cht":"Traditional Chinese Activated Manually","cht_to_chs":"Simplified Chinese Activated Manually","day_to_night":"Dark Mode Activated Manually","night_to_day":"Light Mode Activated Manually","bgLight":"#49b1f5","bgDark":"#2d3035","position":"bottom-left"},
  justifiedGallery: {
    js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
    css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
  },
  baiduPush: false,
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
};

var saveToLocal = {
  set: function setWithExpiry(key, value, ttl) {
    const now = new Date()
    const expiryDay = ttl * 86400000
    const item = {
      value: value,
      expiry: now.getTime() + expiryDay,
    }
    localStorage.setItem(key, JSON.stringify(item))
    },

  get: function getWithExpiry(key) {
    const itemStr = localStorage.getItem(key)

    if (!itemStr) {
      return undefined
    }
    const item = JSON.parse(itemStr)
    const now = new Date()

    if (now.getTime() > item.expiry) {
      localStorage.removeItem(key)
      return undefined
    }
    return item.value
  }
}</script><script id="config_change">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isSidebar: true,
  postUpdate: '2018-03-15 00:00:00'
}</script><noscript><style type="text/css">
#nav {
  opacity: 1
}
.justified-gallery img {
  opacity: 1
}
</style></noscript><script>var activateDarkMode = function () {
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null) {
    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
  }
}
var activateLightMode = function () {
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null) {
    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
  }
}

var autoChangeMode = 'false'
var t = saveToLocal.get('theme')
if (autoChangeMode === '1') {
  var isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
  var isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
  var isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined) {
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport) {
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour <= 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
    }
    window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
      if (saveToLocal.get('theme') === undefined) {
        e.matches ? activateDarkMode() : activateLightMode()
      }
    })
  } else if (t === 'light') activateLightMode()
  else activateDarkMode()
} else if (autoChangeMode === '2') {
  now = new Date()
  hour = now.getHours()
  isNight = hour <= 6 || hour >= 18
  if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode()
} else {
  if (t === 'dark') activateDarkMode()
  else if (t === 'light') activateLightMode()
}</script><meta name="generator" content="Hexo 5.1.1"><link rel="alternate" href="/atom.xml" title="Pinsflora" type="application/atom+xml">
</head><body><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="https://avatars2.githubusercontent.com/u/8346164?s=460&amp;v=4" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">Articles</div><div class="length_num">273</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">Tags</div><div class="length_num">99</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">Categories</div><div class="length_num">34</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fa fa-list"></i><span> List</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/gallery/"><i class="fa-fw fa fa-file-image-o"></i><span> Galleries</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fas fa-film"></i><span> Movie</span></a></li><li><a class="site-page" href="/games/"><i class="fa-fw fas fa-gamepad"></i><span> Games</span></a></li><li><a class="site-page" href="/tools/"><i class="fa-fw fas fa-wrench"></i><span> Tools</span></a></li></ul></div></div></div></div><div id="body-wrap"><div id="web_bg" data-type="photo"></div><div id="sidebar"><i class="fas fa-arrow-right on" id="toggle-sidebar"></i><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#stand-library"><span class="toc-number">1.</span> <span class="toc-text"> Stand Library</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#hashing"><span class="toc-number">1.1.</span> <span class="toc-text"> Hashing</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#key-derivation"><span class="toc-number">1.2.</span> <span class="toc-text"> Key Derivation</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pycryptodome"><span class="toc-number">2.</span> <span class="toc-text"> PyCryptodome</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#install"><span class="toc-number">2.1.</span> <span class="toc-text"> Install</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#desdata-encryption-standard"><span class="toc-number">2.2.</span> <span class="toc-text"> DES(Data Encryption Standard)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#aesadvanced-encryption-standard"><span class="toc-number">2.3.</span> <span class="toc-text"> AES(Advanced Encryption Standard)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#rsa"><span class="toc-number">2.4.</span> <span class="toc-text"> RSA</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#encrypting-a-file"><span class="toc-number">2.5.</span> <span class="toc-text"> Encrypting a File</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#decrypt-data"><span class="toc-number">2.6.</span> <span class="toc-text"> Decrypt data</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#cryptography"><span class="toc-number">3.</span> <span class="toc-text"> Cryptography</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#parse-netease-music"><span class="toc-number">4.</span> <span class="toc-text"> Parse Netease Music</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#code"><span class="toc-number">4.1.</span> <span class="toc-text"> Code</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#references"><span class="toc-number">5.</span> <span class="toc-text"> REFERENCES</span></a></li></ol></div></div></div><header class="post-bg" id="page-header" style="background-image: url(https://cdn.jsdelivr.net/gh/joaxin/img_bed/img/cover/cover_grass_in_the_snow.jpg)"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Pinsflora</a></span><span id="menus"><div id="search_button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> Search</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fa fa-list"></i><span> List</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/gallery/"><i class="fa-fw fa fa-file-image-o"></i><span> Galleries</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fas fa-film"></i><span> Movie</span></a></li><li><a class="site-page" href="/games/"><i class="fa-fw fas fa-gamepad"></i><span> Games</span></a></li><li><a class="site-page" href="/tools/"><i class="fa-fw fas fa-wrench"></i><span> Tools</span></a></li></ul></div></div><span class="close" id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></span></span></nav><div id="post-info"><div id="post-title"><div class="posttitle">Python Web Crawler - Netease Music Comments</div></div><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2018-03-14T16:00:00.000Z" title="Created 2018-03-15 00:00:00">2018-03-15</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2018-03-14T16:00:00.000Z" title="Updated 2018-03-15 00:00:00">2018-03-15</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Python/">Python</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Python/Crawler/">Crawler</a></span></div><div class="meta-secondline"> <span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">Word count:</span><span class="word-count">1.7k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">Reading time:</span><span>10min</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post View:</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-separator">|</span><span class="post-meta-commentcount"></span></div></div></div></header><main class="layout_post" id="content-inner"><article id="post"><div class="post-content" id="article-container"><h2 id="stand-library"><a class="markdownIt-Anchor" href="#stand-library"></a> Stand Library</h2>
<h3 id="hashing"><a class="markdownIt-Anchor" href="#hashing"></a> Hashing</h3>
<p>Python’s standard library has you covered in the hashlib module. It includes the FIPS secure hash algorithms SHA1, SHA224, SHA256, SHA384, and SHA512 as well as RSA’s MD5 algorithm.</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line">md5 = hashlib.md5()</span><br><span class="line"><span class="comment"># md5.update('I Love Python')</span></span><br><span class="line"><span class="comment"># Unicode-objects must be encoded before hashing</span></span><br><span class="line">md5.update(<span class="string">b'I Love Python'</span>)</span><br><span class="line">md5.digest()</span><br><span class="line">hashlib.sha256(<span class="string">b'I Love Python'</span>).hexdigest()</span><br></pre></td></tr></tbody></table></figure>
<pre><code>b'K\xf2\xe0+\nV\xf6\x95\xb1\xd1d`\x85v\x9aJ'
'28ea18a0df1c8dbec5850c9164da84d27522189bc832703ab39d757d96fb0333'
</code></pre>
<h3 id="key-derivation"><a class="markdownIt-Anchor" href="#key-derivation"></a> Key Derivation</h3>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line">dk = hashlib.pbkdf2_hmac(hash_name=<span class="string">'sha256'</span>,</span><br><span class="line">    password=<span class="string">b'password'</span>, </span><br><span class="line">    salt=<span class="string">b'salt'</span>, </span><br><span class="line">    iterations=<span class="number">100000</span>)</span><br><span class="line">binascii.hexlify(dk)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>b'0394a2ede332c9a13eb82e9b24631604c31df978b4e2f0fbd2c549944f9d79a5'
</code></pre>
<h2 id="pycryptodome"><a class="markdownIt-Anchor" href="#pycryptodome"></a> PyCryptodome</h2>
<h3 id="install"><a class="markdownIt-Anchor" href="#install"></a> Install</h3>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pip3 install pycryptodome     --index-url http://mirrors.aliyun.com/pypi/simple/ --trusted-host mirrors.aliyun.com <span class="comment"># linux</span></span><br><span class="line">pip3 install pycryptodomex     --index-url http://mirrors.aliyun.com/pypi/simple/ --trusted-host mirrors.aliyun.com <span class="comment"># win</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="desdata-encryption-standard"><a class="markdownIt-Anchor" href="#desdata-encryption-standard"></a> DES(Data Encryption Standard)</h3>
<p>key :  it’s 8 bytes<br>
Pad function:  pad any string out with spaces until it’s a multiple of 8</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Cryptodome.Cipher <span class="keyword">import</span> DES</span><br><span class="line"></span><br><span class="line">key = <span class="string">b'abcdefgh'</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">pad</span>(<span class="params">text</span>):</span></span><br><span class="line">    text = text.decode()</span><br><span class="line">    <span class="keyword">while</span> len(text) % <span class="number">8</span> != <span class="number">0</span>:</span><br><span class="line">        text+= <span class="string">' '</span></span><br><span class="line">    <span class="keyword">return</span> bytes(text,<span class="string">'utf-8'</span>)</span><br><span class="line"></span><br><span class="line">des = DES.new(key, DES.MODE_ECB)</span><br><span class="line">text = <span class="string">b'I Love Python'</span></span><br><span class="line"><span class="comment"># encrypted_text = des.encrypt(text)</span></span><br><span class="line"><span class="comment"># Data must be aligned to block boundary in ECB mode</span></span><br><span class="line">padded_text = pad(text)</span><br><span class="line"><span class="comment"># b'I Love Python   '</span></span><br><span class="line">encrypted_text = des.encrypt(padded_text)</span><br><span class="line">encrypted_text</span><br><span class="line">des.decrypt(encrypted_text)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>b'y\x9aM\xac\x17Y\x8f\xfc^\xa5p\x14Lq\xb6\x0e'
b'I Love Python   '
</code></pre>
<h3 id="aesadvanced-encryption-standard"><a class="markdownIt-Anchor" href="#aesadvanced-encryption-standard"></a> AES(Advanced Encryption Standard)</h3>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Cryptodome.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> Cryptodome.Util.Padding <span class="keyword">import</span> pad</span><br><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> b64encode, b64decode</span><br><span class="line"></span><br><span class="line">key = <span class="string">'/I02fMuSSvnouuu+/vyyD7NuSEVDB/0gte/z50dM0b4='</span></span><br><span class="line">data = <span class="string">'hello world!'</span></span><br><span class="line"></span><br><span class="line">cipher = AES.new(b64decode(key), AES.MODE_CBC, iv=<span class="string">b'0123456789abcdef'</span>)</span><br><span class="line">padded_data = pad(data.encode(), cipher.block_size)</span><br><span class="line">print(padded_data)</span><br><span class="line"><span class="comment"># b'hello world!\x04\x04\x04\x04'</span></span><br><span class="line">print(b64encode(padded_data))</span><br><span class="line"><span class="comment"># b'aGVsbG8gd29ybGQhBAQEBA=='</span></span><br><span class="line">ciphertext = cipher.encrypt(padded_data)</span><br><span class="line">print(ciphertext)</span><br><span class="line"><span class="comment"># b'\xf0m\n/e"\n\xfe\xd4\xa3\xeaJ2oF\xf8'</span></span><br><span class="line">print(b64encode(ciphertext))</span><br><span class="line"><span class="comment"># b'8G0KL2UiCv7Uo+pKMm9G+A=='</span></span><br><span class="line">ciphertext = cipher.encrypt(padded_data)</span><br><span class="line">print(b64encode(ciphertext))</span><br><span class="line"><span class="comment"># b'tBXcf/Nf6MtxM1ulzNnIlw=='</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">cipher = AES.new(b64decode(key), AES.MODE_CBC, iv=<span class="string">b'0123456789abcdef'</span>)</span><br><span class="line">padded_data = pad(data.encode(), cipher.block_size)</span><br><span class="line">ciphertext = cipher.encrypt(padded_data)</span><br><span class="line">print(b64encode(ciphertext))</span><br><span class="line"><span class="comment"># b'8G0KL2UiCv7Uo+pKMm9G+A=='</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="rsa"><a class="markdownIt-Anchor" href="#rsa"></a> RSA</h3>
<p>If you want to encrypt your data with RSA, then you’ll need to either have access to a public / private RSA key pair or you will need to generate your own.<br>
Ok Let’s we will just generate our own.</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Cryptodome.PublicKey <span class="keyword">import</span> RSA</span><br><span class="line">code = <span class="string">'nobodyknows'</span></span><br><span class="line">key = RSA.generate(<span class="number">2048</span>) <span class="comment"># an RSA key of 2048 bits</span></span><br><span class="line">encrypted_key = key.exportKey(passphrase=code, pkcs=<span class="number">8</span>, </span><br><span class="line">        protection=<span class="string">"scryptAndAES128-CBC"</span>)</span><br><span class="line"><span class="comment">#  private key.</span></span><br><span class="line"><span class="comment"># which PKCS standard to use and which encryption scheme to use</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'my_private_rsa_key.bin'</span>, <span class="string">'wb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(encrypted_key)</span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'my_rsa_public.pem'</span>, <span class="string">'wb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(key.publickey().exportKey())</span><br></pre></td></tr></tbody></table></figure>
<pre><code>1865
450
</code></pre>
<h3 id="encrypting-a-file"><a class="markdownIt-Anchor" href="#encrypting-a-file"></a> Encrypting a File</h3>
<p>For this example we are going to be using a hybrid encryption method, so we use PKCS1 OAEP, which is Optimal asymmetric encryption padding. This allows us to write a data of an arbitrary length to the file. Then we create our AES cipher, create some data and encrypt the data. This will return the encrypted text and the MAC. Finally we write out the nonce, MAC (or tag) and the encrypted text.</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Cryptodome.PublicKey <span class="keyword">import</span> RSA</span><br><span class="line"><span class="keyword">from</span> Cryptodome.Random <span class="keyword">import</span> get_random_bytes</span><br><span class="line"><span class="keyword">from</span> Cryptodome.Cipher <span class="keyword">import</span> AES, PKCS1_OAEP</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'encrypted_data.bin'</span>, <span class="string">'wb'</span>) <span class="keyword">as</span> out_file:</span><br><span class="line">    recipient_key = RSA.import_key(open(<span class="string">'my_rsa_public.pem'</span>).read())</span><br><span class="line">    session_key = get_random_bytes(<span class="number">16</span>)</span><br><span class="line"></span><br><span class="line">    cipher_rsa = PKCS1_OAEP.new(recipient_key)</span><br><span class="line">    out_file.write(cipher_rsa.encrypt(session_key))</span><br><span class="line"></span><br><span class="line">    cipher_aes = AES.new(session_key, AES.MODE_EAX)</span><br><span class="line">    data = <span class="string">b'blah blah blah Python blah blah'</span></span><br><span class="line">    ciphertext, tag = cipher_aes.encrypt_and_digest(data)</span><br><span class="line"></span><br><span class="line">    out_file.write(cipher_aes.nonce)</span><br><span class="line">    out_file.write(tag)</span><br><span class="line">    out_file.write(ciphertext)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>256
16
16
31
</code></pre>
<h3 id="decrypt-data"><a class="markdownIt-Anchor" href="#decrypt-data"></a> Decrypt data</h3>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Cryptodome.PublicKey <span class="keyword">import</span> RSA</span><br><span class="line"><span class="keyword">from</span> Cryptodome.Cipher <span class="keyword">import</span> AES, PKCS1_OAEP</span><br><span class="line"></span><br><span class="line">code = <span class="string">'nobodyknows'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'encrypted_data.bin'</span>, <span class="string">'rb'</span>) <span class="keyword">as</span> fobj:</span><br><span class="line">    private_key = RSA.import_key(</span><br><span class="line">        open(<span class="string">'my_private_rsa_key.bin'</span>).read(),</span><br><span class="line">        passphrase=code)</span><br><span class="line"></span><br><span class="line">    enc_session_key, nonce, tag, ciphertext = [ fobj.read(x) </span><br><span class="line">                                                <span class="keyword">for</span> x <span class="keyword">in</span> (private_key.size_in_bytes(), </span><br><span class="line">                                                <span class="number">16</span>, <span class="number">16</span>, <span class="number">-1</span>) ]</span><br><span class="line"></span><br><span class="line">    cipher_rsa = PKCS1_OAEP.new(private_key)</span><br><span class="line">    session_key = cipher_rsa.decrypt(enc_session_key)</span><br><span class="line"></span><br><span class="line">    cipher_aes = AES.new(session_key, AES.MODE_EAX, nonce)</span><br><span class="line">    data = cipher_aes.decrypt_and_verify(ciphertext, tag)</span><br><span class="line"></span><br><span class="line">print(data)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>b'blah blah blah Python blah blah'
</code></pre>
<h2 id="cryptography"><a class="markdownIt-Anchor" href="#cryptography"></a> Cryptography</h2>
<p>The cryptography package aims to be “cryptography for humans” much like the requests library is “HTTP for Humans”.</p>
<p>The Fernet module implements an easy-to-use authentication scheme that uses a symmetric encryption algorithm which guarantees that any message you encrypt with it cannot be manipulated or read without the key you define. The Fernet module also supports key rotation via MultiFernet.</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> cryptography.fernet <span class="keyword">import</span> Fernet</span><br><span class="line">cipher_key = Fernet.generate_key()</span><br><span class="line">cipher_key</span><br><span class="line">cipher = Fernet(cipher_key)</span><br><span class="line">text = <span class="string">b'My super secret message'</span></span><br><span class="line">encrypted_text = cipher.encrypt(text)</span><br><span class="line">encrypted_text</span><br><span class="line">decrypted_text = cipher.decrypt(encrypted_text)</span><br><span class="line">decrypted_text</span><br></pre></td></tr></tbody></table></figure>
<pre><code>b'IIW_KsInMPbTR60cyxD8nza5RKv_noP_3_bUeoyrqYY='
b'gAAAAABaq148thkx3uK066S-J59eUdIG8UptOUnKAYVvHGpjjszje5WYX64lICXjgHRbalqFs8RU9V_ovABgO4U-9py6qDwHMAp5Qx4SjyIePb-IFZ0I0y8='
b'My super secret message'
</code></pre>
<h2 id="parse-netease-music"><a class="markdownIt-Anchor" href="#parse-netease-music"></a> Parse Netease Music</h2>
<p>We want to download comments from this url,but the data was encrypted with some methods, then we want to find the the cipher out<br>
URL : <a target="_blank" rel="noopener" href="http://music.163.com/#/song?id=36990266">http://music.163.com/#/song?id=36990266</a></p>
<p>First Download Core.js and Simulate the requests using fiddler</p>
<p><img src="https://cdn.jsdelivr.net/gh/joaxin/img_bed/img/py/crawler/nm/wy001.PNG" alt="wyy001"></p>
<p><img src="https://cdn.jsdelivr.net/gh/joaxin/img_bed/img/py/crawler/nm/wy002.PNG" alt="wyy002"></p>
<p><img src="https://cdn.jsdelivr.net/gh/joaxin/img_bed/img/py/crawler/nm/wy003.PNG" alt="wyy003"></p>
<p><img src="https://cdn.jsdelivr.net/gh/joaxin/img_bed/img/py/crawler/nm/wy004.PNG" alt="wyy004"></p>
<p>GOT:</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">var bBU3x = window.asrsea(</span><br><span class="line">JSON.stringify(j7c), </span><br><span class="line">bsL0x([<span class="string">"流泪"</span>, <span class="string">"强"</span>]), </span><br><span class="line">bsL0x(TY1x.md), </span><br><span class="line">bsL0x([<span class="string">"爱心"</span>, <span class="string">"女孩"</span>, <span class="string">"惊恐"</span>, <span class="string">"大笑"</span>]));</span><br><span class="line">e7d.data = k7d.cC8u({ params: bBU3x.encText, encSecKey: bBU3x.encSecKey })</span><br><span class="line">}</span><br><span class="line">czW5b(Y7R, e7d)</span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure>
<ul>
<li>j7c : { rid: “R_SO_4_36990266”, offset: “0”, total: “true”, limit: “20”, csrf_token: “” }</li>
<li>bsL0x([“流泪”, “强”]) : 010001</li>
<li>bsL0x(<a target="_blank" rel="noopener" href="http://TY1x.md">TY1x.md</a>) : 00e0b509f6259df8642dbc35662901477df22677ec152b5ff68ace615bb7b725152b3ab17a876aea8a5aa76d2e417629ec4ee341f56135fccf695280104e0312ecbda92557c93870114af6c9d05c4f7f0c3685b7a46bee255932575cce10b424d813cfe4875d3e82047b97ddef52741d546b8e289dc6935b3ece0462db0a22b8e7</li>
<li>bsL0x([“爱心”, “女孩”, “惊恐”, “大笑”])) : 0CoJUm6Qyw8W8jud</li>
</ul>
<h3 id="code"><a class="markdownIt-Anchor" href="#code"></a> Code</h3>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> psycopg2</span><br><span class="line"></span><br><span class="line">conn = psycopg2.connect(database=<span class="string">"demo"</span>, user=<span class="string">"lysql"</span>, password=<span class="string">"123456"</span>, host=<span class="string">"127.0.0.1"</span>, port=<span class="string">"5432"</span>)</span><br><span class="line"><span class="keyword">try</span>:  </span><br><span class="line">    cursor = conn.cursor()</span><br><span class="line">    transaction = cursor.execute(<span class="string">"""CREATE TABLE MUSIC(</span></span><br><span class="line"><span class="string">    ID  SERIAL PRIMARY KEY NOT NULL,</span></span><br><span class="line"><span class="string">    TIME  BIGINT NOT NULL,</span></span><br><span class="line"><span class="string">    CONTENT    TEXT NOT NULL,</span></span><br><span class="line"><span class="string">    LIKEDCOUNT    INT NOT NULL,</span></span><br><span class="line"><span class="string">    NICKNAME   TEXT NOT NULL,</span></span><br><span class="line"><span class="string">    USERID    BIGINT NOT NULL,</span></span><br><span class="line"><span class="string">    AVATARURL    TEXT NOT NULL,</span></span><br><span class="line"><span class="string">    AVATARPATH TEXT NOT NULL);</span></span><br><span class="line"><span class="string">       """</span>)</span><br><span class="line">    print(<span class="string">'Successful'</span>)</span><br><span class="line">    conn.commit()</span><br><span class="line"><span class="keyword">except</span> (Exception, psycopg2.DatabaseError) <span class="keyword">as</span> error:</span><br><span class="line">        print(error)</span><br><span class="line"><span class="keyword">finally</span>:</span><br><span class="line">        print(conn)</span><br><span class="line">        <span class="keyword">if</span> conn <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            conn.close()</span><br></pre></td></tr></tbody></table></figure>
<pre><code>Successful
&lt;connection object at 0x0523B6B8; dsn: 'user=lysql password=xxx dbname=demo host=127.0.0.1 port=5432', closed: 0&gt;
</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">save_music</span>(<span class="params">data</span>):</span></span><br><span class="line">    conn = psycopg2.connect(database=<span class="string">"demo"</span>, user=<span class="string">"lysql"</span>, password=<span class="string">"123456"</span>, host=<span class="string">"127.0.0.1"</span>, port=<span class="string">"5432"</span>)</span><br><span class="line">    table = <span class="string">"music"</span></span><br><span class="line">    keys = <span class="string">', '</span>.join(data.keys())</span><br><span class="line">    values = <span class="string">', '</span>.join([<span class="string">'%s'</span>] * len(data))</span><br><span class="line">    sql = <span class="string">'INSERT INTO {table}({keys}) VALUES ({values})'</span>.format(table=table, keys=keys, values=values)</span><br><span class="line">    <span class="keyword">try</span>:  </span><br><span class="line">        cursor = conn.cursor()</span><br><span class="line">        cursor.execute(sql, tuple(data.values()));</span><br><span class="line">        conn.commit()</span><br><span class="line">        <span class="keyword">print</span> (<span class="string">"Records created successfully"</span>);</span><br><span class="line">    <span class="keyword">except</span> (Exception, psycopg2.DatabaseError) <span class="keyword">as</span> error:</span><br><span class="line">            print(error)</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">            <span class="keyword">if</span> conn <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">                conn.close()</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Cryptodome.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> Cryptodome <span class="keyword">import</span> Random</span><br><span class="line"><span class="keyword">from</span> Cryptodome.Util.Padding <span class="keyword">import</span> pad</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> b64encode</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> requests <span class="keyword">import</span> RequestException</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> codecs</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">headers = {</span><br><span class="line"><span class="string">"Accept"</span>:<span class="string">"*/*"</span>,</span><br><span class="line"><span class="string">"Accept-Encoding"</span>:<span class="string">"gzip, deflate"</span>,</span><br><span class="line"><span class="string">"Accept-Language"</span>:<span class="string">"zh-CN,zh;q=0.9,en;q=0.8"</span>,</span><br><span class="line"><span class="string">"Connection"</span>:<span class="string">"keep-alive"</span>,</span><br><span class="line"><span class="string">"Content-Type"</span>:<span class="string">"application/x-www-form-urlencoded"</span>,</span><br><span class="line"><span class="string">"Host"</span>:<span class="string">"music.163.com"</span>,</span><br><span class="line"><span class="string">"Origin"</span>:<span class="string">"http://music.163.com"</span>,</span><br><span class="line"><span class="string">"Referer"</span>:<span class="string">"http://music.163.com/"</span>,</span><br><span class="line"><span class="string">"User-Agent"</span>:<span class="string">"Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/63.0.3239.132 Safari/537.36"</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">comment = {</span><br><span class="line">    <span class="string">"rid"</span>: <span class="string">"R_SO_4_36990266"</span>, </span><br><span class="line">    <span class="string">"offset"</span>: <span class="string">"0"</span>,</span><br><span class="line">    <span class="string">"total"</span>:<span class="string">"true"</span>,</span><br><span class="line">    <span class="string">"limit"</span>: <span class="string">"20"</span>,</span><br><span class="line">    <span class="string">"csrf_token"</span>:<span class="string">""</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">modulus = <span class="string">'00e0b509f6259df8642dbc35662901477df22677ec152b5ff68ace615bb7b725152b3ab17a876aea8a5aa76d2e417629ec4ee341f56135fccf695280104e0312ecbda92557c93870114af6c9d05c4f7f0c3685b7a46bee255932575cce10b424d813cfe4875d3e82047b97ddef52741d546b8e289dc6935b3ece0462db0a22b8e7'</span></span><br><span class="line">nonce = <span class="string">'0CoJUm6Qyw8W8jud'</span></span><br><span class="line">pubKey = <span class="string">'010001'</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">AES_encrypt</span>(<span class="params">text, key, iv</span>):</span></span><br><span class="line">    key = bytes(key,<span class="string">"utf-8"</span>)</span><br><span class="line">    text = bytes(text,<span class="string">"utf-8"</span>)</span><br><span class="line">    cipher = AES.new(key, AES.MODE_CBC, iv)</span><br><span class="line">    padded_data = pad(text, cipher.block_size)</span><br><span class="line">    ciphertext = cipher.encrypt(padded_data)</span><br><span class="line">    <span class="keyword">return</span> b64encode(ciphertext)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">RSA_encrypt</span>(<span class="params">text, pubKey, modulus</span>):</span></span><br><span class="line">    text = text[::<span class="number">-1</span>]</span><br><span class="line">    rs = int(codecs.encode(bytes(text,<span class="string">"utf-8"</span>), <span class="string">'hex'</span>),<span class="number">16</span>)** int(pubKey, <span class="number">16</span>) % int(modulus, <span class="number">16</span>)</span><br><span class="line">    <span class="keyword">return</span> format(rs, <span class="string">'x'</span>).zfill(<span class="number">256</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_params</span>():</span></span><br><span class="line">    iv = <span class="string">b'0102030405060708'</span></span><br><span class="line">    text = str(comment)</span><br><span class="line">    encText1= AES_encrypt(text,nonce, iv)</span><br><span class="line">    encText2 = AES_encrypt(encText1.decode(),<span class="number">16</span> * <span class="string">'F'</span>, iv)</span><br><span class="line">    encSecKey = RSA_encrypt(<span class="number">16</span> * <span class="string">'F'</span>, pubKey, modulus)</span><br><span class="line">    data = {</span><br><span class="line">        <span class="string">'params'</span>: encText2.decode(),</span><br><span class="line">        <span class="string">'encSecKey'</span>: encSecKey</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line">get_params()</span><br></pre></td></tr></tbody></table></figure>
<pre><code>{'encSecKey': '257348aecb5e556c066de214e531faadd1c55d814f9be95fd06d6bff9f4c7a41f831f6394d5a3fd2e3881736d94a02ca919d952872e7d0a50ebfa1769a7a62d512f5f1ca21aec60bc3819a9c3ffca5eca9a0dba6d6f7249b06f5965ecfff3695b54e1c28f3f624750ed39e7de08fc8493242e26dbc4484a01c76f739e135637c',
 'params': 'ZNF1o/ZNVZXhOZHkz9GyshKLbI7TVHgmeFB5vQqDSALAON2CiXciAMOFpiU3mnXGZ+t9hYE/7h2wmv7oi2NmPBZ3POk1qtRif3ygZU2BQO3U8kFDasyz/Yk9kkb07D70iUc5rbvwAy62oXeLUCh39aniZ0EYkglrb8VTpUOChwSDkOXP49FnFjcwA8hSZtuR'}
</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_json</span>(<span class="params">url</span>):</span></span><br><span class="line">    s = requests.Session()</span><br><span class="line">    data=get_params()</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        r = requests.post(url, headers=headers, data=data,allow_redirects=<span class="literal">True</span>)</span><br><span class="line">        <span class="keyword">if</span> r.status_code == <span class="number">200</span>:</span><br><span class="line">            <span class="keyword">return</span> r.json()</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">if</span> response.history:</span><br><span class="line">                <span class="comment">#                 for his in r.history:</span></span><br><span class="line">                <span class="comment">#                     print (his.status_code, his.url)</span></span><br><span class="line">                print(<span class="string">"Request was redirected to "</span>, r.url)</span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    rr = requests.post(url, headers=headers, data=data)</span><br><span class="line">                    <span class="keyword">if</span> rr.status_code == <span class="number">200</span>:</span><br><span class="line">                        <span class="keyword">return</span> rr.json()</span><br><span class="line">                    <span class="keyword">return</span>(rr.status_code)</span><br><span class="line">                <span class="keyword">except</span> RequestException:</span><br><span class="line">                    <span class="keyword">return</span> <span class="string">"Redirected, But Some Still thing Wrong!!!"</span></span><br><span class="line">    <span class="keyword">except</span> RequestException <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">return</span>  <span class="literal">None</span></span><br><span class="line"><span class="comment"># json_text = get_json("http://music.163.com/weapi/v1/resource/comments/R_SO_4_36990266?csrf_token=")</span></span><br><span class="line"><span class="comment"># json_text</span></span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">save_avatar</span>(<span class="params">url,nickname</span>):</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(<span class="string">"avatars"</span>):</span><br><span class="line">        os.mkdir(<span class="string">"avatars"</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        response = requests.get(url)</span><br><span class="line">        <span class="keyword">if</span> response.status_code == <span class="number">200</span>:</span><br><span class="line">            file_path = <span class="string">'{0}/{1}.{2}'</span>.format(<span class="string">"avatars"</span>, md5(response.content).hexdigest(), <span class="string">'jpg'</span>)</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(file_path):</span><br><span class="line">                <span class="keyword">with</span> open(file_path, <span class="string">'wb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">                    f.write(response.content)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                print(<span class="string">'Already Downloaded'</span>, file_path)</span><br><span class="line">        <span class="keyword">return</span> file_path</span><br><span class="line">    <span class="keyword">except</span> requests.ConnectionError:</span><br><span class="line">        print(<span class="string">'Failed to Save Image'</span>)</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">parse_page</span>(<span class="params">json, page</span>):</span></span><br><span class="line">    <span class="keyword">if</span> json:</span><br><span class="line">        comments = json.get(<span class="string">'comments'</span>) </span><br><span class="line">        <span class="keyword">if</span> page==<span class="number">1</span> <span class="keyword">and</span> json.get(<span class="string">'moreHot'</span>):</span><br><span class="line">            comments = json.get(<span class="string">'hotComments'</span>) + json.get(<span class="string">'comments'</span>)</span><br><span class="line">        <span class="keyword">for</span> comment <span class="keyword">in</span> comments:</span><br><span class="line">            music = {}</span><br><span class="line">            music[<span class="string">'content'</span>] = comment.get(<span class="string">'content'</span>)</span><br><span class="line">            music[<span class="string">'likedCount'</span>] = comment.get(<span class="string">'likedCount'</span>)</span><br><span class="line">            music[<span class="string">'time'</span>] = comment.get(<span class="string">'time'</span>)</span><br><span class="line">            comment = comment.get(<span class="string">'user'</span>)</span><br><span class="line">            music[<span class="string">'nickname'</span>] = comment.get(<span class="string">'nickname'</span>)</span><br><span class="line">            music[<span class="string">'avatarurl'</span>] = comment.get(<span class="string">'avatarUrl'</span>)</span><br><span class="line">            file_path = save_avatar(comment.get(<span class="string">'avatarUrl'</span>),comment.get(<span class="string">'nickname'</span>))</span><br><span class="line">            print(file_path)</span><br><span class="line">            music[<span class="string">'avatarpath'</span>] = file_path</span><br><span class="line">            music[<span class="string">'userId'</span>] =  comment.get(<span class="string">'userId'</span>)</span><br><span class="line">            <span class="keyword">yield</span> music</span><br><span class="line"></span><br><span class="line"><span class="comment">## TEST</span></span><br><span class="line"><span class="comment"># for result in parse_page(json_text):</span></span><br><span class="line"><span class="comment">#     print(result)</span></span><br><span class="line"><span class="comment"># json_text.get('total')</span></span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> page <span class="keyword">in</span> range(<span class="number">40</span>,<span class="number">1000</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        JSON = get_json(<span class="string">"http://music.163.com/weapi/v1/resource/comments/R_SO_4_36990266?csrf_token="</span>)</span><br><span class="line">        <span class="keyword">if</span> JSON.get(<span class="string">'more'</span>):</span><br><span class="line">            results = parse_page(JSON, page)</span><br><span class="line">            comment[<span class="string">'offset'</span>] = str(page*<span class="number">20</span><span class="number">-20</span>)</span><br><span class="line">            <span class="keyword">if</span> comment[<span class="string">'total'</span>] != <span class="string">"false"</span> <span class="keyword">and</span> page&gt;<span class="number">1</span>:</span><br><span class="line">                comment[<span class="string">'total'</span>] = <span class="string">"false"</span></span><br><span class="line">            print(<span class="string">"PAGE : "</span>,page)</span><br><span class="line">            <span class="keyword">for</span> result <span class="keyword">in</span> results:</span><br><span class="line">                print(result)</span><br><span class="line">                save_music(result)</span><br><span class="line">            time.sleep(<span class="number">5</span>)</span><br><span class="line">    <span class="keyword">except</span> AttributeError:</span><br><span class="line">        print(JSON)</span><br></pre></td></tr></tbody></table></figure>
<p>Finally my spider was detected,but still got enough infomation<br>
(‘Connection aborted.’, ConnectionResetError(10054, ‘远程主机强迫关闭了一个现有的连接。’, None, 10054, None))</p>
<p><img src="https://cdn.jsdelivr.net/gh/joaxin/img_bed/img/py/crawler/nm/wy010.PNG" alt="netease"></p>
<h2 id="references"><a class="markdownIt-Anchor" href="#references"></a> REFERENCES</h2>
<ul>
<li>
<p><a target="_blank" rel="noopener" href="https://www.zhihu.com/question/36081767">https://www.zhihu.com/question/36081767</a></p>
</li>
<li>
<p><a target="_blank" rel="noopener" href="http://pycryptodome.readthedocs.io/en/latest/">http://pycryptodome.readthedocs.io/en/latest/</a></p>
</li>
<li>
<p><a target="_blank" rel="noopener" href="https://www.blog.pythonlibrary.org/2016/05/18/python-3-an-intro-to-encryption/">https://www.blog.pythonlibrary.org/2016/05/18/python-3-an-intro-to-encryption/</a></p>
</li>
<li>
<p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/47990482/pycryptodome-aes-256-giving-different-output-with-same-key-data">https://stackoverflow.com/questions/47990482/pycryptodome-aes-256-giving-different-output-with-same-key-data</a></p>
</li>
<li>
<p><a target="_blank" rel="noopener" href="https://github.com/darknessomi/musicbox/wiki/%E7%BD%91%E6%98%93%E4%BA%91%E9%9F%B3%E4%B9%90%E6%96%B0%E7%89%88WebAPI%E5%88%86%E6%9E%90">https://github.com/darknessomi/musicbox/wiki/网易云音乐新版WebAPI分析</a></p>
</li>
<li>
<p><a target="_blank" rel="noopener" href="https://www.ibm.com/developerworks/cn/web/1102_niugang_csrf/#icomments">https://www.ibm.com/developerworks/cn/web/1102_niugang_csrf/#icomments</a></p>
</li>
</ul>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script></div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">Joaxin</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="https://u.pinsflora.com/Pysnista/Crawler/Crawler/py_Crawler_NM/">https://u.pinsflora.com/Pysnista/Crawler/Crawler/py_Crawler_NM/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Crypto/">Crypto</a></div><div class="post_share"><div class="addtoany"><div class="a2a_kit a2a_kit_size_32 a2a_default_style"><a class="a2a_button_facebook"></a><a class="a2a_button_twitter"></a><a class="a2a_button_wechat"></a><a class="a2a_button_sina_weibo"></a><a class="a2a_button_facebook_messenger"></a><a class="a2a_button_email"></a><a class="a2a_button_copy_link"></a><a class="a2a_dd" target="_blank" rel="noopener" href="https://www.addtoany.com/share"></a></div></div><script async="async" src="https://static.addtoany.com/menu/page.js"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/Ruita/html/Bioc_ggtree/"><img class="prev-cover" src="https://cdn.jsdelivr.net/gh/joaxin/img_bed/img/cover_posts/bioconductor/ggtree1.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">Learning ggtree</div></div></a></div><div class="next-post pull-right"><a href="/Pysnista/Crawler/Crawler/py_Crawler_xiami/"><img class="next-cover" src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">Xiami Jazz - Hiphop Artists</div></div></a></div></nav><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> Comment</span></div></div><div class="comment-wrap"><div></div></div></div></article></main><footer id="footer" style="background-image: url(https://cdn.jsdelivr.net/gh/joaxin/img_bed/img/cover/cover_grass_in_the_snow.jpg)" data-type="photo"><div id="footer-wrap"><div class="copyright">&copy;2020 By Joaxin</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">Refine, the Life</div></div></footer></div><section id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="Switch Between Traditional Chinese And Simplified Chinese">繁</button><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="fas fa-adjust"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog"></i></button><a id="to_comment" href="#post-comment" title="Scroll To Comments"><i class="fas fa-comments"></i></a><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><button id="chat_btn" type="button" title="rightside.chat_btn"><i class="fas fa-sms"></i></button><button id="go-up" type="button" title="Back To Top"><i class="fas fa-arrow-up"></i></button></div></section><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">Local search</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts" type="text"/></div></div></div><hr/><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>Powered by</span> <a target="_blank" rel="noopener" href="https://github.com/wzpan/hexo-generator-search" style="color:#49B1F5;">hexo-generator-search</a></div></div></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div><div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>if (document.getElementsByClassName('mermaid').length) {
  if (window.mermaidJsLoad) mermaid.init()
  else {
    $.getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js', function () {
      window.mermaidJsLoad = true
      mermaid.initialize({
        theme: 'default',
      })
      false && mermaid.init()
    })
  }
}</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><script defer="defer" id="ribbon" src="/js/third-party/canvas-ribbon.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="fasle"></script><script src="/js/third-party/activate-power-mode.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
document.body.addEventListener('input', POWERMODE);
</script><script>(function(i,s,o,g,r,a,m){i["DaoVoiceObject"]=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;a.charset="utf-8";m.parentNode.insertBefore(a,m)})(window,document,"script",('https:' == document.location.protocol ? 'https:' : 'http:') + "//widget.daovoice.io/widget/fae45343.js","daovoice")
</script><script>var isChatBtn = true
daovoice('init', {
  app_id: 'fae45343',},{
  launcher: { 
     disableLauncherIcon: isChatBtn // 悬浮 ICON 是否显示
  },
});
daovoice('update');

if (isChatBtn) {
  var chatBtnFn = () => {
    var chatBtn = document.getElementById("chat_btn")
    chatBtn.addEventListener("click", function(){
      daovoice('show')
    });
  }
  chatBtnFn()
} else {
  if (true) {
    function chatBtnHide () {
      daovoice('update', {},{
        launcher: { 
        disableLauncherIcon: true // 悬浮 ICON 是否显示
        },
      });
    }
    function chatBtnShow () {
      daovoice('update', {},{
        launcher: { 
        disableLauncherIcon: false // 悬浮 ICON 是否显示
        },
      });
    }
  }
}</script></div></body></html>