<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Django Introduction Part10 - Testing a Django web application | Pinsflora</title><meta name="keywords" content="Django"><meta name="author" content="Joaxin"><meta name="copyright" content="Joaxin"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="As websites grow they become harder to test manually. Not only is there more to test, but, as interactions between components become more complex, a small change in one area can impact other areas, so">
<meta property="og:type" content="article">
<meta property="og:title" content="Django Introduction Part10 - Testing a Django web application">
<meta property="og:url" content="https://u.pinsflora.xyz/Pysnista/Django/dj_intro10_testing/index.html">
<meta property="og:site_name" content="Pinsflora">
<meta property="og:description" content="As websites grow they become harder to test manually. Not only is there more to test, but, as interactions between components become more complex, a small change in one area can impact other areas, so">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/joaxin/img_bed/img/cover/cover_writting_letter.jpg">
<meta property="article:published_time" content="2018-01-23T16:00:00.000Z">
<meta property="article:modified_time" content="2020-09-04T16:00:00.000Z">
<meta property="article:author" content="Joaxin">
<meta property="article:tag" content="Django">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/joaxin/img_bed/img/cover/cover_writting_letter.jpg"><link rel="shortcut icon" href="/img/favicon-32x32.png"><link rel="canonical" href="https://u.pinsflora.xyz/Pysnista/Django/dj_intro10_testing/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//www.google-analytics.com" crossorigin=""/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><script async="async" src="https://www.googletagmanager.com/gtag/js?id=UA-177831205-1"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-177831205-1');
</script><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"We didn't find any results for the search: ${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: {"limitDay":600,"position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: 'days',
  date_suffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"Traditional Chinese Activated Manually","cht_to_chs":"Simplified Chinese Activated Manually","day_to_night":"Dark Mode Activated Manually","night_to_day":"Light Mode Activated Manually","bgLight":"#49b1f5","bgDark":"#2d3035","position":"bottom-left"},
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2020-09-05 00:00:00'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const fontSizeVal = saveToLocal.get('global-font-size')
    if (fontSizeVal !== undefined) {
      document.documentElement.style.setProperty('--global-font-size', fontSizeVal + 'px')
    }
    })(window)</script><meta name="generator" content="Hexo 5.3.0"><link rel="alternate" href="/atom.xml" title="Pinsflora" type="application/atom+xml">
</head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" src="https://avatars2.githubusercontent.com/u/8346164?s=460&amp;v=4" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">340</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">Tags</div><div class="length-num">110</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">Categories</div><div class="length-num">34</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fa fa-list"></i><span> List</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/Galleries"><i class="fa-fw /gallery/"></i><span> 0</span></a></li><li><a class="site-page child" href="/Movie"><i class="fa-fw /movies/"></i><span> 1</span></a></li><li><a class="site-page child" href="/Games"><i class="fa-fw /games/"></i><span> 2</span></a></li><li><a class="site-page child" href="/Tools"><i class="fa-fw /tools/"></i><span> 3</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://cdn.jsdelivr.net/gh/joaxin/img_bed/img/cover/cover_writting_letter.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Pinsflora</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> Search</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fa fa-list"></i><span> List</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/Galleries"><i class="fa-fw /gallery/"></i><span> 0</span></a></li><li><a class="site-page child" href="/Movie"><i class="fa-fw /movies/"></i><span> 1</span></a></li><li><a class="site-page child" href="/Games"><i class="fa-fw /games/"></i><span> 2</span></a></li><li><a class="site-page child" href="/Tools"><i class="fa-fw /tools/"></i><span> 3</span></a></li></ul></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Django Introduction Part10 - Testing a Django web application</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2018-01-23T16:00:00.000Z" title="Created 2018-01-24 00:00:00">2018-01-24</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2020-09-04T16:00:00.000Z" title="Updated 2020-09-05 00:00:00">2020-09-05</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Python/">Python</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Python/Django/">Django</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">Word count:</span><span class="word-count">5.7k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">Reading time:</span><span>35min</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Django Introduction Part10 - Testing a Django web application"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post View:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p>As websites grow they become harder to test manually. Not only is there more to test, but, as interactions between components become more complex, a small change in one area can impact other areas, so more changes will be required to ensure everything keeps working and errors are not introduced as more changes are made. One way to mitigate these problems is to write automated tests, which can easily and reliably be run every time you make a change.</p>
<h2 id="overview"><a class="markdownIt-Anchor" href="#overview"></a> Overview</h2>
<p>Automated tests can really help with this problem! The obvious benefits are that they can be run much faster than manual tests, can test to a much lower level of detail, and test exactly the same functionality every time (human testers are nowhere near as reliable!) Because they are fast, automated tests can be executed more regularly, and if a test fails, they point to exactly where code is not performing as expected.</p>
<p>In addition, automated tests can act as the first real-world “user” of your code, forcing you to be rigorous about defining and documenting how your website should behave. Often they are the basis for your code examples and documentation. For these reasons, some software development processes start with test definition and implementation, after which the code is written to match the required behavior (e.g. <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Test-driven_development">test-driven</a> and <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Behavior-driven_development">behaviour-driven</a> development).</p>
<p>This article shows how to write automated tests for Django, by adding a number of tests to the <em>LocalLibrary</em> website.</p>
<h3 id="types-of-testing"><a class="markdownIt-Anchor" href="#types-of-testing"></a> Types of testing</h3>
<p>There are numerous types, levels, and classifications of tests and testing approaches. The most important automated tests are:</p>
<ul>
<li>
<p>Unit tests</p>
<p>Verify functional behavior of individual components, often to class and function level.</p>
</li>
<li>
<p>Regression tests</p>
<p>Tests that reproduce historic bugs. Each test is initially run to verify that the bug has been fixed, and then re-run to ensure that it has not been reintroduced following later changes to the code.</p>
</li>
<li>
<p>Integration tests</p>
<p>Verify how groupings of components work when used together. Integration tests are aware of the required interactions between components, but not necessarily of the internal operations of each component. They may cover simple groupings of components through to the whole website.</p>
</li>
</ul>
<p><strong>Note:</strong> Other common types of tests include black box, white box, manual, automated, canary, smoke, conformance, acceptance, functional, system, performance, load, and stress tests. Look them up for more information.</p>
<h3 id="what-does-django-provide-for-testing"><a class="markdownIt-Anchor" href="#what-does-django-provide-for-testing"></a> What does Django provide for testing?</h3>
<p>Testing a website is a complex task, because it is made of several layers of logic – from HTTP-level request handling, queries models, to form validation and processing, and template rendering.</p>
<p>Django provides a test framework with a small hierarchy of classes that build on the Python standard <code>unittest</code> library. Despite the name, this test framework is suitable for both unit and integration tests. The Django framework adds API methods and tools to help test web and Django-specific behaviour. These allow you to simulate requests, insert test data, and inspect your application’s output. Django also provides an API LiveServerTestCase and tools for using different testing frameworks, for example you can integrate with the popular <a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Learn/Tools_and_testing/Cross_browser_testing/Your_own_automation_environment">Selenium</a> framework to simulate a user interacting with a live browser.</p>
<p>To write a test you derive from any of the Django (or <em>unittest</em>) test base classes and then write separate methods to check that specific functionality works as expected (tests use “assert” methods to test that expressions result in <code>True</code> or <code>False</code> values, or that two values are equal, etc.) When you start a test run, the framework executes the chosen test methods in your derived classes. The test methods are run independently, with common setup and/or tear-down behaviour defined in the class, as shown below.</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">YourTestClass</span>(<span class="params">TestCase</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setUp</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="comment"># Setup run before every test method.</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">tearDown</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="comment"># Clean up run after every test method.</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_something_that_will_pass</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.assertFalse(<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_something_that_will_fail</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.assertTrue(<span class="literal">False</span>)</span><br></pre></td></tr></tbody></table></figure>
<p>The best base class for most tests is django.test.TestCase. This test class creates a clean database before its tests are run, and runs every test function in its own transaction. The class also owns a test Client that you can use to simulate a user interacting with the code at the view level.</p>
<h2 id="test-structure-overview"><a class="markdownIt-Anchor" href="#test-structure-overview"></a> Test structure overview</h2>
<p>Before we go into the detail of “what to test”, let’s first briefly look at <em>where</em> and <em>how</em> tests are defined.</p>
<p>Django uses the unittest module’s <a target="_blank" rel="noopener" href="https://docs.python.org/3/library/unittest.html#unittest-test-discovery">built-in test discovery</a>, which will discover tests under the current working directory in any file named with the pattern <strong>test*.py</strong>. Provided you name the files appropriately, you can use any structure you like. We recommend that you create a module for your test code, and have separate files for models, views, forms, and any other types of code you need to test. For example:</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">movie/</span><br><span class="line">  /tests/</span><br><span class="line">    __init__.py</span><br><span class="line">    test_models.py</span><br><span class="line">    test_forms.py</span><br><span class="line">    test_views.py</span><br></pre></td></tr></tbody></table></figure>
<p>Delete the skeleton <code>test.py</code> file as we won’t need it.</p>
<p>Open <strong>/tests/test_models.py</strong>. The file should import <code>django.test.TestCase</code>, as shown:</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.test <span class="keyword">import</span> TestCase</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create your tests here.</span></span><br></pre></td></tr></tbody></table></figure>
<p>Often you will add a test class for each model/view/form you want to test, with individual methods for testing specific functionality. In other cases you may wish to have a separate class for testing a specific use case, with individual test functions that test aspects of that use-case (for example, a class to test that a model field is properly validated, with functions to test each of the possible failure cases). Again, the structure is very much up to you, but it is best if you are consistent.</p>
<p>Add the test class below to the bottom of the file. The class demonstrates how to construct a test case class by deriving from <code>TestCase</code>.</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">YourTestClass</span>(<span class="params">TestCase</span>):</span></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setUpTestData</span>(<span class="params">cls</span>):</span></span><br><span class="line">        print(<span class="string">"setUpTestData: Run once to set up non-modified data for all class methods."</span>)</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setUp</span>(<span class="params">self</span>):</span></span><br><span class="line">        print(<span class="string">"setUp: Run once for every test method to setup clean data."</span>)</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_false_is_false</span>(<span class="params">self</span>):</span></span><br><span class="line">        print(<span class="string">"Method: test_false_is_false."</span>)</span><br><span class="line">        self.assertFalse(<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_false_is_true</span>(<span class="params">self</span>):</span></span><br><span class="line">        print(<span class="string">"Method: test_false_is_true."</span>)</span><br><span class="line">        self.assertTrue(<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_one_plus_one_equals_two</span>(<span class="params">self</span>):</span></span><br><span class="line">        print(<span class="string">"Method: test_one_plus_one_equals_two."</span>)</span><br><span class="line">        self.assertEqual(<span class="number">1</span> + <span class="number">1</span>, <span class="number">2</span>)</span><br></pre></td></tr></tbody></table></figure>
<p>The new class defines two methods that you can use for pre-test configuration (for example, to create any models or other objects you will need for the test):</p>
<ul>
<li><code>setUpTestData()</code> is called once at the beginning of the test run for class-level setup. You’d use this to create objects that aren’t going to be modified or changed in any of the test methods.</li>
<li><code>setUp()</code> is called before every test function to set up any objects that may be modified by the test (every test function will get a “fresh” version of these objects).</li>
</ul>
<p>The test classes also have a <code>tearDown()</code> method which we haven’t used. This method isn’t particularly useful for database tests, since the <code>TestCase</code> base class takes care of database teardown for you.</p>
<p>Below those we have a number of test methods, which use <code>Assert</code> functions to test whether conditions are true, false or equal (<code>AssertTrue</code>, <code>AssertFalse</code>, <code>AssertEqual</code>). If the condition does not evaluate as expected then the test will fail and report the error to your console.</p>
<p>The <code>AssertTrue</code>, <code>AssertFalse</code>, <code>AssertEqual</code> are standard assertions provided by <strong>unittest</strong>. There are other standard assertions in the framework, and also Django-specific assertions to test if a view redirects (<code>assertRedirects</code>), to test if a particular template has been used (<code>assertTemplateUsed</code>), etc.</p>
<p>You should <strong>not</strong> normally include <strong>print()</strong> functions in your tests as shown above. We do that here only so that you can see the order that the setup functions are called in the console (in the following section).</p>
<h2 id="how-to-run-the-tests"><a class="markdownIt-Anchor" href="#how-to-run-the-tests"></a> How to run the tests</h2>
<p>The easiest way to run all the tests is to use the command:</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python manage.py <span class="built_in">test</span></span><br></pre></td></tr></tbody></table></figure>
<p>If you get errors similar to: <code>ValueError: Missing staticfiles manifest entry ...</code> this may be because testing does not run <em>collectstatic</em> by default and your app is using a storage class that requires it (see <a target="_blank" rel="noopener" href="https://docs.djangoproject.com/en/3.1/ref/contrib/staticfiles/#django.contrib.staticfiles.storage.ManifestStaticFilesStorage.manifest_strict">manifest_strict</a> for more information). There are a number of ways you can overcome this problem - the easiest is to simply run <em>collectstatic</em> before running the tests:</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 manage.py collectstatic</span><br></pre></td></tr></tbody></table></figure>
<p>Run the tests in the root directory of <em>yourproject</em>. You should see an output like the one below.</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&gt; python3 manage.py <span class="built_in">test</span></span><br><span class="line"></span><br><span class="line">Creating <span class="built_in">test</span> database <span class="keyword">for</span> <span class="built_in">alias</span> <span class="string">'default'</span>...</span><br><span class="line">setUpTestData: Run once to <span class="built_in">set</span> up non-modified data <span class="keyword">for</span> all class methods.</span><br><span class="line">setUp: Run once <span class="keyword">for</span> every <span class="built_in">test</span> method to setup clean data.</span><br><span class="line">Method: test_false_is_false.</span><br><span class="line">setUp: Run once <span class="keyword">for</span> every <span class="built_in">test</span> method to setup clean data.</span><br><span class="line">Method: test_false_is_true.</span><br><span class="line">setUp: Run once <span class="keyword">for</span> every <span class="built_in">test</span> method to setup clean data.</span><br><span class="line">Method: test_one_plus_one_equals_two.</span><br><span class="line">.</span><br><span class="line">======================================================================</span><br><span class="line">FAIL: test_false_is_true (catalog.tests.tests_models.YourTestClass)</span><br><span class="line">----------------------------------------------------------------------</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"...\tests\tests_models.py"</span>, line 22, <span class="keyword">in</span> test_false_is_true</span><br><span class="line">    self.assertTrue(False)</span><br><span class="line">AssertionError: False is not <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">----------------------------------------------------------------------</span><br><span class="line">Ran 3 tests <span class="keyword">in</span> 0.072s</span><br><span class="line"></span><br><span class="line">FAILED (failures=1)</span><br><span class="line">Destroying <span class="built_in">test</span> database <span class="keyword">for</span> <span class="built_in">alias</span> <span class="string">'default'</span>...</span><br></pre></td></tr></tbody></table></figure>
<p>Here we see that we had one test failure, and we can see exactly what function failed and why (this failure is expected, because <code>False</code> is not <code>True</code>!).</p>
<p><strong>Tip:</strong> The most important thing to learn from the test output above is that it is much more valuable if you use descriptive/informative names for your objects and methods.</p>
<p><strong>Showing more test information</strong></p>
<p>If you want to get more information about the test run you can change the <em>verbosity</em>. For example, to list the test successes as well as failures (and a whole bunch of information about how the testing database is set up) you can set the verbosity to “2” as shown:</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 manage.py <span class="built_in">test</span> --verbosity 2</span><br></pre></td></tr></tbody></table></figure>
<p>The allowed verbosity levels are 0, 1, 2, and 3, with the default being “1”.</p>
<p><strong>Running specific tests</strong></p>
<p>If you want to run a subset of your tests you can do so by specifying the full dot path to the package(s), module, <code>TestCase</code> subclass or method:</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Run the specified module</span></span><br><span class="line">python3 manage.py <span class="built_in">test</span> movie.tests</span><br><span class="line"></span><br><span class="line"><span class="comment"># Run the specified module</span></span><br><span class="line">python3 manage.py <span class="built_in">test</span> movie.tests.test_models</span><br><span class="line"></span><br><span class="line"><span class="comment"># Run the specified class</span></span><br><span class="line">python3 manage.py <span class="built_in">test</span> movie.tests.test_models.YourTestClass</span><br><span class="line"></span><br><span class="line"><span class="comment"># Run the specified method</span></span><br><span class="line">python3 manage.py <span class="built_in">test</span> movie.tests.test_models.YourTestClass.test_one_plus_one_equals_two</span><br></pre></td></tr></tbody></table></figure>
<h2 id="practical-examples"><a class="markdownIt-Anchor" href="#practical-examples"></a> Practical examples</h2>
<p>Now we know how to run our tests and what sort of things we need to test, let’s look at some practical examples.</p>
<h3 id="models"><a class="markdownIt-Anchor" href="#models"></a> Models</h3>
<p>For example, consider the <code>Author</code> model below. Here we should test the labels for all the fields, because even though we haven’t explicitly specified most of them, we have a design that says what these values should be. If we don’t test the values, then we don’t know that the field labels have their intended values. Similarly while we trust that Django will create a field of the specified length, it is worthwhile to specify a test for this length to ensure that it was implemented as planned.</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Author</span>(<span class="params">models.Model</span>):</span></span><br><span class="line">    first_name = models.CharField(max_length=<span class="number">100</span>)</span><br><span class="line">    last_name = models.CharField(max_length=<span class="number">100</span>)</span><br><span class="line">    date_of_birth = models.DateField(null=<span class="literal">True</span>, blank=<span class="literal">True</span>)</span><br><span class="line">    date_of_death = models.DateField(<span class="string">'Died'</span>, null=<span class="literal">True</span>, blank=<span class="literal">True</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_absolute_url</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> reverse(<span class="string">'author-detail'</span>, args=[str(self.id)])</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">f'<span class="subst">{self.last_name}</span>, <span class="subst">{self.first_name}</span>'</span></span><br></pre></td></tr></tbody></table></figure>
<p>Open our <strong>test_models.py</strong>, here you’ll see that we first import <code>TestCase</code> and derive our test class (<code>AuthorModelTest</code>) from it, using a descriptive name so we can easily identify any failing tests in the test output. We then call <code>setUpTestData()</code> to create an author object that we will use but not modify in any of the tests.</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.test <span class="keyword">import</span> TestCase</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> catalog.models <span class="keyword">import</span> Author</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AuthorModelTest</span>(<span class="params">TestCase</span>):</span></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setUpTestData</span>(<span class="params">cls</span>):</span></span><br><span class="line">        <span class="comment"># Set up non-modified objects used by all test methods</span></span><br><span class="line">        Author.objects.create(first_name=<span class="string">'Big'</span>, last_name=<span class="string">'Bob'</span>)</span><br><span class="line">       </span><br><span class="line">    <span class="comment"># The field tests check that the values of the field labels (`verbose_name`) and that the size of the character fields are as expected. </span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_first_name_label</span>(<span class="params">self</span>):</span></span><br><span class="line">        author = Author.objects.get(id=<span class="number">1</span>)</span><br><span class="line">        field_label = author._meta.get_field(<span class="string">'first_name'</span>).verbose_name</span><br><span class="line">        self.assertEquals(field_label, <span class="string">'first name'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_date_of_death_label</span>(<span class="params">self</span>):</span></span><br><span class="line">        author=Author.objects.get(id=<span class="number">1</span>)</span><br><span class="line">        field_label = author._meta.get_field(<span class="string">'date_of_death'</span>).verbose_name</span><br><span class="line">        self.assertEquals(field_label, <span class="string">'died'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_first_name_max_length</span>(<span class="params">self</span>):</span></span><br><span class="line">        author = Author.objects.get(id=<span class="number">1</span>)</span><br><span class="line">        max_length = author._meta.get_field(<span class="string">'first_name'</span>).max_length</span><br><span class="line">        self.assertEquals(max_length, <span class="number">100</span>)</span><br><span class="line">    <span class="comment"># check that the object name was constructed as we expected using "Last Name", "First Name" format</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_object_name_is_last_name_comma_first_name</span>(<span class="params">self</span>):</span></span><br><span class="line">        author = Author.objects.get(id=<span class="number">1</span>)</span><br><span class="line">        expected_object_name = <span class="string">f'<span class="subst">{author.last_name}</span>, <span class="subst">{author.first_name}</span>'</span></span><br><span class="line">        self.assertEquals(expected_object_name, str(author))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_get_absolute_url</span>(<span class="params">self</span>):</span></span><br><span class="line">        author = Author.objects.get(id=<span class="number">1</span>)</span><br><span class="line">        <span class="comment"># This will also fail if the urlconf is not defined.</span></span><br><span class="line">        self.assertEquals(author.get_absolute_url(), <span class="string">'/catalog/author/1'</span>)</span><br></pre></td></tr></tbody></table></figure>
<p>Run the tests now. If you created the Author model as we described in the models tutorial it is quite likely that you will get an error for the <code>date_of_death</code> label as shown below. The test is failing because it was written expecting the label definition to follow Django’s convention of not capitalising the first letter of the label.</p>
<h3 id="forms"><a class="markdownIt-Anchor" href="#forms"></a> Forms</h3>
<p>The philosophy for testing your forms is the same as for testing your models; you need to test anything that you’ve coded or your design specifies, but not the behaviour of the underlying framework and other third party libraries.</p>
<p>Consider our form for renewing books. This has just one field for the renewal date, which will have a label and help text that we will need to verify.</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RenewBookForm</span>(<span class="params">forms.Form</span>):</span></span><br><span class="line">    <span class="string">"""Form for a librarian to renew books."""</span></span><br><span class="line">    renewal_date = forms.DateField(help_text=<span class="string">"Enter a date between now and 4 weeks (default 3)."</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">clean_renewal_date</span>(<span class="params">self</span>):</span></span><br><span class="line">        data = self.cleaned_data[<span class="string">'renewal_date'</span>]</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Check if a date is not in the past.</span></span><br><span class="line">        <span class="keyword">if</span> data &lt; datetime.date.today():</span><br><span class="line">            <span class="keyword">raise</span> ValidationError(_(<span class="string">'Invalid date - renewal in past'</span>))</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Check if date is in the allowed range (+4 weeks from today).</span></span><br><span class="line">        <span class="keyword">if</span> data &gt; datetime.date.today() + datetime.timedelta(weeks=<span class="number">4</span>):</span><br><span class="line">            <span class="keyword">raise</span> ValidationError(_(<span class="string">'Invalid date - renewal more than 4 weeks ahead'</span>))</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Remember to always return the cleaned data.</span></span><br><span class="line">        <span class="keyword">return</span> data</span><br></pre></td></tr></tbody></table></figure>
<p>Open our <strong>test_forms.py</strong> file and replace any existing code with the following test code for the <code>RenewBookForm</code> form. We start by importing our form and some Python and Django libraries to help test time-related functionality. We then declare our form test class in the same way as we did for models, using a descriptive name for our <code>TestCase</code>-derived test class.</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> django.test <span class="keyword">import</span> TestCase</span><br><span class="line"><span class="keyword">from</span> django.utils <span class="keyword">import</span> timezone</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> catalog.forms <span class="keyword">import</span> RenewBookForm</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RenewBookFormTest</span>(<span class="params">TestCase</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_renew_form_date_field_label</span>(<span class="params">self</span>):</span></span><br><span class="line">        form = RenewBookForm()</span><br><span class="line">        self.assertTrue(form.fields[<span class="string">'renewal_date'</span>].label == <span class="literal">None</span> <span class="keyword">or</span> form.fields[<span class="string">'renewal_date'</span>].label == <span class="string">'renewal date'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_renew_form_date_field_help_text</span>(<span class="params">self</span>):</span></span><br><span class="line">        form = RenewBookForm()</span><br><span class="line">        self.assertEqual(form.fields[<span class="string">'renewal_date'</span>].help_text, <span class="string">'Enter a date between now and 4 weeks (default 3).'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_renew_form_date_in_past</span>(<span class="params">self</span>):</span></span><br><span class="line">        date = datetime.date.today() - datetime.timedelta(days=<span class="number">1</span>)</span><br><span class="line">        form = RenewBookForm(data={<span class="string">'renewal_date'</span>: date})</span><br><span class="line">        self.assertFalse(form.is_valid())</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_renew_form_date_too_far_in_future</span>(<span class="params">self</span>):</span></span><br><span class="line">        date = datetime.date.today() + datetime.timedelta(weeks=<span class="number">4</span>) + datetime.timedelta(days=<span class="number">1</span>)</span><br><span class="line">        form = RenewBookForm(data={<span class="string">'renewal_date'</span>: date})</span><br><span class="line">        self.assertFalse(form.is_valid())</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_renew_form_date_today</span>(<span class="params">self</span>):</span></span><br><span class="line">        date = datetime.date.today()</span><br><span class="line">        form = RenewBookForm(data={<span class="string">'renewal_date'</span>: date})</span><br><span class="line">        self.assertTrue(form.is_valid())</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_renew_form_date_max</span>(<span class="params">self</span>):</span></span><br><span class="line">        date = timezone.now() + datetime.timedelta(weeks=<span class="number">4</span>)</span><br><span class="line">        form = RenewBookForm(data={<span class="string">'renewal_date'</span>: date})</span><br><span class="line">        self.assertTrue(form.is_valid())</span><br></pre></td></tr></tbody></table></figure>
<p>The first two functions test that the field’s <code>label</code> and <code>help_text</code> are as expected. We have to access the field using the fields dictionary (e.g. <code>form.fields['renewal_date']</code>). Note here that we also have to test whether the label value is <code>None</code>, because even though Django will render the correct label it returns <code>None</code> if the value is not <em>explicitly</em> set.</p>
<p>The rest of the functions test that the form is valid for renewal dates just inside the acceptable range and invalid for values outside the range. Note how we construct test date values around our current date (<code>datetime.date.today()</code>) using <code>datetime.timedelta()</code> (in this case specifying a number of days or weeks). We then just create the form, passing in our data, and test if it is valid.</p>
<p>That’s all for forms; we do have some others, but they are automatically created by our generic class-based editing views, and should be tested there! Run the tests and confirm that our code still passes!</p>
<h3 id="views"><a class="markdownIt-Anchor" href="#views"></a> Views</h3>
<p>To validate our view behaviour we use the Django test Client. This class acts like a dummy web browser that we can use to simulate <code>GET</code> and <code>POST</code> requests on a URL and observe the response. We can see almost everything about the response, from low-level HTTP (result headers and status codes) through to the template we’re using to render the HTML and the context data we’re passing to it. We can also see the chain of redirects (if any) and check the URL and status code at each step. This allows us to verify that each view is doing what is expected.</p>
<p>Let’s start with one of our simplest views, which provides a list of all Authors. This is displayed at URL <strong>/catalog/authors/</strong> (an URL named ‘authors’ in the URL configuration).</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AuthorListView</span>(<span class="params">generic.ListView</span>):</span></span><br><span class="line">    model = Author</span><br><span class="line">    paginate_by = <span class="number">10</span></span><br></pre></td></tr></tbody></table></figure>
<p>As this is a generic list view almost everything is done for us by Django. Arguably if you trust Django then the only thing you need to test is that the view is accessible at the correct URL and can be accessed using its name. However if you’re using a test-driven development process you’ll start by writing tests that confirm that the view displays all Authors, paginating them in lots of 10.</p>
<p>Open the <strong>test_views.py</strong> file and replace any existing text with the following test code for <code>AuthorListView</code>. As before we import our model and some useful classes. In the <code>setUpTestData()</code> method we set up a number of <code>Author</code> objects so that we can test our pagination.</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.test <span class="keyword">import</span> TestCase</span><br><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> reverse</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> catalog.models <span class="keyword">import</span> Author</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AuthorListViewTest</span>(<span class="params">TestCase</span>):</span></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setUpTestData</span>(<span class="params">cls</span>):</span></span><br><span class="line">        <span class="comment"># Create 13 authors for pagination tests</span></span><br><span class="line">        number_of_authors = <span class="number">13</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> author_id <span class="keyword">in</span> range(number_of_authors):</span><br><span class="line">            Author.objects.create(</span><br><span class="line">                first_name=<span class="string">f'Christian <span class="subst">{author_id}</span>'</span>,</span><br><span class="line">                last_name=<span class="string">f'Surname <span class="subst">{author_id}</span>'</span>,</span><br><span class="line">            )</span><br><span class="line">           </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_view_url_exists_at_desired_location</span>(<span class="params">self</span>):</span></span><br><span class="line">        response = self.client.get(<span class="string">'/catalog/authors/'</span>)</span><br><span class="line">        self.assertEqual(response.status_code, <span class="number">200</span>)</span><br><span class="line">           </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_view_uses_correct_template</span>(<span class="params">self</span>):</span></span><br><span class="line">        response = self.client.get(reverse(<span class="string">'authors'</span>))</span><br><span class="line">        self.assertEqual(response.status_code, <span class="number">200</span>)</span><br><span class="line">        self.assertTemplateUsed(response, <span class="string">'catalog/author_list.html'</span>)</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_pagination_is_ten</span>(<span class="params">self</span>):</span></span><br><span class="line">        response = self.client.get(reverse(<span class="string">'authors'</span>))</span><br><span class="line">        self.assertEqual(response.status_code, <span class="number">200</span>)</span><br><span class="line">        self.assertTrue(<span class="string">'is_paginated'</span> <span class="keyword">in</span> response.context)</span><br><span class="line">        self.assertTrue(response.context[<span class="string">'is_paginated'</span>] == <span class="literal">True</span>)</span><br><span class="line">        self.assertTrue(len(response.context[<span class="string">'author_list'</span>]) == <span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_lists_all_authors</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="comment"># Get second page and confirm it has (exactly) remaining 3 items</span></span><br><span class="line">        response = self.client.get(reverse(<span class="string">'authors'</span>)+<span class="string">'?page=2'</span>)</span><br><span class="line">        self.assertEqual(response.status_code, <span class="number">200</span>)</span><br><span class="line">        self.assertTrue(<span class="string">'is_paginated'</span> <span class="keyword">in</span> response.context)</span><br><span class="line">        self.assertTrue(response.context[<span class="string">'is_paginated'</span>] == <span class="literal">True</span>)</span><br><span class="line">        self.assertTrue(len(response.context[<span class="string">'author_list'</span>]) == <span class="number">3</span>)</span><br></pre></td></tr></tbody></table></figure>
<p>All the tests use the client (belonging to our <code>TestCase</code>'s derived class) to simulate a <code>GET</code>request and get a response. The first version checks a specific URL (note, just the specific path without the domain) while the second generates the URL from its name in the URL configuration.</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">response = self.client.get('/catalog/authors/')</span><br><span class="line">response = self.client.get(reverse('authors'))</span><br></pre></td></tr></tbody></table></figure>
<p>Once we have the response we query it for its status code, the template used, whether or not the response is paginated, the number of items returned, and the total number of items.</p>
<h4 id="views-that-are-restricted-to-logged-in-users"><a class="markdownIt-Anchor" href="#views-that-are-restricted-to-logged-in-users"></a> Views that are restricted to logged in users</h4>
<p>In some cases you’ll want to test a view that is restricted to just logged in users. For example our <code>LoanedBooksByUserListView</code> is very similar to our previous view but is only available to logged in users, and only displays <code>BookInstance</code> records that are borrowed by the current user, have the ‘on loan’ status, and are ordered “oldest first”.</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib.auth.mixins <span class="keyword">import</span> LoginRequiredMixin</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LoanedBooksByUserListView</span>(<span class="params">LoginRequiredMixin, generic.ListView</span>):</span></span><br><span class="line">    <span class="string">"""Generic class-based view listing books on loan to current user."""</span></span><br><span class="line">    model = BookInstance</span><br><span class="line">    template_name =<span class="string">'catalog/bookinstance_list_borrowed_user.html'</span></span><br><span class="line">    paginate_by = <span class="number">10</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_queryset</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> BookInstance.objects.filter(borrower=self.request.user).filter(status__exact=<span class="string">'o'</span>).order_by(<span class="string">'due_back'</span>)</span><br></pre></td></tr></tbody></table></figure>
<p>Add the following test code to <strong>test_views.py</strong>. Here we first use <code>SetUp()</code> to create some user login accounts and <code>BookInstance</code> objects (along with their associated books and other records) that we’ll use later in the tests. Half of the books are borrowed by each test user, but we’ve initially set the status of all books to “maintenance”. We’ve used <code>SetUp()</code> rather than <code>setUpTestData()</code> because we’ll be modifying some of these objects later.</p>
<p><strong>Note:</strong> The <code>setUp()</code> code below creates a book with a specified <code>Language</code>, but <em>your</em> code may not include the <code>Language</code> model as this was created as a <em>challenge</em>. If this is the case, simply comment out the parts of the code that create or import Language objects. You should also do this in the <code>RenewBookInstancesViewTest</code> section that follows.</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> django.utils <span class="keyword">import</span> timezone</span><br><span class="line"><span class="keyword">from</span> django.contrib.auth.models <span class="keyword">import</span> User <span class="comment"># Required to assign User as a borrower</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> catalog.models <span class="keyword">import</span> BookInstance, Book, Genre, Language</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LoanedBookInstancesByUserListViewTest</span>(<span class="params">TestCase</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setUp</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="comment"># Create two users</span></span><br><span class="line">        test_user1 = User.objects.create_user(username=<span class="string">'testuser1'</span>, password=<span class="string">'1X&lt;ISRUkw+tuK'</span>)</span><br><span class="line">        test_user2 = User.objects.create_user(username=<span class="string">'testuser2'</span>, password=<span class="string">'2HJ1vRV0Z&amp;3iD'</span>)</span><br><span class="line">        </span><br><span class="line">        test_user1.save()</span><br><span class="line">        test_user2.save()</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Create a book</span></span><br><span class="line">        test_author = Author.objects.create(first_name=<span class="string">'John'</span>, last_name=<span class="string">'Smith'</span>)</span><br><span class="line">        test_genre = Genre.objects.create(name=<span class="string">'Fantasy'</span>)</span><br><span class="line">        test_language = Language.objects.create(name=<span class="string">'English'</span>)</span><br><span class="line">        test_book = Book.objects.create(</span><br><span class="line">            title=<span class="string">'Book Title'</span>,</span><br><span class="line">            summary=<span class="string">'My book summary'</span>,</span><br><span class="line">            isbn=<span class="string">'ABCDEFG'</span>,</span><br><span class="line">            author=test_author,</span><br><span class="line">            language=test_language,</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Create genre as a post-step</span></span><br><span class="line">        genre_objects_for_book = Genre.objects.all()</span><br><span class="line">        test_book.genre.set(genre_objects_for_book) <span class="comment"># Direct assignment of many-to-many types not allowed.</span></span><br><span class="line">        test_book.save()</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Create 30 BookInstance objects</span></span><br><span class="line">        number_of_book_copies = <span class="number">30</span></span><br><span class="line">        <span class="keyword">for</span> book_copy <span class="keyword">in</span> range(number_of_book_copies):</span><br><span class="line">            return_date = timezone.now() + datetime.timedelta(days=book_copy%<span class="number">5</span>)</span><br><span class="line">            the_borrower = test_user1 <span class="keyword">if</span> book_copy % <span class="number">2</span> <span class="keyword">else</span> test_user2</span><br><span class="line">            status = <span class="string">'m'</span></span><br><span class="line">            BookInstance.objects.create(</span><br><span class="line">                book=test_book,</span><br><span class="line">                imprint=<span class="string">'Unlikely Imprint, 2016'</span>,</span><br><span class="line">                due_back=return_date,</span><br><span class="line">                borrower=the_borrower,</span><br><span class="line">                status=status,</span><br><span class="line">            )</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_redirect_if_not_logged_in</span>(<span class="params">self</span>):</span></span><br><span class="line">        response = self.client.get(reverse(<span class="string">'my-borrowed'</span>))</span><br><span class="line">        self.assertRedirects(response, <span class="string">'/accounts/login/?next=/catalog/mybooks/'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_logged_in_uses_correct_template</span>(<span class="params">self</span>):</span></span><br><span class="line">        login = self.client.login(username=<span class="string">'testuser1'</span>, password=<span class="string">'1X&lt;ISRUkw+tuK'</span>)</span><br><span class="line">        response = self.client.get(reverse(<span class="string">'my-borrowed'</span>))</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Check our user is logged in</span></span><br><span class="line">        self.assertEqual(str(response.context[<span class="string">'user'</span>]), <span class="string">'testuser1'</span>)</span><br><span class="line">        <span class="comment"># Check that we got a response "success"</span></span><br><span class="line">        self.assertEqual(response.status_code, <span class="number">200</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Check we used correct template</span></span><br><span class="line">        self.assertTemplateUsed(response, <span class="string">'catalog/bookinstance_list_borrowed_user.html'</span>)</span><br></pre></td></tr></tbody></table></figure>
<p>To verify that the view will redirect to a login page if the user is not logged in we use <code>assertRedirects</code>, as demonstrated in <code>test_redirect_if_not_logged_in()</code>. To verify that the page is displayed for a logged in user we first log in our test user, and then access the page again and check that we get a <code>status_code</code> of 200 (success).</p>
<p>The rest of the tests verify that our view only returns books that are on loan to our current borrower. Copy the code below and paste it onto the end of the test class above.</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_only_borrowed_books_in_list</span>(<span class="params">self</span>):</span></span><br><span class="line">    login = self.client.login(username=<span class="string">'testuser1'</span>, password=<span class="string">'1X&lt;ISRUkw+tuK'</span>)</span><br><span class="line">    response = self.client.get(reverse(<span class="string">'my-borrowed'</span>))</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Check our user is logged in</span></span><br><span class="line">    self.assertEqual(str(response.context[<span class="string">'user'</span>]), <span class="string">'testuser1'</span>)</span><br><span class="line">    <span class="comment"># Check that we got a response "success"</span></span><br><span class="line">    self.assertEqual(response.status_code, <span class="number">200</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Check that initially we don't have any books in list (none on loan)</span></span><br><span class="line">    self.assertTrue(<span class="string">'bookinstance_list'</span> <span class="keyword">in</span> response.context)</span><br><span class="line">    self.assertEqual(len(response.context[<span class="string">'bookinstance_list'</span>]), <span class="number">0</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Now change all books to be on loan</span></span><br><span class="line">    books = BookInstance.objects.all()[:<span class="number">10</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> book <span class="keyword">in</span> books:</span><br><span class="line">        book.status = <span class="string">'o'</span></span><br><span class="line">        book.save()</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Check that now we have borrowed books in the list</span></span><br><span class="line">    response = self.client.get(reverse(<span class="string">'my-borrowed'</span>))</span><br><span class="line">    <span class="comment"># Check our user is logged in</span></span><br><span class="line">    self.assertEqual(str(response.context[<span class="string">'user'</span>]), <span class="string">'testuser1'</span>)</span><br><span class="line">    <span class="comment"># Check that we got a response "success"</span></span><br><span class="line">    self.assertEqual(response.status_code, <span class="number">200</span>)</span><br><span class="line">    </span><br><span class="line">    self.assertTrue(<span class="string">'bookinstance_list'</span> <span class="keyword">in</span> response.context)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Confirm all books belong to testuser1 and are on loan</span></span><br><span class="line">    <span class="keyword">for</span> bookitem <span class="keyword">in</span> response.context[<span class="string">'bookinstance_list'</span>]:</span><br><span class="line">        self.assertEqual(response.context[<span class="string">'user'</span>], bookitem.borrower)</span><br><span class="line">        self.assertEqual(<span class="string">'o'</span>, bookitem.status)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_pages_ordered_by_due_date</span>(<span class="params">self</span>):</span></span><br><span class="line">    <span class="comment"># Change all books to be on loan</span></span><br><span class="line">    <span class="keyword">for</span> book <span class="keyword">in</span> BookInstance.objects.all():</span><br><span class="line">        book.status=<span class="string">'o'</span></span><br><span class="line">        book.save()</span><br><span class="line">        </span><br><span class="line">    login = self.client.login(username=<span class="string">'testuser1'</span>, password=<span class="string">'1X&lt;ISRUkw+tuK'</span>)</span><br><span class="line">    response = self.client.get(reverse(<span class="string">'my-borrowed'</span>))</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Check our user is logged in</span></span><br><span class="line">    self.assertEqual(str(response.context[<span class="string">'user'</span>]), <span class="string">'testuser1'</span>)</span><br><span class="line">    <span class="comment"># Check that we got a response "success"</span></span><br><span class="line">    self.assertEqual(response.status_code, <span class="number">200</span>)</span><br><span class="line">            </span><br><span class="line">    <span class="comment"># Confirm that of the items, only 10 are displayed due to pagination.</span></span><br><span class="line">    self.assertEqual(len(response.context[<span class="string">'bookinstance_list'</span>]), <span class="number">10</span>)</span><br><span class="line">    </span><br><span class="line">    last_date = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> book <span class="keyword">in</span> response.context[<span class="string">'bookinstance_list'</span>]:</span><br><span class="line">        <span class="keyword">if</span> last_date == <span class="number">0</span>:</span><br><span class="line">            last_date = book.due_back</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.assertTrue(last_date &lt;= book.due_back)</span><br><span class="line">            last_date = book.due_back</span><br></pre></td></tr></tbody></table></figure>
<p>You could also add pagination tests, should you so wish!</p>
<h4 id="testing-views-with-forms"><a class="markdownIt-Anchor" href="#testing-views-with-forms"></a> Testing views with forms</h4>
<p>Testing views with forms is a little more complicated than in the cases above, because you need to test more code paths: initial display, display after data validation has failed, and display after validation has succeeded. The good news is that we use the client for testing in almost exactly the same way as we did for display-only views.</p>
<p>To demonstrate, let’s write some tests for the view used to renew books (<code>renew_book_librarian()</code>):</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> catalog.forms <span class="keyword">import</span> RenewBookForm</span><br><span class="line"></span><br><span class="line"><span class="meta">@permission_required('catalog.can_mark_returned')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">renew_book_librarian</span>(<span class="params">request, pk</span>):</span></span><br><span class="line">    <span class="string">"""View function for renewing a specific BookInstance by librarian."""</span></span><br><span class="line">    book_instance = get_object_or_404(BookInstance, pk=pk)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># If this is a POST request then process the Form data</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">'POST'</span>:</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Create a form instance and populate it with data from the request (binding):</span></span><br><span class="line">        book_renewal_form = RenewBookForm(request.POST)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Check if the form is valid:</span></span><br><span class="line">        <span class="keyword">if</span> form.is_valid():</span><br><span class="line">            <span class="comment"># process the data in form.cleaned_data as required (here we just write it to the model due_back field)</span></span><br><span class="line">            book_instance.due_back = form.cleaned_data[<span class="string">'renewal_date'</span>]</span><br><span class="line">            book_instance.save()</span><br><span class="line"></span><br><span class="line">            <span class="comment"># redirect to a new URL:</span></span><br><span class="line">            <span class="keyword">return</span> HttpResponseRedirect(reverse(<span class="string">'all-borrowed'</span>))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># If this is a GET (or any other method) create the default form</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        proposed_renewal_date = datetime.date.today() + datetime.timedelta(weeks=<span class="number">3</span>)</span><br><span class="line">        book_renewal_form = RenewBookForm(initial={<span class="string">'renewal_date'</span>: proposed_renewal_date})</span><br><span class="line"></span><br><span class="line">    context = {</span><br><span class="line">        <span class="string">'book_renewal_form'</span>: book_renewal_form,</span><br><span class="line">        <span class="string">'book_instance'</span>: book_instance,</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">'catalog/book_renew_librarian.html'</span>, context)</span><br></pre></td></tr></tbody></table></figure>
<p>We’ll need to test that the view is only available to users who have the <code>can_mark_returned</code>permission, and that users are redirected to an HTTP 404 error page if they attempt to renew a <code>BookInstance</code> that does not exist. We should check that the initial value of the form is seeded with a date three weeks in the future, and that if validation succeeds we’re redirected to the “all-borrowed books” view. As part of checking the validation-fail tests we’ll also check that our form is sending the appropriate error messages.</p>
<p>Add the first part of the test class (shown below) to the bottom of <strong>test_views.py</strong>. This creates two users and two book instances, but only gives one user the permission required to access the view. The code to grant permissions during tests is shown in bold:</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> uuid</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> django.contrib.auth.models <span class="keyword">import</span> Permission <span class="comment"># Required to grant the permission needed to set a book as returned.</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RenewBookInstancesViewTest</span>(<span class="params">TestCase</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setUp</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="comment"># Create a user</span></span><br><span class="line">        test_user1 = User.objects.create_user(username=<span class="string">'testuser1'</span>, password=<span class="string">'1X&lt;ISRUkw+tuK'</span>)</span><br><span class="line">        test_user2 = User.objects.create_user(username=<span class="string">'testuser2'</span>, password=<span class="string">'2HJ1vRV0Z&amp;3iD'</span>)</span><br><span class="line"></span><br><span class="line">        test_user1.save()</span><br><span class="line">        test_user2.save()</span><br><span class="line">        </span><br><span class="line">        permission = Permission.objects.get(name=<span class="string">'Set book as returned'</span>)</span><br><span class="line">        test_user2.user_permissions.add(permission)</span><br><span class="line">        test_user2.save()</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Create a book</span></span><br><span class="line">        test_author = Author.objects.create(first_name=<span class="string">'John'</span>, last_name=<span class="string">'Smith'</span>)</span><br><span class="line">        test_genre = Genre.objects.create(name=<span class="string">'Fantasy'</span>)</span><br><span class="line">        test_language = Language.objects.create(name=<span class="string">'English'</span>)</span><br><span class="line">        test_book = Book.objects.create(</span><br><span class="line">            title=<span class="string">'Book Title'</span>,</span><br><span class="line">            summary=<span class="string">'My book summary'</span>,</span><br><span class="line">            isbn=<span class="string">'ABCDEFG'</span>,</span><br><span class="line">            author=test_author,</span><br><span class="line">            language=test_language,</span><br><span class="line">        )</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Create genre as a post-step</span></span><br><span class="line">        genre_objects_for_book = Genre.objects.all()</span><br><span class="line">        test_book.genre.set(genre_objects_for_book) <span class="comment"># Direct assignment of many-to-many types not allowed.</span></span><br><span class="line">        test_book.save()</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Create a BookInstance object for test_user1</span></span><br><span class="line">        return_date = datetime.date.today() + datetime.timedelta(days=<span class="number">5</span>)</span><br><span class="line">        self.test_bookinstance1 = BookInstance.objects.create(</span><br><span class="line">            book=test_book,</span><br><span class="line">            imprint=<span class="string">'Unlikely Imprint, 2016'</span>,</span><br><span class="line">            due_back=return_date,</span><br><span class="line">            borrower=test_user1,</span><br><span class="line">            status=<span class="string">'o'</span>,</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Create a BookInstance object for test_user2</span></span><br><span class="line">        return_date = datetime.date.today() + datetime.timedelta(days=<span class="number">5</span>)</span><br><span class="line">        self.test_bookinstance2 = BookInstance.objects.create(</span><br><span class="line">            book=test_book,</span><br><span class="line">            imprint=<span class="string">'Unlikely Imprint, 2016'</span>,</span><br><span class="line">            due_back=return_date,</span><br><span class="line">            borrower=test_user2,</span><br><span class="line">            status=<span class="string">'o'</span>,</span><br><span class="line">        )</span><br></pre></td></tr></tbody></table></figure>
<p>Add the following tests to the bottom of the test class. These check that only users with the correct permissions (<em>testuser2</em>) can access the view. We check all the cases: when the user is not logged in, when a user is logged in but does not have the correct permissions, when the user has permissions but is not the borrower (should succeed), and what happens when they try to access a <code>BookInstance</code> that doesn’t exist. We also check that the correct template is used.</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_redirect_if_not_logged_in</span>(<span class="params">self</span>):</span></span><br><span class="line">        response = self.client.get(reverse(<span class="string">'renew-book-librarian'</span>, kwargs={<span class="string">'pk'</span>: self.test_bookinstance1.pk}))</span><br><span class="line">        <span class="comment"># Manually check redirect (Can't use assertRedirect, because the redirect URL is unpredictable)</span></span><br><span class="line">        self.assertEqual(response.status_code, <span class="number">302</span>)</span><br><span class="line">        self.assertTrue(response.url.startswith(<span class="string">'/accounts/login/'</span>))</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_redirect_if_logged_in_but_not_correct_permission</span>(<span class="params">self</span>):</span></span><br><span class="line">        login = self.client.login(username=<span class="string">'testuser1'</span>, password=<span class="string">'1X&lt;ISRUkw+tuK'</span>)</span><br><span class="line">        response = self.client.get(reverse(<span class="string">'renew-book-librarian'</span>, kwargs={<span class="string">'pk'</span>: self.test_bookinstance1.pk}))</span><br><span class="line">        self.assertEqual(response.status_code, <span class="number">403</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_logged_in_with_permission_borrowed_book</span>(<span class="params">self</span>):</span></span><br><span class="line">        login = self.client.login(username=<span class="string">'testuser2'</span>, password=<span class="string">'2HJ1vRV0Z&amp;3iD'</span>)</span><br><span class="line">        response = self.client.get(reverse(<span class="string">'renew-book-librarian'</span>, kwargs={<span class="string">'pk'</span>: self.test_bookinstance2.pk}))</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Check that it lets us login - this is our book and we have the right permissions.</span></span><br><span class="line">        self.assertEqual(response.status_code, <span class="number">200</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_logged_in_with_permission_another_users_borrowed_book</span>(<span class="params">self</span>):</span></span><br><span class="line">        login = self.client.login(username=<span class="string">'testuser2'</span>, password=<span class="string">'2HJ1vRV0Z&amp;3iD'</span>)</span><br><span class="line">        response = self.client.get(reverse(<span class="string">'renew-book-librarian'</span>, kwargs={<span class="string">'pk'</span>: self.test_bookinstance1.pk}))</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Check that it lets us login. We're a librarian, so we can view any users book</span></span><br><span class="line">        self.assertEqual(response.status_code, <span class="number">200</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_HTTP404_for_invalid_book_if_logged_in</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="comment"># unlikely UID to match our bookinstance!</span></span><br><span class="line">        test_uid = uuid.uuid4()</span><br><span class="line">        login = self.client.login(username=<span class="string">'testuser2'</span>, password=<span class="string">'2HJ1vRV0Z&amp;3iD'</span>)</span><br><span class="line">        response = self.client.get(reverse(<span class="string">'renew-book-librarian'</span>, kwargs={<span class="string">'pk'</span>:test_uid}))</span><br><span class="line">        self.assertEqual(response.status_code, <span class="number">404</span>)</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_uses_correct_template</span>(<span class="params">self</span>):</span></span><br><span class="line">        login = self.client.login(username=<span class="string">'testuser2'</span>, password=<span class="string">'2HJ1vRV0Z&amp;3iD'</span>)</span><br><span class="line">        response = self.client.get(reverse(<span class="string">'renew-book-librarian'</span>, kwargs={<span class="string">'pk'</span>: self.test_bookinstance1.pk}))</span><br><span class="line">        self.assertEqual(response.status_code, <span class="number">200</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Check we used correct template</span></span><br><span class="line">        self.assertTemplateUsed(response, <span class="string">'catalog/book_renew_librarian.html'</span>)</span><br></pre></td></tr></tbody></table></figure>
<p>Add the next test method, as shown below. This checks that the initial date for the form is three weeks in the future. Note how we are able to access the value of the initial value of the form field (shown in bold).</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_form_renewal_date_initially_has_date_three_weeks_in_future</span>(<span class="params">self</span>):</span></span><br><span class="line">    login = self.client.login(username=<span class="string">'testuser2'</span>, password=<span class="string">'2HJ1vRV0Z&amp;3iD'</span>)</span><br><span class="line">    response = self.client.get(reverse(<span class="string">'renew-book-librarian'</span>, kwargs={<span class="string">'pk'</span>: self.test_bookinstance1.pk}))</span><br><span class="line">    self.assertEqual(response.status_code, <span class="number">200</span>)</span><br><span class="line">    </span><br><span class="line">    date_3_weeks_in_future = datetime.date.today() + datetime.timedelta(weeks=<span class="number">3</span>)</span><br><span class="line">    self.assertEqual(response.context[<span class="string">'form'</span>].initial[<span class="string">'renewal_date'</span>], date_3_weeks_in_future)</span><br></pre></td></tr></tbody></table></figure>
<p>If you use the form class <code>RenewBookModelForm(forms.ModelForm)</code> instead of class <code>RenewBookForm(forms.Form)</code>, then the form field name is <strong>‘due_back’</strong> instead of <strong>‘renewal_date’</strong>.</p>
<p>The next test (add this to the class too) checks that the view redirects to a list of all borrowed books if renewal succeeds. What differs here is that for the first time we show how you can <code>POST</code> data using the client. The post <em>data</em> is the second argument to the post function, and is specified as a dictionary of key/values.</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_redirects_to_all_borrowed_book_list_on_success</span>(<span class="params">self</span>):</span></span><br><span class="line">    login = self.client.login(username=<span class="string">'testuser2'</span>, password=<span class="string">'2HJ1vRV0Z&amp;3iD'</span>)</span><br><span class="line">    valid_date_in_future = datetime.date.today() + datetime.timedelta(weeks=<span class="number">2</span>)</span><br><span class="line">    response = self.client.post(reverse(<span class="string">'renew-book-librarian'</span>, kwargs={<span class="string">'pk'</span>:self.test_bookinstance1.pk,}), {<span class="string">'renewal_date'</span>:valid_date_in_future})</span><br><span class="line">    self.assertRedirects(response, reverse(<span class="string">'all-borrowed'</span>))</span><br></pre></td></tr></tbody></table></figure>
<p>The <em>all-borrowed</em> view was added as a <em>challenge</em>, and your code may instead redirect to the home page ‘/’. If so, modify the last two lines of the test code to be like the code below. The <code>follow=True</code> in the request ensures that the request returns the final destination URL (hence checking <code>/catalog/</code> rather than <code>/</code>).</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">response = self.client.post(reverse('renew-book-librarian', kwargs={'pk':self.test_bookinstance1.pk,}), {'renewal_date':valid_date_in_future}, follow=True )</span><br><span class="line"> self.assertRedirects(response, '/catalog/')</span><br></pre></td></tr></tbody></table></figure>
<p>Copy the last two functions into the class, as seen below. These again test <code>POST</code> requests, but in this case with invalid renewal dates. We use <code>assertFormError()</code>to verify that the error messages are as expected.</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_form_invalid_renewal_date_past</span>(<span class="params">self</span>):</span></span><br><span class="line">    login = self.client.login(username=<span class="string">'testuser2'</span>, password=<span class="string">'2HJ1vRV0Z&amp;3iD'</span>)</span><br><span class="line">    date_in_past = datetime.date.today() - datetime.timedelta(weeks=<span class="number">1</span>)</span><br><span class="line">    response = self.client.post(reverse(<span class="string">'renew-book-librarian'</span>, kwargs={<span class="string">'pk'</span>: self.test_bookinstance1.pk}), {<span class="string">'renewal_date'</span>: date_in_past})</span><br><span class="line">    self.assertEqual(response.status_code, <span class="number">200</span>)</span><br><span class="line">    self.assertFormError(response, <span class="string">'form'</span>, <span class="string">'renewal_date'</span>, <span class="string">'Invalid date - renewal in past'</span>)</span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_form_invalid_renewal_date_future</span>(<span class="params">self</span>):</span></span><br><span class="line">    login = self.client.login(username=<span class="string">'testuser2'</span>, password=<span class="string">'2HJ1vRV0Z&amp;3iD'</span>)</span><br><span class="line">    invalid_date_in_future = datetime.date.today() + datetime.timedelta(weeks=<span class="number">5</span>)</span><br><span class="line">    response = self.client.post(reverse(<span class="string">'renew-book-librarian'</span>, kwargs={<span class="string">'pk'</span>: self.test_bookinstance1.pk}), {<span class="string">'renewal_date'</span>: invalid_date_in_future})</span><br><span class="line">    self.assertEqual(response.status_code, <span class="number">200</span>)</span><br><span class="line">    self.assertFormError(response, <span class="string">'form'</span>, <span class="string">'renewal_date'</span>, <span class="string">'Invalid date - renewal more than 4 weeks ahead'</span>)</span><br></pre></td></tr></tbody></table></figure>
<p>The same sorts of techniques can be used to test the other view.</p>
<h3 id="templates"><a class="markdownIt-Anchor" href="#templates"></a> Templates</h3>
<p>Django provides test APIs to check that the correct template is being called by your views, and to allow you to verify that the correct information is being sent. There is however no specific API support for testing in Django that your HTML output is rendered as expected.</p>
<h2 id="references"><a class="markdownIt-Anchor" href="#references"></a> REFERENCES</h2>
<p>Django’s test framework can help you write effective unit and integration tests — we’ve only scratched the surface of what the underlying <strong>unittest</strong> framework can do, let alone Django’s additions (for example, check out how you can use <a target="_blank" rel="noopener" href="https://docs.python.org/3.5/library/unittest.mock-examples.html">unittest.mock</a> to patch third party libraries so you can more thoroughly test your own code).</p>
<p>While there are numerous other test tools that you can use, we’ll just highlight two:</p>
<ul>
<li>
<p><a target="_blank" rel="noopener" href="http://coverage.readthedocs.io/en/latest/">Coverage</a>: This Python tool reports on how much of your code is actually executed by your tests. It is particularly useful when you’re getting started, and you are trying to work out exactly what you should test.</p>
</li>
<li>
<p><a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Learn/Tools_and_testing/Cross_browser_testing/Your_own_automation_environment">Selenium</a> is a framework to automate testing in a real browser. It allows you to simulate a real user interacting with the site, and provides a great framework for system testing your site (the next step up from integration testing).</p>
</li>
<li>
<p><a target="_blank" rel="noopener" href="https://docs.djangoproject.com/en/3.1/topics/testing/overview/">https://docs.djangoproject.com/en/3.1/topics/testing/overview/</a></p>
</li>
<li>
<p><a target="_blank" rel="noopener" href="https://docs.djangoproject.com/en/3.1/intro/tutorial05/">https://docs.djangoproject.com/en/3.1/intro/tutorial05/</a></p>
</li>
<li>
<p><a target="_blank" rel="noopener" href="https://docs.djangoproject.com/en/3.1/topics/testing/tools/">https://docs.djangoproject.com/en/3.1/topics/testing/tools/</a></p>
</li>
<li>
<p><a target="_blank" rel="noopener" href="https://docs.djangoproject.com/en/3.1/topics/testing/advanced/">https://docs.djangoproject.com/en/3.1/topics/testing/advanced/</a></p>
</li>
</ul>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">Joaxin</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="https://u.pinsflora.xyz/Pysnista/Django/dj_intro10_testing/">https://u.pinsflora.xyz/Pysnista/Django/dj_intro10_testing/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Django/">Django</a></div><div class="post_share"><div class="addtoany"><div class="a2a_kit a2a_kit_size_32 a2a_default_style"><a class="a2a_button_facebook"></a><a class="a2a_button_twitter"></a><a class="a2a_button_wechat"></a><a class="a2a_button_sina_weibo"></a><a class="a2a_button_facebook_messenger"></a><a class="a2a_button_email"></a><a class="a2a_button_copy_link"></a><a class="a2a_dd" target="_blank" rel="noopener" href="https://www.addtoany.com/share"></a></div></div><script async="async" src="https://static.addtoany.com/menu/page.js"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/Pysnista/Django/dj_intro8_Users/"><img class="prev-cover" src="https://cdn.jsdelivr.net/gh/joaxin/img_bed/img/cover/cover_forests.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">Django Introduction Part9 - User authentication and permissions</div></div></a></div><div class="next-post pull-right"><a href="/Pysnista/Django/dj_intro9_forms/"><img class="next-cover" src="https://cdn.jsdelivr.net/gh/joaxin/img_bed/img/cover/cover_erol-ahmed-unsplash.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">Django Introduction Part9 - Working with forms</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span> Related Articles</span></div><div class="relatedPosts-list"><div><a href="/Pysnista/Django/dj_FAQ/" title="Django FAQ"><img class="cover" src="https://cdn.jsdelivr.net/gh/joaxin/img_bed/img/cover/cover_grass_in_the_snow.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="fas fa-history fa-fw"></i> 2020-09-05</div><div class="title">Django FAQ</div></div></a></div><div><a href="/Pysnista/Django/dj_intro3_dbs/" title="Django Introduction Part3 - Database"><img class="cover" src="https://cdn.jsdelivr.net/gh/joaxin/img_bed/img/cover/cover_writting_letter.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="fas fa-history fa-fw"></i> 2020-09-05</div><div class="title">Django Introduction Part3 - Database</div></div></a></div><div><a href="/Pysnista/Django/dj_intro4_admin/" title="Django Introduction Part4 - Admin"><img class="cover" src="https://cdn.jsdelivr.net/gh/joaxin/img_bed/img/cover/cover_tree_dawnlights.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="fas fa-history fa-fw"></i> 2020-08-05</div><div class="title">Django Introduction Part4 - Admin</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> Comment</span></div></div><div class="comment-wrap"><div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-info-avatar is-center"><img class="avatar-img" src="https://avatars2.githubusercontent.com/u/8346164?s=460&amp;v=4" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-info__name">Joaxin</div><div class="author-info__description">When I close my eyes, I'm in my own ♡cean 🐟aves.</div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">340</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">Tags</div><div class="length-num">110</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">Categories</div><div class="length-num">34</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/joaxin"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/joaxin" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:lotility@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a><a class="social-icon" href="/atom.xml" target="_blank" title="RSS"><i class="fas fa-rss"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>Announcement</span></div><div class="announcement_content">感謝訪問本站，若喜歡請收藏 ^_^</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Catalog</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#overview"><span class="toc-number">1.</span> <span class="toc-text"> Overview</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#types-of-testing"><span class="toc-number">1.1.</span> <span class="toc-text"> Types of testing</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#what-does-django-provide-for-testing"><span class="toc-number">1.2.</span> <span class="toc-text"> What does Django provide for testing?</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#test-structure-overview"><span class="toc-number">2.</span> <span class="toc-text"> Test structure overview</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#how-to-run-the-tests"><span class="toc-number">3.</span> <span class="toc-text"> How to run the tests</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#practical-examples"><span class="toc-number">4.</span> <span class="toc-text"> Practical examples</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#models"><span class="toc-number">4.1.</span> <span class="toc-text"> Models</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#forms"><span class="toc-number">4.2.</span> <span class="toc-text"> Forms</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#views"><span class="toc-number">4.3.</span> <span class="toc-text"> Views</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#views-that-are-restricted-to-logged-in-users"><span class="toc-number">4.3.1.</span> <span class="toc-text"> Views that are restricted to logged in users</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#testing-views-with-forms"><span class="toc-number">4.3.2.</span> <span class="toc-text"> Testing views with forms</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#templates"><span class="toc-number">4.4.</span> <span class="toc-text"> Templates</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#references"><span class="toc-number">5.</span> <span class="toc-text"> REFERENCES</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/Lang/es/duo_es/" title="No title"><img src="https://cdn.jsdelivr.net/gh/joaxin/img_bed/img/cover/cover_seeds.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="No title"/></a><div class="content"><a class="title" href="/Lang/es/duo_es/" title="No title">No title</a><time datetime="2020-06-29T03:44:49.224Z" title="Created 2020-06-29 11:44:49">2020-06-29</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/Lang/kl/duo_kl001_intro/" title="Klingon- Vol.1 - Introduction"><img src="https://cdn.jsdelivr.net/gh/joaxin/img_bed/img/cover/cover_little_girl_phone.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Klingon- Vol.1 - Introduction"/></a><div class="content"><a class="title" href="/Lang/kl/duo_kl001_intro/" title="Klingon- Vol.1 - Introduction">Klingon- Vol.1 - Introduction</a><time datetime="2020-06-26T16:00:00.000Z" title="Created 2020-06-27 00:00:00">2020-06-27</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/Life/apps/life_apps_android_list/" title="安卓 | 装机必备清单及习惯步骤"><img src="https://i.postimg.cc/KYPmhV8w/android-new-logo.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="安卓 | 装机必备清单及习惯步骤"/></a><div class="content"><a class="title" href="/Life/apps/life_apps_android_list/" title="安卓 | 装机必备清单及习惯步骤">安卓 | 装机必备清单及习惯步骤</a><time datetime="2020-06-20T04:29:10.462Z" title="Created 2020-06-20 12:29:10">2020-06-20</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/Pysnista/Intro/files/py_pillow/" title="Python - 操作图像"><img src="https://cdn.jsdelivr.net/gh/joaxin/img_bed/img/cover/cover_little_girl_phone.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Python - 操作图像"/></a><div class="content"><a class="title" href="/Pysnista/Intro/files/py_pillow/" title="Python - 操作图像">Python - 操作图像</a><time datetime="2020-05-02T16:00:00.000Z" title="Created 2020-05-03 00:00:00">2020-05-03</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/Pysnista/Intro/files/py_files_pdf_word/" title="Python - PDF &amp; Word"><img src="https://i.loli.net/2020/07/09/6ALoRXnITgcuvy2.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Python - PDF &amp; Word"/></a><div class="content"><a class="title" href="/Pysnista/Intro/files/py_files_pdf_word/" title="Python - PDF &amp; Word">Python - PDF &amp; Word</a><time datetime="2020-04-12T16:00:00.000Z" title="Created 2020-04-13 00:00:00">2020-04-13</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://cdn.jsdelivr.net/gh/joaxin/img_bed/img/cover/cover_writting_letter.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2021 By Joaxin</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">Refine, the Life</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="font-plus" type="button" title="Increase font size"><i class="fas fa-plus"></i></button><button id="font-minus" type="button" title="Decrease font size"><i class="fas fa-minus"></i></button><button id="translateLink" type="button" title="Switch Between Traditional Chinese And Simplified Chinese">繁</button><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle between single-column and double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><button id="chat_btn" type="button" title="rightside.chat_btn"><i class="fas fa-sms"></i></button><a id="to_comment" href="#post-comment" title="Scroll To Comments"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="Back To Top"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">Local search</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts" type="text"/></div></div></div><hr/><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>if (document.getElementsByClassName('mermaid').length) {
  if (window.mermaidJsLoad) mermaid.init()
  else {
    getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(() => {
      window.mermaidJsLoad = true
      mermaid.initialize({
        theme: 'default',
      })
      false && mermaid.init()
    })
  }
}</script></div><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="fasle"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script>(function(i,s,o,g,r,a,m){i["DaoVoiceObject"]=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;a.charset="utf-8";m.parentNode.insertBefore(a,m)})(window,document,"script",('https:' == document.location.protocol ? 'https:' : 'http:') + "//widget.daovoice.io/widget/fae45343.js","daovoice")
</script><script>var isChatBtn = true
daovoice('init', {
  app_id: 'fae45343',},{
  launcher: { 
     disableLauncherIcon: isChatBtn // 悬浮 ICON 是否显示
  },
});
daovoice('update');

if (isChatBtn) {
  var chatBtnFn = () => {
    var chatBtn = document.getElementById("chat_btn")
    chatBtn.addEventListener("click", function(){
      daovoice('show')
    });
  }
  chatBtnFn()
} else {
  if (true) {
    function chatBtnHide () {
      daovoice('update', {},{
        launcher: { 
        disableLauncherIcon: true // 悬浮 ICON 是否显示
        },
      });
    }
    function chatBtnShow () {
      daovoice('update', {},{
        launcher: { 
        disableLauncherIcon: false // 悬浮 ICON 是否显示
        },
      });
    }
  }
}</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>