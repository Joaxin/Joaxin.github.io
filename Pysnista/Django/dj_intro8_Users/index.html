<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Django Introduction Part9 - User authentication and permissions | Pinsflora</title><meta name="keywords" content="Django"><meta name="author" content="Joaxin"><meta name="copyright" content="Joaxin"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Django provides an authentication and authorization (“permission”) system that allows you to verify user credentials and define what actions each user is allowed to perform. The framework includes bui">
<meta property="og:type" content="article">
<meta property="og:title" content="Django Introduction Part9 - User authentication and permissions">
<meta property="og:url" content="https://u.pinsflora.xyz/Pysnista/Django/dj_intro8_Users/index.html">
<meta property="og:site_name" content="Pinsflora">
<meta property="og:description" content="Django provides an authentication and authorization (“permission”) system that allows you to verify user credentials and define what actions each user is allowed to perform. The framework includes bui">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/joaxin/img_bed/img/cover/cover_forests.jpg">
<meta property="article:published_time" content="2018-01-23T16:00:00.000Z">
<meta property="article:modified_time" content="2020-09-04T16:00:00.000Z">
<meta property="article:author" content="Joaxin">
<meta property="article:tag" content="Django">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/joaxin/img_bed/img/cover/cover_forests.jpg"><link rel="shortcut icon" href="/img/favicon-32x32.png"><link rel="canonical" href="https://u.pinsflora.xyz/Pysnista/Django/dj_intro8_Users/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//www.google-analytics.com" crossorigin=""/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><script async="async" src="https://www.googletagmanager.com/gtag/js?id=UA-177831205-1"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-177831205-1');
</script><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"We didn't find any results for the search: ${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: {"limitDay":600,"position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: 'days',
  date_suffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"Traditional Chinese Activated Manually","cht_to_chs":"Simplified Chinese Activated Manually","day_to_night":"Dark Mode Activated Manually","night_to_day":"Light Mode Activated Manually","bgLight":"#49b1f5","bgDark":"#2d3035","position":"bottom-left"},
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2020-09-05 00:00:00'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const fontSizeVal = saveToLocal.get('global-font-size')
    if (fontSizeVal !== undefined) {
      document.documentElement.style.setProperty('--global-font-size', fontSizeVal + 'px')
    }
    })(window)</script><meta name="generator" content="Hexo 5.3.0"><link rel="alternate" href="/atom.xml" title="Pinsflora" type="application/atom+xml">
</head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" src="https://avatars2.githubusercontent.com/u/8346164?s=460&amp;v=4" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">340</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">Tags</div><div class="length-num">110</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">Categories</div><div class="length-num">34</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fa fa-list"></i><span> List</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/Galleries"><i class="fa-fw /gallery/"></i><span> 0</span></a></li><li><a class="site-page child" href="/Movie"><i class="fa-fw /movies/"></i><span> 1</span></a></li><li><a class="site-page child" href="/Games"><i class="fa-fw /games/"></i><span> 2</span></a></li><li><a class="site-page child" href="/Tools"><i class="fa-fw /tools/"></i><span> 3</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://cdn.jsdelivr.net/gh/joaxin/img_bed/img/cover/cover_forests.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Pinsflora</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> Search</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fa fa-list"></i><span> List</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/Galleries"><i class="fa-fw /gallery/"></i><span> 0</span></a></li><li><a class="site-page child" href="/Movie"><i class="fa-fw /movies/"></i><span> 1</span></a></li><li><a class="site-page child" href="/Games"><i class="fa-fw /games/"></i><span> 2</span></a></li><li><a class="site-page child" href="/Tools"><i class="fa-fw /tools/"></i><span> 3</span></a></li></ul></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Django Introduction Part9 - User authentication and permissions</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2018-01-23T16:00:00.000Z" title="Created 2018-01-24 00:00:00">2018-01-24</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2020-09-04T16:00:00.000Z" title="Updated 2020-09-05 00:00:00">2020-09-05</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Python/">Python</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Python/Django/">Django</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">Word count:</span><span class="word-count">3.4k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">Reading time:</span><span>21min</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Django Introduction Part9 - User authentication and permissions"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post View:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p>Django provides an authentication and authorization (“permission”) system that allows you to verify user credentials and define what actions each user is allowed to perform. The framework includes built-in models for <code>Users</code> and <code>Groups</code> (a generic way of applying permissions to more than one user at a time), permissions/flags that designate whether a user may perform a task, forms and views for logging in users, and view tools for restricting content.</p>
<p>The authentication system is very flexible, and you can build up your URLs, forms, views, and templates from scratch if you like, just calling the provided API to log in the user.</p>
<h2 id="enabling-authentication"><a class="markdownIt-Anchor" href="#enabling-authentication"></a> Enabling authentication</h2>
<p>The authentication was enabled automatically  so you don’t need to do anything more at this point.</p>
<p><strong>Note</strong>: The necessary configuration was all done for us when we created the app using the <code>django-admin startproject</code> command. The database tables for users and model permissions were created when we first called <code>python manage.py migrate</code>.</p>
<p>The configuration is set up in the <code>INSTALLED_APPS</code> and <code>MIDDLEWARE</code> sections of the project file, as shown below:</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">INSTALLED_APPS = [</span><br><span class="line">    ...</span><br><span class="line">    <span class="string">'django.contrib.auth'</span>,  <span class="comment">## Core authentication framework and its default models.</span></span><br><span class="line">    <span class="string">'django.contrib.contenttypes'</span>,  <span class="comment">## Django content type system (allows permissions to be associated with models).</span></span><br><span class="line">    ....</span><br><span class="line"></span><br><span class="line">MIDDLEWARE = [</span><br><span class="line">    ...</span><br><span class="line">    <span class="string">'django.contrib.sessions.middleware.SessionMiddleware'</span>,  <span class="comment">## Manages sessions across requests</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="string">'django.contrib.auth.middleware.AuthenticationMiddleware'</span>,  <span class="comment">## Associates users with requests using sessions.</span></span><br><span class="line">    ....</span><br></pre></td></tr></tbody></table></figure>
<h2 id="creating-users-and-groups"><a class="markdownIt-Anchor" href="#creating-users-and-groups"></a> Creating users and groups</h2>
<p>Coz our superuser is already authenticated and has all permissions, so we’ll need to create a test user to represent a normal site user.</p>
<p>Note: You can also create users programmatically, as shown below. You would have to do this, for example, if developing an interface to allow users to create their own logins (you shouldn’t give users access to the admin site).</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib.auth.models <span class="keyword">import</span> User</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create user and save to the database</span></span><br><span class="line">user = User.objects.create_user(<span class="string">'myusername'</span>, <span class="string">'test@test.com'</span>, <span class="string">'mypassword'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Update fields and then save again</span></span><br><span class="line">user.first_name = <span class="string">'Arirl'</span></span><br><span class="line">user.last_name = <span class="string">'Kyzie'</span></span><br><span class="line">user.save()</span><br></pre></td></tr></tbody></table></figure>
<p>Below we’ll first create a group and then a user. Even though we don’t have any permissions to add for our library members yet, if we need to later, it will be much easier to add them once to the group than individually to each member.</p>
<p>Start the development server and navigate to the admin site in your local web browser (<a target="_blank" rel="noopener" href="http://127.0.0.1:8000/admin/">http://127.0.0.1:8000/admin/</a>). Login to the site using the credentials for your superuser account. The top level of the Admin site displays all of your models, sorted by “Django application”. From the <strong>Authentication and Authorisation</strong> section, you can click the <strong>Users</strong> or <strong>Groups</strong> links to see their existing records.</p>
<h2 id="setting-up-your-authentication-views"><a class="markdownIt-Anchor" href="#setting-up-your-authentication-views"></a> Setting up your authentication views</h2>
<p>Django provides almost everything you need to create authentication pages to handle login, log out, and password management “out of the box”. This includes a URL mapper, views and forms, but it does not include the templates — we have to create our own!</p>
<p>Add the following to the bottom of the project <a target="_blank" rel="noopener" href="http://urls.py">urls.py</a> file:</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Add Django site authentication urls (for login, logout, password management)</span></span><br><span class="line">urlpatterns += [</span><br><span class="line">    path(<span class="string">'accounts/'</span>, include(<span class="string">'django.contrib.auth.urls'</span>)),</span><br><span class="line">]</span><br></pre></td></tr></tbody></table></figure>
<p>Navigate to the <a target="_blank" rel="noopener" href="http://127.0.0.1:8000/accounts/">http://127.0.0.1:8000/accounts/</a> URL (note the trailing forward slash!) and Django will show an error that it could not find this URL, and listing all the URLs it tried. From this you can see the URLs that will work, for example:</p>
<p><strong>Note:</strong> Using the above method adds the following URLs with names in square brackets, which can be used to reverse the URL mappings. You don’t have to implement anything else — the above URL mapping automatically maps the below mentioned URLs.</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">accounts/ login/ [name=<span class="string">'login'</span>]</span><br><span class="line">accounts/ logout/ [name=<span class="string">'logout'</span>]</span><br><span class="line">accounts/ password_change/ [name=<span class="string">'password_change'</span>]</span><br><span class="line">accounts/ password_change/done/ [name=<span class="string">'password_change_done'</span>]</span><br><span class="line">accounts/ password_reset/ [name=<span class="string">'password_reset'</span>]</span><br><span class="line">accounts/ password_reset/done/ [name=<span class="string">'password_reset_done'</span>]</span><br><span class="line">accounts/ reset/&lt;uidb64&gt;/&lt;token&gt;/ [name=<span class="string">'password_reset_confirm'</span>]</span><br><span class="line">accounts/ reset/done/ [name=<span class="string">'password_reset_complete'</span>]</span><br></pre></td></tr></tbody></table></figure>
<p>Now try to navigate to the login URL (<a target="_blank" rel="noopener" href="http://127.0.0.1:8000/accounts/login/">http://127.0.0.1:8000/accounts/login/</a>). This will fail again, but with an error that tells you that we’re missing the required template (<strong>registration/login.html</strong>) on the template search path. You’ll see the following lines listed in the yellow section up the top:</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Exception Type:    TemplateDoesNotExist</span><br><span class="line">Exception Value:    registration/login.html</span><br></pre></td></tr></tbody></table></figure>
<p>The next step is to create a registration directory on the search path and then add the <strong>login.html</strong> file.</p>
<h3 id="template-directory"><a class="markdownIt-Anchor" href="#template-directory"></a> Template directory</h3>
<p>The URLs (and implicitly views) that we just added expect to find their associated templates in a directory <strong>/registration/</strong> somewhere in the templates search path.</p>
<p>For this site, we’ll put our HTML pages in the <strong>templates/registration/</strong> project directory.</p>
<p>To make these directories visible to the template loader (i.e. to put this directory in the template search path) open the project settings, and update the <code>TEMPLATES</code> section’s <code>'DIRS'</code> line as shown.</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">TEMPLATES = [</span><br><span class="line">    {</span><br><span class="line">        ...</span><br><span class="line">        <span class="string">'DIRS'</span>: [os.path.join(BASE_DIR, <span class="string">'templates'</span>)],</span><br><span class="line">        <span class="string">'APP_DIRS'</span>: <span class="literal">True</span>,</span><br><span class="line">        ...</span><br></pre></td></tr></tbody></table></figure>
<h3 id="login-template"><a class="markdownIt-Anchor" href="#login-template"></a> Login template</h3>
<p><strong>Important</strong>: The authentication templates provided in this article are a very basic/slightly modified version of the Django demonstration login templates. You may need to customise them for your own use!</p>
<p>Create a new <strong>templates/registration/login.html</strong> file and give it the following contents:</p>
<figure class="highlight django"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="template-tag">{% <span class="name"><span class="name">extends</span></span> "movie_base.html" %}</span></span><br><span class="line"></span><br><span class="line"><span class="template-tag">{% <span class="name"><span class="name">block</span></span> content %}</span></span><br><span class="line"></span><br><span class="line"><span class="template-tag">{% <span class="name"><span class="name">if</span></span> form.errors %}</span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>Your username and password didn't match. Please try again.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="template-tag">{% <span class="name"><span class="name">endif</span></span> %}</span></span><br><span class="line"></span><br><span class="line"><span class="template-tag">{% <span class="name"><span class="name">if</span></span> next %}</span></span><br><span class="line"><span class="xml">  </span><span class="template-tag">{% <span class="name"><span class="name">if</span></span> user.is_authenticated %}</span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>Your account doesn't have access to this page. To proceed,</span></span><br><span class="line"><span class="xml">    please login with an account that has access.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml">  </span><span class="template-tag">{% <span class="name"><span class="name">else</span></span> %}</span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>Please login to see this page.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml">  </span><span class="template-tag">{% <span class="name"><span class="name">endif</span></span> %}</span></span><br><span class="line"><span class="template-tag">{% <span class="name"><span class="name">endif</span></span> %}</span></span><br><span class="line"></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">"post"</span> <span class="attr">action</span>=<span class="string">"</span></span></span><span class="template-tag">{% <span class="name"><span class="name">url</span></span> 'login' %}</span><span class="xml"><span class="tag"><span class="string">"</span>&gt;</span></span></span><br><span class="line"><span class="template-tag">{% <span class="name"><span class="name">csrf_token</span></span> %}</span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">table</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">tr</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><span class="template-variable">{{ form.username.label_tag }}</span><span class="xml"><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><span class="template-variable">{{ form.username }}</span><span class="xml"><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">tr</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><span class="template-variable">{{ form.password.label_tag }}</span><span class="xml"><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><span class="template-variable">{{ form.password }}</span><span class="xml"><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"login"</span> /&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"next"</span> <span class="attr">value</span>=<span class="string">"</span></span></span><span class="template-variable">{{ next }}</span><span class="xml"><span class="tag"><span class="string">"</span> /&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">{# Assumes you setup the password_reset view in your URLconf #}</span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"</span></span></span><span class="template-tag">{% <span class="name"><span class="name">url</span></span> 'password_reset' %}</span><span class="xml"><span class="tag"><span class="string">"</span>&gt;</span>Lost password?<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="template-tag">{% <span class="name"><span class="name">endblock</span></span> %}</span></span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>When the user is not logged in, <code>request.user/user</code> also exists, which is an instance of the <code>AnonymousUser</code> class. The best way to determine whether the current user is logged in is to determine the <code>is_authenticated</code> read-only attribute of the User object.</p>
</blockquote>
<p>If you try to log in that will succeed and you’ll be redirected to another page (by default this will be <a target="_blank" rel="noopener" href="http://127.0.0.1:8000/accounts/profile/">http://127.0.0.1:8000/accounts/profile/</a>). The problem here is that, by default, Django expects that after login you will want to be taken to a profile page, which may or may not be the case. As you haven’t defined this page yet, you’ll get another error!</p>
<p>Open the project settings and add the text below to the bottom. Now when you log in you should be redirected to the site homepage by default.</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Redirect to home URL after login (Default redirects to /accounts/profile/)</span></span><br><span class="line">LOGIN_REDIRECT_URL = <span class="string">'/'</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="logout-template"><a class="markdownIt-Anchor" href="#logout-template"></a> Logout template</h3>
<p>If you navigate to the logout URL (<a target="_blank" rel="noopener" href="http://127.0.0.1:8000/accounts/logout/">http://127.0.0.1:8000/accounts/logout/</a>) then you’ll see some odd behaviour — your user will be logged out sure enough, but you’ll be taken to the <strong>Admin</strong> logout page. That’s not what you want, if only because the login link on that page takes you to the Admin login screen (and that is only available to users who have the <code>is_staff</code> permission).</p>
<p>Create and open /<strong>templates/registration/logged_out.html</strong>. Copy in the text below:</p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">{% extends "movie_base.html" %}</span><br><span class="line"></span><br><span class="line">{% block content %}</span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>Logged out!<span class="tag">&lt;/<span class="name">p</span>&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"{% url 'login'%}"</span>&gt;</span>Click here to login again.<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">{% endblock %}</span><br></pre></td></tr></tbody></table></figure>
<p>This template is very simple. It just displays a message informing you that you have been logged out, and provides a link that you can press to go back to the login screen.</p>
<h3 id="password-reset-templates"><a class="markdownIt-Anchor" href="#password-reset-templates"></a> Password reset templates</h3>
<p>The default password reset system uses email to send the user a reset link. You need to create forms to get the user’s email address, send the email, allow them to enter a new password, and to note when the whole process is complete.</p>
<p>The following templates can be used as a starting point.</p>
<h4 id="password-reset-form"><a class="markdownIt-Anchor" href="#password-reset-form"></a> Password reset form</h4>
<p>This is the form used to get the user’s email address (for sending the password reset email). Create <strong>/templates/registration/password_reset_form.html</strong>, and give it the following contents:</p>
<figure class="highlight django"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="template-tag">{% <span class="name"><span class="name">extends</span></span> "movie_base.html" %}</span></span><br><span class="line"></span><br><span class="line"><span class="template-tag">{% <span class="name"><span class="name">block</span></span> content %}</span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">""</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></span></span><br><span class="line"><span class="xml">  </span><span class="template-tag">{% <span class="name"><span class="name">csrf_token</span></span> %}</span></span><br><span class="line"><span class="xml">  </span><span class="template-tag">{% <span class="name"><span class="name">if</span></span> form.email.errors %}</span></span><br><span class="line"><span class="xml">    </span><span class="template-variable">{{ form.email.errors }}</span></span><br><span class="line"><span class="xml">  </span><span class="template-tag">{% <span class="name"><span class="name">endif</span></span> %}</span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><span class="template-variable">{{ form.email }}</span><span class="xml"><span class="tag">&lt;/<span class="name">p</span>&gt;</span> </span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">class</span>=<span class="string">"btn btn-default btn-lg"</span> <span class="attr">value</span>=<span class="string">"Reset password"</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span></span><br><span class="line"><span class="template-tag">{% <span class="name"><span class="name">endblock</span></span> %}</span></span><br></pre></td></tr></tbody></table></figure>
<h4 id="password-reset-done"><a class="markdownIt-Anchor" href="#password-reset-done"></a> Password reset done</h4>
<p>This form is displayed after your email address has been collected. Create <strong>/templates/registration/password_reset_done.html</strong>, and give it the following contents:</p>
<figure class="highlight django"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="template-tag">{% <span class="name"><span class="name">extends</span></span> "movie_base.html" %}</span></span><br><span class="line"></span><br><span class="line"><span class="template-tag">{% <span class="name"><span class="name">block</span></span> content %}</span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>We've emailed you instructions for setting your password. If they haven't arrived in a few minutes, check your spam folder.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="template-tag">{% <span class="name"><span class="name">endblock</span></span> %}</span></span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>Note: if the email address not exists, <code>password_reset_confirm</code> will not triger.</p>
</blockquote>
<h4 id="password-reset-email"><a class="markdownIt-Anchor" href="#password-reset-email"></a> Password reset email</h4>
<p>This template provides the text of the HTML email containing the reset link that we will send to users. Create <strong>/templates/registration/password_reset_email.html</strong>, and give it the following contents:</p>
<figure class="highlight django"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml">Someone asked for password reset for email </span><span class="template-variable">{{ email }}</span><span class="xml">. Follow the link below:</span></span><br><span class="line"><span class="template-variable">{{ protocol}}</span><span class="xml">://</span><span class="template-variable">{{ domain }}</span><span class="template-tag">{% <span class="name"><span class="name">url</span></span> 'password_reset_confirm' uidb64=uid token=token %}</span></span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>The link from development would be like this:</p>
<p><a target="_blank" rel="noopener" href="http://127.0.0.1:8000/users/reset/MQ/acm8o3-a3df5d8d942f66d87b67ee393194d7f0/">http://127.0.0.1:8000/users/reset/MQ/acm8o3-a3df5d8d942f66d87b67ee393194d7f0/</a></p>
</blockquote>
<h4 id="password-reset-confirm"><a class="markdownIt-Anchor" href="#password-reset-confirm"></a> Password reset confirm</h4>
<p>This page is where you enter your new password after clicking the link in the password reset email. Create <strong>/templates/registration/password_reset_confirm.html</strong>, and give it the following contents:</p>
<figure class="highlight django"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="template-tag">{% <span class="name"><span class="name">extends</span></span> "movie_base.html" %}</span></span><br><span class="line"></span><br><span class="line"><span class="template-tag">{% <span class="name"><span class="name">block</span></span> content %}</span></span><br><span class="line"><span class="xml">    </span><span class="template-tag">{% <span class="name"><span class="name">if</span></span> validlink %}</span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>Please enter (and confirm) your new password.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">""</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></span></span><br><span class="line"><span class="xml">        </span><span class="template-tag">{% <span class="name"><span class="name">csrf_token</span></span> %}</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">table</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><span class="template-variable">{{ form.new_password1.errors }}</span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"id_new_password1"</span>&gt;</span>New password:<span class="tag">&lt;/<span class="name">label</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><span class="template-variable">{{ form.new_password1 }}</span><span class="xml"><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><span class="template-variable">{{ form.new_password2.errors }}</span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"id_new_password2"</span>&gt;</span>Confirm password:<span class="tag">&lt;/<span class="name">label</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><span class="template-variable">{{ form.new_password2 }}</span><span class="xml"><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"Change my password"</span> /&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span></span><br><span class="line"><span class="xml">    </span><span class="template-tag">{% <span class="name"><span class="name">else</span></span> %}</span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Password reset failed<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>The password reset link was invalid, possibly because it has already been used. Please request a new password reset.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml">    </span><span class="template-tag">{% <span class="name"><span class="name">endif</span></span> %}</span></span><br><span class="line"><span class="template-tag">{% <span class="name"><span class="name">endblock</span></span> %}</span></span><br></pre></td></tr></tbody></table></figure>
<h4 id="password-reset-complete"><a class="markdownIt-Anchor" href="#password-reset-complete"></a> Password reset complete</h4>
<p>This is the last password-reset template, which is displayed to notify you when the password reset has succeeded. Create <strong>/templates/registration/password_reset_complete.html</strong>, and give it the following contents:</p>
<figure class="highlight django"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="template-tag">{% <span class="name"><span class="name">extends</span></span> "movie_base.html" %}</span></span><br><span class="line"></span><br><span class="line"><span class="template-tag">{% <span class="name"><span class="name">block</span></span> content %}</span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;<span class="name">h1</span>&gt;</span>The password has been changed!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"</span></span></span><span class="template-tag">{% <span class="name"><span class="name">url</span></span> 'login' %}</span><span class="xml"><span class="tag"><span class="string">"</span>&gt;</span>log in again?<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="template-tag">{% <span class="name"><span class="name">endblock</span></span> %}</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="testing-the-new-authentication-pages"><a class="markdownIt-Anchor" href="#testing-the-new-authentication-pages"></a> Testing the new authentication pages</h3>
<p>Now that you’ve added the URL configuration and created all these templates, the authentication pages should now just work!</p>
<p>You can test the new authentication pages by attempting to log in and then log out your superuser account using these URLs:</p>
<ul>
<li><a target="_blank" rel="noopener" href="http://127.0.0.1:8000/accounts/login/">http://127.0.0.1:8000/accounts/login/</a></li>
<li><a target="_blank" rel="noopener" href="http://127.0.0.1:8000/accounts/logout/">http://127.0.0.1:8000/accounts/logout/</a></li>
</ul>
<p>You’ll be able to test the password reset functionality from the link in the login page. <strong>Be aware that Django will only send reset emails to addresses (users) that are already stored in its database!</strong></p>
<p><strong>Note</strong>: The password reset system requires that your website supports email, which is beyond the scope of this article, so this part <strong>won’t work yet</strong>. To allow testing, put the following line at the end of your <a target="_blank" rel="noopener" href="http://settings.py">settings.py</a> file. This logs any emails sent to the console (so you can copy the password reset link from the console).</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EMAIL_BACKEND = 'django.core.mail.backends.console.EmailBackend'</span><br></pre></td></tr></tbody></table></figure>
<p>For more information, see <a target="_blank" rel="noopener" href="https://docs.djangoproject.com/en/3.1/topics/email/">https://docs.djangoproject.com/en/3.1/topics/email/</a> (Django docs).</p>
<h2 id="testing-against-authenticated-users"><a class="markdownIt-Anchor" href="#testing-against-authenticated-users"></a> Testing against authenticated users</h2>
<p>This section looks at what we can do to selectively control content the user sees based on whether they are logged in or not.</p>
<h3 id="testing-in-templates"><a class="markdownIt-Anchor" href="#testing-in-templates"></a> Testing in templates</h3>
<p>You can get information about the currently logged in user in templates with the <code>{{ user }}</code>template variable (this is added to the template context by default when you set up the project as we did in our skeleton).</p>
<p>Typically you will first test against the <code>{{ user.is_authenticated }}</code> template variable to determine whether the user is eligible to see specific content. To demonstrate this, next we’ll update our sidebar to display a “Login” link if the user is logged out, and a “Logout” link if they are logged in.</p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"sidebar-nav"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">   {% if user.is_authenticated %}</span><br><span class="line">     <span class="tag">&lt;<span class="name">li</span>&gt;</span>User: {{ user.get_username }}<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"{% url 'logout'%}?next={{request.path}}"</span>&gt;</span>Logout<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span>   </span><br><span class="line">   {% else %}</span><br><span class="line">     <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"{% url 'login'%}?next={{request.path}}"</span>&gt;</span>Login<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span>   </span><br><span class="line">   {% endif %} </span><br><span class="line">  <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<p>As you can see, we use <code>if</code>-<code>else</code>-<code>endif</code> template tags to conditionally display text based on whether <code>{{ user.is_authenticated }}</code> is true. If the user is authenticated then we know that we have a valid user, so we call <code>{{ user.get_username }}</code> to display their name.</p>
<p>We create the login and logout link URLs using the <code>url</code> template tag and the names of the respective URL configurations.</p>
<p>Note also how we have appended <code>?next={{request.path}}</code>to the end of the URLs. What this does is add a URL parameter next containing the address (URL) of the <em>current</em> page, to the end of the linked URL. After the user has successfully logged in/out, the views will use this “<code>next</code>” value to redirect the user back to the page where they first clicked the login/logout link.</p>
<h3 id="testing-in-views"><a class="markdownIt-Anchor" href="#testing-in-views"></a> Testing in views</h3>
<p>If you’re using function-based views, the easiest way to restrict access to your functions is to apply the <code>login_required</code> decorator to your view function, as shown below. If the user is logged in then your view code will execute as normal.</p>
<p>If the user is not logged in, this will redirect to the login URL defined in the project settings (<code>settings.LOGIN_URL</code>), passing the current absolute path as the <code>next</code> URL parameter.</p>
<p>If the user succeeds in logging in then they will be returned back to this page, but this time authenticated.</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib.auth.decorators <span class="keyword">import</span> login_required</span><br><span class="line"></span><br><span class="line"><span class="meta">@login_required</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">my_view</span>(<span class="params">request</span>):</span></span><br><span class="line">    ...</span><br></pre></td></tr></tbody></table></figure>
<p><strong>Note:</strong> You can do the same sort of thing manually by testing on <code>request.user.is_authenticated</code>, but the decorator is much more convenient!</p>
<p>Similarly, the easiest way to restrict access to logged-in users in your class-based views is to derive from <code>LoginRequiredMixin</code>. You need to declare this mixin first in the superclass list, before the main view class.</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib.auth.mixins <span class="keyword">import</span> LoginRequiredMixin</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyView</span>(<span class="params">LoginRequiredMixin, View</span>):</span></span><br><span class="line">    ...</span><br></pre></td></tr></tbody></table></figure>
<p>This has exactly the same redirect behaviour as the <code>login_required</code> decorator. You can also specify an alternative location to redirect the user to if they are not authenticated (<code>login_url</code>), and a URL parameter name instead of “<code>next</code>” to insert the current absolute path (<code>redirect_field_name</code>).</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyView</span>(<span class="params">LoginRequiredMixin, View</span>):</span></span><br><span class="line">    login_url = <span class="string">'/login/'</span></span><br><span class="line">    redirect_field_name = <span class="string">'redirect_to'</span></span><br></pre></td></tr></tbody></table></figure>
<h2 id="example-listing-the-current-users-ratings"><a class="markdownIt-Anchor" href="#example-listing-the-current-users-ratings"></a> Example — listing the current user’s ratings</h2>
<p>Now that we know how to restrict a page to a particular user, let’s create a view of the movies that the current user has watched.</p>
<h3 id="models"><a class="markdownIt-Anchor" href="#models"></a> Models</h3>
<p>First, we’re going to create one using a <code>ForeignKey</code>  field. We also need an easy mechanism to test whether a loaned book is overdue.</p>
<p>Open <strong>movie/models.py</strong>, and import the <code>User</code> model from <code>django.contrib.auth.models</code>:</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">from django.contrib.auth.models import User</span><br></pre></td></tr></tbody></table></figure>
<p>Next, add the <code>user</code> field to the <code>Rating</code> model:</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">user = models.ForeignKey(User, on_delete=models.SET_NULL, null=True, blank=True)</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@property</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">is_valid_rating</span>(<span class="params">self</span>):</span></span><br><span class="line">    <span class="keyword">if</span> self.movie.movie_release_date <span class="keyword">and</span> datetime.date.today() &gt; self.movie.movie_release_date:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">False</span></span><br></pre></td></tr></tbody></table></figure>
<p><strong>Note</strong>: We first verify whether <code>movie_release_date</code> is empty before making a comparison. An empty <code>movie_release_date</code> field would cause Django to throw an error instead of showing the page: empty values are not comparable.</p>
<h3 id="view"><a class="markdownIt-Anchor" href="#view"></a> View</h3>
<p>Now we’ll add a view for getting the list of all movies that have been watched to the current user.</p>
<p>Add the following to movie/views.py:</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib.auth.mixins <span class="keyword">import</span> LoginRequiredMixin</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">WatchedMoviesByUserListView</span>(<span class="params">LoginRequiredMixin,generic.ListView</span>):</span></span><br><span class="line">    model = Rating</span><br><span class="line">    template_name =<span class="string">'movie/movie_ratings_by_user.html'</span></span><br><span class="line">    paginate_by = <span class="number">10</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_queryset</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> Rating.objects.filter(user=self.request.user).filter(rating_status__exact=<span class="string">'h'</span>).order_by(<span class="string">'rating_date'</span>)</span><br></pre></td></tr></tbody></table></figure>
<p>Now open <strong>/movie/urls.py</strong> and add a <code>path()</code> pointing to the above view.</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">path('mymovies/', views.WatchedMoviesByUserListView.as_view(), name='my-watched')</span><br></pre></td></tr></tbody></table></figure>
<p>Now, all we need to do for this page is add a template. First, create the template file <strong>/catalog/templates/catalog/bookinstance_list_borrowed_user.html</strong> and give it the following contents:</p>
<figure class="highlight django"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml">...</span></span><br><span class="line"><span class="template-tag">{% <span class="name"><span class="name">block</span></span> content %}</span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Watched Movies<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="xml">    </span><span class="template-tag">{% <span class="name"><span class="name">if</span></span> rating_list %}</span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="xml">      </span><span class="template-tag">{% <span class="name"><span class="name">for</span></span> r <span class="keyword">in</span> rating_list %}</span><span class="xml"> </span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"</span></span></span><span class="template-tag">{% <span class="name"><span class="name">if</span></span> not r.is_valid_rating %}</span><span class="xml"><span class="tag"><span class="string">text-danger</span></span></span><span class="template-tag">{% <span class="name"><span class="name">endif</span></span> %}</span><span class="xml"><span class="tag"><span class="string">"</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"</span></span></span><span class="template-tag">{% <span class="name"><span class="name">url</span></span> 'movie:movie-detail' r.movie.pk %}</span><span class="xml"><span class="tag"><span class="string">"</span>&gt;</span></span><span class="template-variable">{{r.movie.movie_title}}</span><span class="xml"><span class="tag">&lt;/<span class="name">a</span>&gt;</span> </span><span class="template-variable">{{r.rating_movie}}</span><span class="xml"> / (</span><span class="template-variable">{{ r.rating_date }}</span><span class="xml">)  </span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><span class="template-variable">{{r.rating_comment|custom_markdown| truncatechars_html:50 }}</span><span class="xml"><span class="tag">&lt;/<span class="name">p</span>&gt;</span>      </span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="xml">      </span><span class="template-tag">{% <span class="name"><span class="name">endfor</span></span> %}</span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="xml">    </span><span class="template-tag">{% <span class="name"><span class="name">else</span></span> %}</span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>There are no movies watched.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml">    </span><span class="template-tag">{% <span class="name"><span class="name">endif</span></span> %}</span><span class="xml"> </span></span><br><span class="line"><span class="template-tag">{% <span class="name"><span class="name">endblock</span></span> %}</span></span><br></pre></td></tr></tbody></table></figure>
<h2 id="permissions"><a class="markdownIt-Anchor" href="#permissions"></a> Permissions</h2>
<p>Permissions are associated with models and define the operations that can be performed on a model instance by a user who has the permission. By default, Django automatically gives <em>add</em>, <em>change</em>, and <em>delete</em> permissions to all models, which allow users with the permissions to perform the associated actions via the admin site. You can define your own permissions to models and grant them to specific users. You can also change the permissions associated with different instances of the same model.</p>
<p>Defining permissions is done on the model “<code>class Meta</code>” section, using the <code>permissions</code>field. You can specify as many permissions as you need in a tuple, each permission itself being defined in a nested tuple containing the permission name and permission display value.</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Rating</span>(<span class="params">models.Model</span>):</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        ...</span><br><span class="line">        permissions = ((<span class="string">"can_rating_movie"</span>, <span class="string">"can_edit_movie"</span>),)  </span><br></pre></td></tr></tbody></table></figure>
<p>We could then assign the permission to a “yourname” group in the Admin site.</p>
<p>You will need to re-run your migrations to update the database appropriately.</p>
<p>The current user’s permissions are stored in a template variable called <code>{{ perms }}</code>. You can check whether the current user has a particular permission using the specific variable name within the associated Django “app” — e.g. <code>{{ perms.catalog.can_mark_returned }}</code> will be <code>True</code> if the user has this permission, and <code>False</code> otherwise. We typically test for the permission using the template <code>{% if %}</code> tag as shown:</p>
<figure class="highlight django"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="template-tag">{% <span class="name"><span class="name">if</span></span> perms.movie.can_rating_movie %}</span></span><br><span class="line"><span class="template-tag">{% <span class="name"><span class="name">endif</span></span> %}</span></span><br></pre></td></tr></tbody></table></figure>
<p>Permissions can be tested in function view using the <code>permission_required</code> decorator or in a class-based view using the <code>PermissionRequiredMixin</code>. The pattern and behaviour are the same as for login authentication, though of course, you might reasonably have to add multiple permissions.</p>
<p>Function view decorator:</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib.auth.decorators <span class="keyword">import</span> permission_required</span><br><span class="line"></span><br><span class="line"><span class="meta">@permission_required('movie.can_rating_movie')</span></span><br><span class="line"><span class="meta">@permission_required('movie.can_edit_movie')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">my_view</span>(<span class="params">request</span>):</span></span><br><span class="line">    ...</span><br></pre></td></tr></tbody></table></figure>
<p>A permission-required mixin for class-based views.</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib.auth.mixins <span class="keyword">import</span> PermissionRequiredMixin</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyRating</span>(<span class="params">PermissionRequiredMixin, View</span>):</span></span><br><span class="line">    permission_required = <span class="string">'movie.can_rating_movie'</span></span><br><span class="line">    <span class="comment"># Or multiple permissions</span></span><br><span class="line">    permission_required = (<span class="string">'movie.can_rating_movie'</span>, <span class="string">'movie.can_edit_movie'</span>)</span><br><span class="line">    <span class="comment"># Note that 'movie.can_edit_movie' is just an example</span></span><br><span class="line">    <span class="comment"># the application doesn't have such permission!</span></span><br></pre></td></tr></tbody></table></figure>
<p><strong>Template</strong></p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">{% if perms.movie.can_rating_movie %}- <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"{% url 'movie:edit_movie_rating' movie.id %}"</span>&gt;</span>Modify<span class="tag">&lt;/<span class="name">a</span>&gt;</span>  {% endif %}</span><br></pre></td></tr></tbody></table></figure>
<h2 id="references"><a class="markdownIt-Anchor" href="#references"></a> REFERENCES</h2>
<ul>
<li><a target="_blank" rel="noopener" href="https://docs.djangoproject.com/en/3.1/topics/auth/">https://docs.djangoproject.com/en/3.1/topics/auth/</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.djangoproject.com/en/3.1/topics/auth/default//">https://docs.djangoproject.com/en/3.1/topics/auth/default//</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.djangoproject.com/en/3.1/topics/class-based-views/intro/#decorating-class-based-views">https://docs.djangoproject.com/en/3.1/topics/class-based-views/intro/#decorating-class-based-views</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.djangoproject.com/en/3.1/topics/auth/customizing/">https://docs.djangoproject.com/en/3.1/topics/auth/customizing/</a></li>
</ul>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">Joaxin</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="https://u.pinsflora.xyz/Pysnista/Django/dj_intro8_Users/">https://u.pinsflora.xyz/Pysnista/Django/dj_intro8_Users/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Django/">Django</a></div><div class="post_share"><div class="addtoany"><div class="a2a_kit a2a_kit_size_32 a2a_default_style"><a class="a2a_button_facebook"></a><a class="a2a_button_twitter"></a><a class="a2a_button_wechat"></a><a class="a2a_button_sina_weibo"></a><a class="a2a_button_facebook_messenger"></a><a class="a2a_button_email"></a><a class="a2a_button_copy_link"></a><a class="a2a_dd" target="_blank" rel="noopener" href="https://www.addtoany.com/share"></a></div></div><script async="async" src="https://static.addtoany.com/menu/page.js"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/Pysnista/Django/dj_intro5_templates/"><img class="prev-cover" src="https://cdn.jsdelivr.net/gh/joaxin/img_bed/img/cover/cover_erol-ahmed-unsplash.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">Django Introduction Part 5 - Templates</div></div></a></div><div class="next-post pull-right"><a href="/Pysnista/Django/dj_intro10_testing/"><img class="next-cover" src="https://cdn.jsdelivr.net/gh/joaxin/img_bed/img/cover/cover_writting_letter.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">Django Introduction Part10 - Testing a Django web application</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span> Related Articles</span></div><div class="relatedPosts-list"><div><a href="/Pysnista/Django/dj_FAQ/" title="Django FAQ"><img class="cover" src="https://cdn.jsdelivr.net/gh/joaxin/img_bed/img/cover/cover_grass_in_the_snow.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="fas fa-history fa-fw"></i> 2020-09-05</div><div class="title">Django FAQ</div></div></a></div><div><a href="/Pysnista/Django/dj_intro3_dbs/" title="Django Introduction Part3 - Database"><img class="cover" src="https://cdn.jsdelivr.net/gh/joaxin/img_bed/img/cover/cover_writting_letter.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="fas fa-history fa-fw"></i> 2020-09-05</div><div class="title">Django Introduction Part3 - Database</div></div></a></div><div><a href="/Pysnista/Django/dj_intro4_admin/" title="Django Introduction Part4 - Admin"><img class="cover" src="https://cdn.jsdelivr.net/gh/joaxin/img_bed/img/cover/cover_tree_dawnlights.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="fas fa-history fa-fw"></i> 2020-08-05</div><div class="title">Django Introduction Part4 - Admin</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> Comment</span></div></div><div class="comment-wrap"><div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-info-avatar is-center"><img class="avatar-img" src="https://avatars2.githubusercontent.com/u/8346164?s=460&amp;v=4" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-info__name">Joaxin</div><div class="author-info__description">When I close my eyes, I'm in my own ♡cean 🐟aves.</div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">340</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">Tags</div><div class="length-num">110</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">Categories</div><div class="length-num">34</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/joaxin"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/joaxin" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:lotility@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a><a class="social-icon" href="/atom.xml" target="_blank" title="RSS"><i class="fas fa-rss"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>Announcement</span></div><div class="announcement_content">感謝訪問本站，若喜歡請收藏 ^_^</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Catalog</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#enabling-authentication"><span class="toc-number">1.</span> <span class="toc-text"> Enabling authentication</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#creating-users-and-groups"><span class="toc-number">2.</span> <span class="toc-text"> Creating users and groups</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#setting-up-your-authentication-views"><span class="toc-number">3.</span> <span class="toc-text"> Setting up your authentication views</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#template-directory"><span class="toc-number">3.1.</span> <span class="toc-text"> Template directory</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#login-template"><span class="toc-number">3.2.</span> <span class="toc-text"> Login template</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#logout-template"><span class="toc-number">3.3.</span> <span class="toc-text"> Logout template</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#password-reset-templates"><span class="toc-number">3.4.</span> <span class="toc-text"> Password reset templates</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#password-reset-form"><span class="toc-number">3.4.1.</span> <span class="toc-text"> Password reset form</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#password-reset-done"><span class="toc-number">3.4.2.</span> <span class="toc-text"> Password reset done</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#password-reset-email"><span class="toc-number">3.4.3.</span> <span class="toc-text"> Password reset email</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#password-reset-confirm"><span class="toc-number">3.4.4.</span> <span class="toc-text"> Password reset confirm</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#password-reset-complete"><span class="toc-number">3.4.5.</span> <span class="toc-text"> Password reset complete</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#testing-the-new-authentication-pages"><span class="toc-number">3.5.</span> <span class="toc-text"> Testing the new authentication pages</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#testing-against-authenticated-users"><span class="toc-number">4.</span> <span class="toc-text"> Testing against authenticated users</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#testing-in-templates"><span class="toc-number">4.1.</span> <span class="toc-text"> Testing in templates</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#testing-in-views"><span class="toc-number">4.2.</span> <span class="toc-text"> Testing in views</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#example-listing-the-current-users-ratings"><span class="toc-number">5.</span> <span class="toc-text"> Example — listing the current user’s ratings</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#models"><span class="toc-number">5.1.</span> <span class="toc-text"> Models</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#view"><span class="toc-number">5.2.</span> <span class="toc-text"> View</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#permissions"><span class="toc-number">6.</span> <span class="toc-text"> Permissions</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#references"><span class="toc-number">7.</span> <span class="toc-text"> REFERENCES</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/Lang/es/duo_es/" title="No title"><img src="https://cdn.jsdelivr.net/gh/joaxin/img_bed/img/cover/cover_seeds.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="No title"/></a><div class="content"><a class="title" href="/Lang/es/duo_es/" title="No title">No title</a><time datetime="2020-06-29T03:44:49.224Z" title="Created 2020-06-29 11:44:49">2020-06-29</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/Lang/kl/duo_kl001_intro/" title="Klingon- Vol.1 - Introduction"><img src="https://cdn.jsdelivr.net/gh/joaxin/img_bed/img/cover/cover_little_girl_phone.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Klingon- Vol.1 - Introduction"/></a><div class="content"><a class="title" href="/Lang/kl/duo_kl001_intro/" title="Klingon- Vol.1 - Introduction">Klingon- Vol.1 - Introduction</a><time datetime="2020-06-26T16:00:00.000Z" title="Created 2020-06-27 00:00:00">2020-06-27</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/Life/apps/life_apps_android_list/" title="安卓 | 装机必备清单及习惯步骤"><img src="https://i.postimg.cc/KYPmhV8w/android-new-logo.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="安卓 | 装机必备清单及习惯步骤"/></a><div class="content"><a class="title" href="/Life/apps/life_apps_android_list/" title="安卓 | 装机必备清单及习惯步骤">安卓 | 装机必备清单及习惯步骤</a><time datetime="2020-06-20T04:29:10.462Z" title="Created 2020-06-20 12:29:10">2020-06-20</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/Pysnista/Intro/files/py_pillow/" title="Python - 操作图像"><img src="https://cdn.jsdelivr.net/gh/joaxin/img_bed/img/cover/cover_little_girl_phone.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Python - 操作图像"/></a><div class="content"><a class="title" href="/Pysnista/Intro/files/py_pillow/" title="Python - 操作图像">Python - 操作图像</a><time datetime="2020-05-02T16:00:00.000Z" title="Created 2020-05-03 00:00:00">2020-05-03</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/Pysnista/Intro/files/py_files_pdf_word/" title="Python - PDF &amp; Word"><img src="https://i.loli.net/2020/07/09/6ALoRXnITgcuvy2.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Python - PDF &amp; Word"/></a><div class="content"><a class="title" href="/Pysnista/Intro/files/py_files_pdf_word/" title="Python - PDF &amp; Word">Python - PDF &amp; Word</a><time datetime="2020-04-12T16:00:00.000Z" title="Created 2020-04-13 00:00:00">2020-04-13</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://cdn.jsdelivr.net/gh/joaxin/img_bed/img/cover/cover_forests.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2021 By Joaxin</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">Refine, the Life</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="font-plus" type="button" title="Increase font size"><i class="fas fa-plus"></i></button><button id="font-minus" type="button" title="Decrease font size"><i class="fas fa-minus"></i></button><button id="translateLink" type="button" title="Switch Between Traditional Chinese And Simplified Chinese">繁</button><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle between single-column and double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><button id="chat_btn" type="button" title="rightside.chat_btn"><i class="fas fa-sms"></i></button><a id="to_comment" href="#post-comment" title="Scroll To Comments"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="Back To Top"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">Local search</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts" type="text"/></div></div></div><hr/><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>if (document.getElementsByClassName('mermaid').length) {
  if (window.mermaidJsLoad) mermaid.init()
  else {
    getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(() => {
      window.mermaidJsLoad = true
      mermaid.initialize({
        theme: 'default',
      })
      false && mermaid.init()
    })
  }
}</script></div><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="fasle"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script>(function(i,s,o,g,r,a,m){i["DaoVoiceObject"]=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;a.charset="utf-8";m.parentNode.insertBefore(a,m)})(window,document,"script",('https:' == document.location.protocol ? 'https:' : 'http:') + "//widget.daovoice.io/widget/fae45343.js","daovoice")
</script><script>var isChatBtn = true
daovoice('init', {
  app_id: 'fae45343',},{
  launcher: { 
     disableLauncherIcon: isChatBtn // 悬浮 ICON 是否显示
  },
});
daovoice('update');

if (isChatBtn) {
  var chatBtnFn = () => {
    var chatBtn = document.getElementById("chat_btn")
    chatBtn.addEventListener("click", function(){
      daovoice('show')
    });
  }
  chatBtnFn()
} else {
  if (true) {
    function chatBtnHide () {
      daovoice('update', {},{
        launcher: { 
        disableLauncherIcon: true // 悬浮 ICON 是否显示
        },
      });
    }
    function chatBtnShow () {
      daovoice('update', {},{
        launcher: { 
        disableLauncherIcon: false // 悬浮 ICON 是否显示
        },
      });
    }
  }
}</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>