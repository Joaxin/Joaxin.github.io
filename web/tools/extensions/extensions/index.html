<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Extensions | Pinsflora</title><meta name="description" content="What are extensions? An extension adds features and functions to a browser. It’s created using familiar web-based technologies—HTML, CSS, and JavaScript. It can take advantage of the same web APIs as"><meta name="author" content="Joaxin"><meta name="copyright" content="Joaxin"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="shortcut icon" href="/img/favicon.ico"><link rel="canonical" href="https://u.pinsflora.com/web/tools/extensions/extensions/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//www.google-analytics.com" crossorigin="crossorigin"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta property="og:type" content="article"><meta property="og:title" content="Extensions"><meta property="og:url" content="https://u.pinsflora.com/web/tools/extensions/extensions/"><meta property="og:site_name" content="Pinsflora"><meta property="og:description" content="What are extensions? An extension adds features and functions to a browser. It’s created using familiar web-based technologies—HTML, CSS, and JavaScript. It can take advantage of the same web APIs as"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/joaxin/img_bed/img/cover/cover_grass_in_the_snow.jpg"><meta property="article:published_time" content="2018-10-19T16:00:00.000Z"><meta property="article:modified_time" content="2019-03-26T16:00:00.000Z"><meta name="twitter:card" content="summary"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css"><script async="async" src="https://www.googletagmanager.com/gtag/js?id=UA-177831205-1"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-177831205-1');
</script><script>var GLOBAL_CONFIG = { 
  root: '/',
  hexoversion: '5.1.1',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"We didn't find any results for the search: ${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: {"limitDay":500,"position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  bookmark: {
    message_prev: 'Press',
    message_next: 'to bookmark this page'
  },
  runtime: 'days',
  date_suffix: {"one_hour":"Just","hours":"hours ago","day":"days ago"},
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: {"bookmark":{"message_prev":"Press","message_next":"to bookmark this page"},"chs_to_cht":"Traditional Chinese Activated Manually","cht_to_chs":"Simplified Chinese Activated Manually","day_to_night":"Dark Mode Activated Manually","night_to_day":"Light Mode Activated Manually","bgLight":"#49b1f5","bgDark":"#2d3035","position":"bottom-left"},
  justifiedGallery: {
    js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
    css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
  },
  baiduPush: false,
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
};

var saveToLocal = {
  set: function setWithExpiry(key, value, ttl) {
    const now = new Date()
    const expiryDay = ttl * 86400000
    const item = {
      value: value,
      expiry: now.getTime() + expiryDay,
    }
    localStorage.setItem(key, JSON.stringify(item))
    },

  get: function getWithExpiry(key) {
    const itemStr = localStorage.getItem(key)

    if (!itemStr) {
      return undefined
    }
    const item = JSON.parse(itemStr)
    const now = new Date()

    if (now.getTime() > item.expiry) {
      localStorage.removeItem(key)
      return undefined
    }
    return item.value
  }
}</script><script id="config_change">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isSidebar: true,
  postUpdate: '2019-03-27 00:00:00'
}</script><noscript><style type="text/css">
#nav {
  opacity: 1
}
.justified-gallery img {
  opacity: 1
}
</style></noscript><script>var activateDarkMode = function () {
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null) {
    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
  }
}
var activateLightMode = function () {
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null) {
    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
  }
}

var autoChangeMode = 'false'
var t = saveToLocal.get('theme')
if (autoChangeMode === '1') {
  var isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
  var isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
  var isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined) {
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport) {
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour <= 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
    }
    window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
      if (saveToLocal.get('theme') === undefined) {
        e.matches ? activateDarkMode() : activateLightMode()
      }
    })
  } else if (t === 'light') activateLightMode()
  else activateDarkMode()
} else if (autoChangeMode === '2') {
  now = new Date()
  hour = now.getHours()
  isNight = hour <= 6 || hour >= 18
  if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode()
} else {
  if (t === 'dark') activateDarkMode()
  else if (t === 'light') activateLightMode()
}</script><meta name="generator" content="Hexo 5.1.1"><link rel="alternate" href="/atom.xml" title="Pinsflora" type="application/atom+xml">
</head><body><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="https://avatars2.githubusercontent.com/u/8346164?s=460&amp;v=4" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">Articles</div><div class="length_num">272</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">Tags</div><div class="length_num">98</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">Categories</div><div class="length_num">31</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movie</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fa fa-list"></i><span> List</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/gallery/"><i class="fa-fw fas fa-file-image-o"></i><span> Galleries</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fas fa-film"></i><span> Movie</span></a></li><li><a class="site-page" href="/games/"><i class="fa-fw fas fa-gamepad"></i><span> Games</span></a></li><li><a class="site-page" href="/tools/"><i class="fa-fw fas fa-wrench"></i><span> Tools</span></a></li></ul></div></div></div></div><div id="body-wrap"><div id="web_bg" data-type="photo"></div><div id="sidebar"><i class="fas fa-arrow-right on" id="toggle-sidebar"></i><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#what-are-extensions"><span class="toc-number">1.</span> <span class="toc-text"> What are extensions?</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#your-first-extension"><span class="toc-number">2.</span> <span class="toc-text"> Your first extension</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#writing-the-extension"><span class="toc-number">2.1.</span> <span class="toc-text"> Writing the extension</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#manifestjson"><span class="toc-number">2.1.1.</span> <span class="toc-text"> manifest.json</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#iconsborder-48png"><span class="toc-number">2.1.2.</span> <span class="toc-text"> icons&#x2F;border-48.png</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#the-toolbar-button"><span class="toc-number">2.1.3.</span> <span class="toc-text"> The toolbar button</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#the-popup"><span class="toc-number">2.1.4.</span> <span class="toc-text"> The popup</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#choose_beasthtml"><span class="toc-number">2.1.4.1.</span> <span class="toc-text"> choose_beast.html</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#choose_beastcss"><span class="toc-number">2.1.4.2.</span> <span class="toc-text"> choose_beast.css</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#choose_beastjs"><span class="toc-number">2.1.4.3.</span> <span class="toc-text"> choose_beast.js</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#the-content-script"><span class="toc-number">2.1.5.</span> <span class="toc-text"> The content script</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#borderifyjs"><span class="toc-number">2.1.6.</span> <span class="toc-text"> borderify.js</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#installing"><span class="toc-number">2.1.7.</span> <span class="toc-text"> Installing</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#manifestjson-2"><span class="toc-number">2.2.</span> <span class="toc-text"> manifest.json</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#background-scriptssection"><span class="toc-number">2.3.</span> <span class="toc-text"> Background scriptsSection</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#specifying-background-scriptssection"><span class="toc-number">2.3.1.</span> <span class="toc-text"> Specifying background scriptsSection</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#background-script-environment"><span class="toc-number">2.3.2.</span> <span class="toc-text"> Background script environment</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#dom-apis"><span class="toc-number">2.3.2.1.</span> <span class="toc-text"> DOM APIs</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#webextension-apis"><span class="toc-number">2.3.2.2.</span> <span class="toc-text"> WebExtension APIs</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#cross-origin-access"><span class="toc-number">2.3.2.3.</span> <span class="toc-text"> Cross-origin access</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#web-content"><span class="toc-number">2.3.2.4.</span> <span class="toc-text"> Web content</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#content-security-policy"><span class="toc-number">2.3.2.5.</span> <span class="toc-text"> Content security policy</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#sidebars-popups-options-pages"><span class="toc-number">2.4.</span> <span class="toc-text"> Sidebars, popups, options pages</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#extension-pages"><span class="toc-number">2.5.</span> <span class="toc-text"> Extension pages</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#content-scripts"><span class="toc-number">2.6.</span> <span class="toc-text"> Content scripts</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web-accessible-resources"><span class="toc-number">2.7.</span> <span class="toc-text"> Web accessible resources</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#developing-from-the-command-line"><span class="toc-number">2.8.</span> <span class="toc-text"> Developing from the command line</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#references"><span class="toc-number">2.8.1.</span> <span class="toc-text"> REFERENCES</span></a></li></ol></li></ol></li></ol></div></div></div><header class="post-bg" id="page-header" style="background-image: url(https://cdn.jsdelivr.net/gh/joaxin/img_bed/img/cover/cover_grass_in_the_snow.jpg)"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Pinsflora</a></span><span id="menus"><div id="search_button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> Search</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movie</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fa fa-list"></i><span> List</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/gallery/"><i class="fa-fw fas fa-file-image-o"></i><span> Galleries</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fas fa-film"></i><span> Movie</span></a></li><li><a class="site-page" href="/games/"><i class="fa-fw fas fa-gamepad"></i><span> Games</span></a></li><li><a class="site-page" href="/tools/"><i class="fa-fw fas fa-wrench"></i><span> Tools</span></a></li></ul></div></div><span class="close" id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></span></span></nav><div id="post-info"><div id="post-title"><div class="posttitle">Extensions</div></div><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2018-10-19T16:00:00.000Z" title="Created 2018-10-20 00:00:00">2018-10-20</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2019-03-26T16:00:00.000Z" title="Updated 2019-03-27 00:00:00">2019-03-27</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Web/">Web</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Web/JS/">JS</a></span></div><div class="meta-secondline"> <span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">Word count:</span><span class="word-count">4.3k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">Reading time:</span><span>27min</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post View:</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-separator">|</span><span class="post-meta-commentcount"></span></div></div></div></header><main class="layout_post" id="content-inner"><article id="post"><div class="post-content" id="article-container"><h1 id="what-are-extensions"><a class="markdownIt-Anchor" href="#what-are-extensions"></a> What are extensions?</h1>
<p>An extension adds features and functions to a browser. It’s created using familiar web-based technologies—HTML, CSS, and JavaScript. It can take advantage of the same web APIs as JavaScript on a web page, but an extension also has access to its own set of JavaScript APIs. This means that you can do a lot more in an extension than you can with code in a web page. Here are just a few examples of the things you can do:</p>
<p><strong>Enhance or complement a website</strong>: Use an add-on to deliver additional in-browser features or information from your website. Allow users to collect details from pages they visit to enhance the service you offer.</p>
<p><strong>Let users show their personality</strong>: Browser extensions can manipulate the content of web pages; for example, letting users add their favorite logo or picture as a background to every page they visit. Extensions may also enable users to update the look of the Firefox UI, the same way standalone <a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/Add-ons/Themes/Theme_concepts">theme add-ons</a> do.</p>
<p><strong>Add or remove content from web pages</strong>: You might want to help users block intrusive ads from web pages, provide access to a travel guide whenever a country or city is mentioned in a web page, or reformat page content to offer a consistent reading experience. With the ability to access and update both a page’s HTML and CSS, extensions can help users see the web the way they want to.</p>
<p><strong>Add tools and new browsing features</strong>: Add new features to a taskboard, or generate QR code images from URLs, hyperlinks, or page text. With flexible UI options and the power of the <a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/Add-ons/WebExtensions">WebExtensions APIs</a> you can easily add new features to a browser. And, you can enhance almost any website’s features or functionality, it doesn’t have to be your website.</p>
<p><strong>Games</strong>: Offer traditional computer games with off-line play features, or explore new game possibilities; for example, by incorporating gameplay into everyday browsing.</p>
<p><strong>Add development tools</strong>: You may provide web development tools as your business or have developed a useful technique or approach to web development that you want to share. Either way, you can enhance the built-in Firefox developer tools by adding a new tab to the developer toolbar.</p>
<h1 id="your-first-extension"><a class="markdownIt-Anchor" href="#your-first-extension"></a> Your first extension</h1>
<h2 id="writing-the-extension"><a class="markdownIt-Anchor" href="#writing-the-extension"></a> Writing the extension</h2>
<p>The extension adds a new button to the Firefox toolbar. When the user clicks the button, we display a popup enabling them to choose an animal. Once they choose an animal, we’ll replace the current page’s content with a picture of the chosen animal.</p>
<p>To implement this, we will:</p>
<ul>
<li>
<p>define a <a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/Browser_action">browser action</a>, which is a button attached to the Firefox toolbar</p>
<p>For the button we’ll supply:</p>
<ul>
<li>an icon, called “beasts-32.png”</li>
<li>a popup to open when the button is pressed. The popup will include HTML, CSS, and JavaScript.</li>
</ul>
</li>
<li>
<p><strong>define an icon for the extension</strong>, called “beasts-48.png”. This will be shown in the Add-ons Manager.</p>
</li>
<li>
<p><strong>write a content script, “beastify.js” that will be injected into web pages</strong>.<br />
This is the code that will actually modify the pages.</p>
</li>
<li>
<p><strong>package some images of the animals, to replace images in the web page</strong>.<br />
We’ll make the images “web accessible resources” so the web page can refer to them.</p>
</li>
</ul>
<p>It’s a simple extension, but shows many of the basic concepts of the WebExtensions API:</p>
<ul>
<li>adding a button to the toolbar</li>
<li>defining a popup panel using HTML, CSS, and JavaScript</li>
<li>injecting content scripts into web pages</li>
<li>communicating between content scripts and the rest of the extension</li>
<li>packaging resources with your extension that can be used by web pages</li>
</ul>
<p>Create a new directory and navigate to it. For example, in your command line/terminal you could do it like this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir beastify</span><br><span class="line"><span class="built_in">cd</span> beastify</span><br></pre></td></tr></table></figure>
<h3 id="manifestjson"><a class="markdownIt-Anchor" href="#manifestjson"></a> manifest.json</h3>
<p>Now create a new file called <code>manifest.json</code> directly under the <code>borderify</code>directory. Give it the following contents:</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">  <span class="attr">&quot;description&quot;</span>: <span class="string">&quot;Adds a browser action icon to the toolbar. Click the button to choose a beast. The active tab&#x27;s body content is then replaced with a picture of the chosen beast. See https://developer.mozilla.org/en-US/Add-ons/WebExtensions/Examples#beastify&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;manifest_version&quot;</span>: <span class="number">2</span>,</span><br><span class="line">  <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;Beastify&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;version&quot;</span>: <span class="string">&quot;1.0&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;homepage_url&quot;</span>: <span class="string">&quot;https://github.com/mdn/webextensions-examples/tree/master/beastify&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;icons&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;48&quot;</span>: <span class="string">&quot;icons/beasts-48.png&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="attr">&quot;permissions&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;activeTab&quot;</span></span><br><span class="line">  ],</span><br><span class="line"></span><br><span class="line">  <span class="attr">&quot;browser_action&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;default_icon&quot;</span>: <span class="string">&quot;icons/beasts-32.png&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;theme_icons&quot;</span>: [&#123;</span><br><span class="line">        <span class="attr">&quot;light&quot;</span>: <span class="string">&quot;icons/beasts-32-light.png&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;dark&quot;</span>: <span class="string">&quot;icons/beasts-32.png&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;size&quot;</span>: <span class="number">32</span></span><br><span class="line">    &#125;],</span><br><span class="line">    <span class="attr">&quot;default_title&quot;</span>: <span class="string">&quot;Beastify&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;default_popup&quot;</span>: <span class="string">&quot;popup/choose_beast.html&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="attr">&quot;web_accessible_resources&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;beasts/frog.jpg&quot;</span>,</span><br><span class="line">    <span class="string">&quot;beasts/turtle.jpg&quot;</span>,</span><br><span class="line">    <span class="string">&quot;beasts/snake.jpg&quot;</span></span><br><span class="line">  ]</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>
<p>The first three keys: <code>manifest_version</code>, <code>name</code>, and <code>version</code>, are mandatory and contain basic metadata for the extension.</p>
</li>
<li>
<p><code>description</code> and <code>homepage_url</code> are optional, but recommended: they provide useful information about the extension.</p>
</li>
<li>
<p><code>icons</code> is optional, but recommended: it allows you to specify an icon for the extension, that will be shown in the Add-ons Manager.</p>
</li>
<li>
<p><code>permissions</code> lists permissions the extension needs. We’re just asking for the <a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/Add-ons/WebExtensions/manifest.json/permissions#activeTab_permission"><code>activeTab</code> permission</a> here.</p>
</li>
<li>
<pre class="highlight"><code class="">browser_action
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">   </span><br><span class="line"></span><br><span class="line">  specifies the toolbar button. We&#39;re supplying three pieces of information here:</span><br><span class="line"></span><br><span class="line">  - &#96;default_icon&#96; is mandatory, and points to the icon for the button</span><br><span class="line">  - &#96;default_title&#96; is optional, and will be shown in a tooltip</span><br><span class="line">  - &#96;default_popup&#96; is used if you want a popup to be shown when the user clicks the button. We do, so we&#39;ve included this key and made it point to an HTML file included with the extension.</span><br><span class="line"></span><br><span class="line">- &#96;web_accessible_resources&#96; lists files that we want to make accessible to web pages. Since the extension replaces the content in the page with images we&#39;ve packaged with the extension, we need to make these images accessible to the page.</span><br><span class="line"></span><br><span class="line">The most interesting key here is &#96;content_scripts&#96;, which tells Firefox to load a script into Web pages whose URL matches a specific pattern. In this case, we&#39;re asking Firefox to load a script called &quot;borderify.js&quot; into all HTTP or HTTPS pages served from &quot;mozilla.org&quot; or any of its subdomains.</span><br><span class="line"></span><br><span class="line">- [Learn more about content scripts.](https:&#x2F;&#x2F;developer.mozilla.org&#x2F;en-US&#x2F;Add-ons&#x2F;WebExtensions&#x2F;Content_scripts)</span><br><span class="line">- [Learn more about match patterns](https:&#x2F;&#x2F;developer.mozilla.org&#x2F;en-US&#x2F;Add-ons&#x2F;WebExtensions&#x2F;Match_patterns).</span><br><span class="line"></span><br><span class="line">[In some situations you need to specify an ID for your extension](https:&#x2F;&#x2F;developer.mozilla.org&#x2F;en-US&#x2F;Add-ons&#x2F;WebExtensions&#x2F;WebExtensions_and_the_Add-on_ID#When_do_you_need_an_Add-on_ID). If you do need to specify an add-on ID, include the  &#96;applications&#96; key in &#96;manifest.json&#96; and set its &#96;gecko.id&#96;property:</span><br><span class="line"></span><br><span class="line">&#96;&#96;&#96;json</span><br><span class="line">&quot;applications&quot;: &#123;</span><br><span class="line">  &quot;gecko&quot;: &#123;</span><br><span class="line">    &quot;id&quot;: &quot;borderify@example.com&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</code></pre>
</li>
</ul>
<h3 id="iconsborder-48png"><a class="markdownIt-Anchor" href="#iconsborder-48png"></a> icons/border-48.png</h3>
<p><a target="_blank" rel="noopener" href="https://www.iconfinder.com/iconsets/free-retina-icon-set">https://www.iconfinder.com/iconsets/free-retina-icon-set</a></p>
<p>The extension should have an icon. This will be shown next to the extension’s listing in the Add-ons Manager (you can open this by visiting the URL “about:addons”). Our manifest.json promised that we would have an icon for the toolbar at “icons/beasts-48.png”.</p>
<p>Create the “icons” directory directly under the “borderify” directory. Save an icon there named “border-48.png”.  You could use <a target="_blank" rel="noopener" href="https://github.com/mdn/webextensions-examples/blob/master/borderify/icons/border-48.png">the one from our example</a>, which is taken from the Google Material Design iconset, and is used under the terms of the <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-sa/3.0/">Creative Commons Attribution-ShareAlike</a> license.</p>
<p>If you choose to supply your own icon, It should be 48x48 pixels. You could also supply a 96x96 pixel icon, for high-resolution displays, and if you do this it will be specified as the <code>96</code>property of the <code>icons</code> object in manifest.json:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&quot;icons&quot;: &#123;</span><br><span class="line">  &quot;48&quot;: &quot;icons/beasts-48.png&quot;,</span><br><span class="line">  &quot;96&quot;: &quot;icons/beasts-96.png&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Alternatively, you could supply an SVG file here, and it will be scaled correctly. (Though: if you’re using SVG and your icon includes text, you may want to use your SVG editor’s “convert to path” tool to flatten the text, so that it scales with a consistent size/position.)</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/Add-ons/WebExtensions/manifest.json/icons">Learn more about specifying icons.</a></li>
</ul>
<h3 id="the-toolbar-button"><a class="markdownIt-Anchor" href="#the-toolbar-button"></a> The toolbar button</h3>
<p>The toolbar button also needs an icon, and our manifest.json promised that we would have an icon for the toolbar at “icons/beasts-32.png”.</p>
<p>Save an icon named “beasts-32.png” in the “icons” directory. You could use <a target="_blank" rel="noopener" href="https://github.com/mdn/webextensions-examples/raw/master/beastify/icons/beasts-32.png">the one from our example</a>, which is taken from the <a target="_blank" rel="noopener" href="http://www.iconbeast.com/free">IconBeast Lite icon set</a> and used under the terms of its <a target="_blank" rel="noopener" href="http://www.iconbeast.com/faq/">license</a>.</p>
<p>If you don’t supply a popup, then a click event is dispatched to your extension when the user clicks the button. If you do supply a popup, the click event is not dispatched, but instead, the popup is opened. We want a popup, so let’s create that next.</p>
<h3 id="the-popup"><a class="markdownIt-Anchor" href="#the-popup"></a> The popup</h3>
<p>The function of the popup is to enable the user to choose one of three beasts.</p>
<p>Create a new directory called “popup” under the extension root. This is where we’ll keep the code for the popup. The popup will consist of three files:</p>
<ul>
<li><strong>choose_beast.html</strong> defines the content of the panel</li>
<li><strong>choose_beast.css</strong> styles the content</li>
<li><strong>choose_beast.js</strong> handles the user’s choice by running a content script in the active tab</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir popup </span><br><span class="line"><span class="built_in">cd</span> popup</span><br><span class="line">touch choose_beast.html choose_beast.css choose_beast.js</span><br></pre></td></tr></table></figure>
<h4 id="choose_beasthtml"><a class="markdownIt-Anchor" href="#choose_beasthtml"></a> choose_beast.html</h4>
<p>The HTML file looks like this:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;choose_beast.css&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;popup-content&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;button beast&quot;</span>&gt;</span>Frog<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;button beast&quot;</span>&gt;</span>Turtle<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;button beast&quot;</span>&gt;</span>Snake<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;button reset&quot;</span>&gt;</span>Reset<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;error-content&quot;</span> <span class="attr">class</span>=<span class="string">&quot;hidden&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>Can&#x27;t beastify this web page.<span class="tag">&lt;/<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">p</span>&gt;</span>Try a different page.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;choose_beast.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>We have a <code>&lt;div&gt;</code> element with an ID of <code>&quot;popup-content&quot;</code> that contains an element for each animal choice. We have another <code>&lt;div&gt;</code> with an ID of <code>&quot;error-content&quot;</code> and a class <code>&quot;hidden&quot;</code>. We’ll use that in case there’s a problem initializing the popup.</p>
<p>Note that we include the CSS and JS files from this file, just like a web page.</p>
<h4 id="choose_beastcss"><a class="markdownIt-Anchor" href="#choose_beastcss"></a> choose_beast.css</h4>
<p>The CSS fixes the size of the popup, ensures that the three choices fill the space, and gives them some basic styling. It also hides elements with <code>class=&quot;hidden&quot;</code>: this means that our <code>&quot;error-content&quot;</code> <code>&lt;div&gt;</code> will be hidden by default.</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">html</span>, <span class="selector-tag">body</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.hidden</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: none;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.button</span> &#123;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">3%</span> auto;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">4px</span>;</span><br><span class="line">  <span class="attribute">text-align</span>: center;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">1.5em</span>;</span><br><span class="line">  <span class="attribute">cursor</span>: pointer;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.beast</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#CFF2F2</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.beast</span> &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#E5F2F2</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.reset</span> &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#FBFBC9</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.reset</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#EAEA9D</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="choose_beastjs"><a class="markdownIt-Anchor" href="#choose_beastjs"></a> choose_beast.js</h4>
<p>Here’s the JavaScript for the popup:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * CSS to hide everything on the page,</span></span><br><span class="line"><span class="comment"> * except for elements that have the &quot;beastify-image&quot; class.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> hidePage = <span class="string">`body &gt; :not(.beastify-image) &#123;</span></span><br><span class="line"><span class="string">                    display: none;</span></span><br><span class="line"><span class="string">                  &#125;`</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Listen for clicks on the buttons, and send the appropriate message to</span></span><br><span class="line"><span class="comment"> * the content script in the page.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">listenForClicks</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">document</span>.addEventListener(<span class="string">&quot;click&quot;</span>, <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Given the name of a beast, get the URL to the corresponding image.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">beastNameToURL</span>(<span class="params">beastName</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">switch</span> (beastName) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;Frog&quot;</span>:</span><br><span class="line">          <span class="keyword">return</span> browser.extension.getURL(<span class="string">&quot;beasts/frog.jpg&quot;</span>);</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;Snake&quot;</span>:</span><br><span class="line">          <span class="keyword">return</span> browser.extension.getURL(<span class="string">&quot;beasts/snake.jpg&quot;</span>);</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;Turtle&quot;</span>:</span><br><span class="line">          <span class="keyword">return</span> browser.extension.getURL(<span class="string">&quot;beasts/turtle.jpg&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Insert the page-hiding CSS into the active tab,</span></span><br><span class="line"><span class="comment">     * then get the beast URL and</span></span><br><span class="line"><span class="comment">     * send a &quot;beastify&quot; message to the content script in the active tab.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">beastify</span>(<span class="params">tabs</span>) </span>&#123;</span><br><span class="line">      browser.tabs.insertCSS(&#123;<span class="attr">code</span>: hidePage&#125;).then(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> url = beastNameToURL(e.target.textContent);</span><br><span class="line">        browser.tabs.sendMessage(tabs[<span class="number">0</span>].id, &#123;</span><br><span class="line">          command: <span class="string">&quot;beastify&quot;</span>,</span><br><span class="line">          beastURL: url</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Remove the page-hiding CSS from the active tab,</span></span><br><span class="line"><span class="comment">     * send a &quot;reset&quot; message to the content script in the active tab.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">reset</span>(<span class="params">tabs</span>) </span>&#123;</span><br><span class="line">      browser.tabs.removeCSS(&#123;<span class="attr">code</span>: hidePage&#125;).then(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        browser.tabs.sendMessage(tabs[<span class="number">0</span>].id, &#123;</span><br><span class="line">          command: <span class="string">&quot;reset&quot;</span>,</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Just log the error to the console.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">reportError</span>(<span class="params">error</span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.error(<span class="string">`Could not beastify: <span class="subst">$&#123;error&#125;</span>`</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Get the active tab,</span></span><br><span class="line"><span class="comment">     * then call &quot;beastify()&quot; or &quot;reset()&quot; as appropriate.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">if</span> (e.target.classList.contains(<span class="string">&quot;beast&quot;</span>)) &#123;</span><br><span class="line">      browser.tabs.query(&#123;<span class="attr">active</span>: <span class="literal">true</span>, <span class="attr">currentWindow</span>: <span class="literal">true</span>&#125;)</span><br><span class="line">        .then(beastify)</span><br><span class="line">        .catch(reportError);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (e.target.classList.contains(<span class="string">&quot;reset&quot;</span>)) &#123;</span><br><span class="line">      browser.tabs.query(&#123;<span class="attr">active</span>: <span class="literal">true</span>, <span class="attr">currentWindow</span>: <span class="literal">true</span>&#125;)</span><br><span class="line">        .then(reset)</span><br><span class="line">        .catch(reportError);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * There was an error executing the script.</span></span><br><span class="line"><span class="comment"> * Display the popup&#x27;s error message, and hide the normal UI.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">reportExecuteScriptError</span>(<span class="params">error</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">document</span>.querySelector(<span class="string">&quot;#popup-content&quot;</span>).classList.add(<span class="string">&quot;hidden&quot;</span>);</span><br><span class="line">  <span class="built_in">document</span>.querySelector(<span class="string">&quot;#error-content&quot;</span>).classList.remove(<span class="string">&quot;hidden&quot;</span>);</span><br><span class="line">  <span class="built_in">console</span>.error(<span class="string">`Failed to execute beastify content script: <span class="subst">$&#123;error.message&#125;</span>`</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * When the popup loads, inject a content script into the active tab,</span></span><br><span class="line"><span class="comment"> * and add a click handler.</span></span><br><span class="line"><span class="comment"> * If we couldn&#x27;t inject the script, handle the error.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">browser.tabs.executeScript(&#123;<span class="attr">file</span>: <span class="string">&quot;/content_scripts/beastify.js&quot;</span>&#125;)</span><br><span class="line">.then(listenForClicks)</span><br><span class="line">.catch(reportExecuteScriptError);</span><br></pre></td></tr></table></figure>
<p>The place to start here is line 96. The popup script executes a content script in the active tab as soon as the popup is loaded, using the <code>browser.tabs.executeScript()</code> API. If executing the content script is successful, then the content script will stay loaded in the page until the tab is closed or the user navigates to a different page.</p>
<p>A common reason the <code>browser.tabs.executeScript()</code> call might fail is that you can’t execute content scripts in all pages. For example, you can’t execute them in privileged browser pages like about:debugging, and you can’t execute them on pages in the <a target="_blank" rel="noopener" href="https://addons.mozilla.org/">addons.mozilla.org</a>domain. If it does fail, <code>reportExecuteScriptError()</code> will hide the <code>&quot;popup-content&quot;</code> <code>&lt;div&gt;</code>, show the <code>&quot;error-content&quot;</code> <code>&lt;div&gt;</code>, and log an error to the <a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/Add-ons/WebExtensions/Debugging">console</a>.</p>
<p>If executing the content script is successful, we call <code>listenForClicks()</code>. This listens for clicks on the popup.</p>
<ul>
<li>If the click was on a button with <code>class=&quot;beast&quot;</code>, then we call <code>beastify()</code>.</li>
<li>If the click was on a button with <code>class=&quot;reset&quot;</code>, then we call <code>reset()</code>.</li>
</ul>
<p>The <code>beastify()</code> function does three things:</p>
<ul>
<li>map the button clicked to a URL pointing to an image of a particular beast</li>
<li>hide the page’s whole content by injecting some CSS, using the <code>browser.tabs.insertCSS()</code> API</li>
<li>send a “beastify” message to the content script using the <code>browser.tabs.sendMessage()</code> API, asking it to beastify the page, and passing it the URL to the beast image.</li>
</ul>
<p>The <code>reset()</code> function essentially undoes a beastify:</p>
<ul>
<li>remove the CSS we added, using the <code>browser.tabs.removeCSS()</code> API</li>
<li>send a “reset” message to the content script asking it to reset the page.</li>
</ul>
<h3 id="the-content-script"><a class="markdownIt-Anchor" href="#the-content-script"></a> The content script</h3>
<p>Create a new directory, under the extension root, called “content_scripts” and create a new file in it called “beastify.js”, with the following contents:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Check and set a global guard variable.</span></span><br><span class="line"><span class="comment">   * If this content script is injected into the same page again,</span></span><br><span class="line"><span class="comment">   * it will do nothing next time.</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">window</span>.hasRun) &#123;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">window</span>.hasRun = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Given a URL to a beast image, remove all existing beasts, then</span></span><br><span class="line"><span class="comment">   * create and style an IMG node pointing to</span></span><br><span class="line"><span class="comment">   * that image, then insert the node into the document.</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">insertBeast</span>(<span class="params">beastURL</span>) </span>&#123;</span><br><span class="line">    removeExistingBeasts();</span><br><span class="line">    <span class="keyword">let</span> beastImage = <span class="built_in">document</span>.createElement(<span class="string">&quot;img&quot;</span>);</span><br><span class="line">    beastImage.setAttribute(<span class="string">&quot;src&quot;</span>, beastURL);</span><br><span class="line">    beastImage.style.height = <span class="string">&quot;100vh&quot;</span>;</span><br><span class="line">    beastImage.className = <span class="string">&quot;beastify-image&quot;</span>;</span><br><span class="line">    <span class="built_in">document</span>.body.appendChild(beastImage);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Remove every beast from the page.</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">removeExistingBeasts</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> existingBeasts = <span class="built_in">document</span>.querySelectorAll(<span class="string">&quot;.beastify-image&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> beast <span class="keyword">of</span> existingBeasts) &#123;</span><br><span class="line">      beast.remove();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Listen for messages from the background script.</span></span><br><span class="line"><span class="comment">   * Call &quot;beastify()&quot; or &quot;reset()&quot;.</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  browser.runtime.onMessage.addListener(<span class="function">(<span class="params">message</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (message.command === <span class="string">&quot;beastify&quot;</span>) &#123;</span><br><span class="line">      insertBeast(message.beastURL);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (message.command === <span class="string">&quot;reset&quot;</span>) &#123;</span><br><span class="line">      removeExistingBeasts();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>
<p>The first thing the content script does is to check for a global variable <code>window.hasRun</code>: if it’s set the script returns early, otherwise it sets <code>window.hasRun</code> and continues. The reason we do this is that every time the user opens the popup, the popup executes a content script in the active tab, so we could have multiple instances of the script running in a single tab. If this happens, we need to make sure that only the first instance is actually going to do anything.</p>
<p>After that, the place to start is line 40, where the content script listens for messages from the popup, using the <code>browser.runtime.onMessage</code> API. We saw above that the popup script can send two different sorts of messages: “beastify” and “reset”.</p>
<ul>
<li>if the message is “beastify”, we expect it to contain a URL pointing to a beast image. We remove any beasts that might have been added by previous “beastify” calls, then construct and append an <code>&lt;img&gt;</code> element whose <code>src</code> attribute is set to the beast URL.</li>
<li>if the message is “reset”, we just remove any beasts that might have been added.</li>
</ul>
<h3 id="borderifyjs"><a class="markdownIt-Anchor" href="#borderifyjs"></a> borderify.js</h3>
<p>Finally, create a file called “borderify.js” directly under the “borderify” directory. Give it this content:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">document</span>.body.style.border = <span class="string">&quot;5px solid red&quot;</span>;</span><br></pre></td></tr></table></figure>
<p>This script will be loaded into the pages that match the pattern given in the <code>content_scripts</code>manifest.json key. The script has direct access to the document, just like scripts loaded by the page itself.</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/Add-ons/WebExtensions/Content_scripts">Learn more about content scripts.</a></li>
</ul>
<h3 id="installing"><a class="markdownIt-Anchor" href="#installing"></a> Installing</h3>
<p>Open <code>about:debugging#addons</code> in Firefox, click “Load Temporary Add-on” and select any file in your extension’s directory.</p>
<p>The extension will now be installed, and will stay until you restart Firefox.</p>
<p>Alternatively, you can run the extension from the command line using the <a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/Getting_started_with_web-ext">web-ext</a> tool.</p>
<p>Try experimenting a bit. Edit the content script to change the color of the border, or do something else to the page content. Save the content script, then reload the extensions’s files by clicking the “Reload” button in about:debugging. You can see the changes right away:</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/Add-ons/WebExtensions/Temporary_Installation_in_Firefox">Learn more about loading extensions</a></li>
</ul>
<h2 id="manifestjson-2"><a class="markdownIt-Anchor" href="#manifestjson-2"></a> manifest.json</h2>
<p>This is the only file that must be present in every extension. It contains basic metadata such as its name, version and the permissions it requires. It also provides pointers to other files in the extension.</p>
<p>This manifest can also contain pointers to several other types of files:</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/Anatomy_of_a_WebExtension#Background_scripts">Background scripts</a>: Implement long-running logic.</li>
<li>Icons for the extension and any buttons it might define.</li>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/Anatomy_of_a_WebExtension#Sidebars_popups_options_pages">Sidebars, popups, and options pages</a>: HTML documents that provide content for various user interface components.</li>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/Anatomy_of_a_WebExtension#Content_scripts">Content scripts</a>: JavaScript included with your extension, that you will inject into web pages.</li>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/Anatomy_of_a_WebExtension#Web_accessible_resources">Web-accessible resources</a>: Make packaged content accessible to web pages and content scripts.</li>
</ul>
<p><img src="https://mdn.mozillademos.org/files/13669/webextension-anatomy.png" alt="img" /></p>
<p>See the <a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json">manifest.json</a> reference page for all the details.</p>
<p>Along with those already listed in the manifest, an extension may also include additional <a target="_blank" rel="noopener" href="https://mdn.mozillademos.org/files/11553/browser-action.png">Extension pages</a> and supporting files.</p>
<h2 id="background-scriptssection"><a class="markdownIt-Anchor" href="#background-scriptssection"></a> Background scripts<a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/Anatomy_of_a_WebExtension#Background_scripts">Section</a></h2>
<p>Extensions often need to maintain long-term state or perform long-term operations independently of the lifetime of any particular web page or browser window. That is what background scripts are for.</p>
<p>Background scripts are loaded as soon as the extension is loaded and stay loaded until the extension is disabled or uninstalled. You can use any of the <a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/Add-ons/WebExtensions/API">WebExtension APIs</a> in the script, as long as you have requested the necessary <a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/permissions">permissions</a>.</p>
<h3 id="specifying-background-scriptssection"><a class="markdownIt-Anchor" href="#specifying-background-scriptssection"></a> Specifying background scripts<a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/Anatomy_of_a_WebExtension#Specifying_background_scripts">Section</a></h3>
<p>You can include a background script using the <code>background</code> key in “manifest.json”:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// manifest.json</span></span><br><span class="line"></span><br><span class="line">&quot;background&quot;: &#123;</span><br><span class="line">  &quot;scripts&quot;: [&quot;background-script.js&quot;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>You can specify multiple background scripts: if you do, they run in the same context, just like multiple scripts that are loaded into a single web page.</p>
<p>Instead of specifying background scripts, you can specify a background page which has the added advantage of supporting ES6 modules:</p>
<p><strong>manifest.json</strong></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// manifest.json</span></span><br><span class="line"></span><br><span class="line">&quot;background&quot;: &#123;</span><br><span class="line">  &quot;page&quot;: &quot;background-page.html&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>background-page.html</strong></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;module&quot;</span> <span class="attr">src</span>=<span class="string">&quot;background-script.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="background-script-environment"><a class="markdownIt-Anchor" href="#background-script-environment"></a> Background script environment</h3>
<h4 id="dom-apis"><a class="markdownIt-Anchor" href="#dom-apis"></a> DOM APIs</h4>
<p>Background scripts run in the context of a special page called a background page. This gives them a <code>window</code> global, along with all the standard DOM APIs provided by that object.</p>
<p>In Firefox, background pages do not support the use of <code>alert()</code>, <code>confirm()</code>, or <code>prompt()</code>.</p>
<h4 id="webextension-apis"><a class="markdownIt-Anchor" href="#webextension-apis"></a> WebExtension APIs</h4>
<p>Background scripts can use any of the <a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/Add-ons/WebExtensions/API">WebExtension APIs</a> in the script, as long as their extension has the necessary <a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/permissions">permissions</a>.</p>
<h4 id="cross-origin-access"><a class="markdownIt-Anchor" href="#cross-origin-access"></a> Cross-origin access</h4>
<p>Background scripts can make XHR requests to any hosts for which they have <a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/permissions">host permissions</a>.</p>
<h4 id="web-content"><a class="markdownIt-Anchor" href="#web-content"></a> Web content</h4>
<p>Background scripts do not get direct access to web pages. However, they can load <a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/Content_scripts">content scripts</a> into web pages and can <a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/Add-ons/WebExtensions/Content_scripts#Communicating_with_background_scripts">communicate with these content scripts using a message-passing API</a>.</p>
<h4 id="content-security-policy"><a class="markdownIt-Anchor" href="#content-security-policy"></a> Content security policy</h4>
<p>Background scripts are restricted from certain potentially dangerous operations, like the use of <code>eval()</code>, through a Content Security Policy. See <a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/Content_Security_Policy">Content Security Policy</a> for more details on this.</p>
<h2 id="sidebars-popups-options-pages"><a class="markdownIt-Anchor" href="#sidebars-popups-options-pages"></a> Sidebars, popups, options pages</h2>
<p>Your extension can include various user interface components whose content is defined using an HTML document:</p>
<ul>
<li>a <a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/user_interface/Sidebars">sidebar</a> is a pane that is displayed at the left-hand side of the browser window, next to the web page</li>
<li>a <a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/user_interface/Popups">popup</a> is a dialog that you can display when the user clicks on a <a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/user_interface/Browser_action">toolbar button</a> or <a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/user_interface/Page_actions">address bar button</a></li>
<li>an <a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/user_interface/Options_pages">options page</a> is a page that’s shown when the user accesses your add-on’s preferences in the browser’s native add-ons manager.</li>
</ul>
<p>For each of these components, you create an HTML file and point to it using a specific property in <a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json">manifest.json</a>. The HTML file can include CSS and JavaScript files, just like a normal web page.</p>
<p>All of these are a type of <a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/user_interface/Extension_pages">Extension pages</a>, and unlike a normal web page, your JavaScript can use all the same privileged WebExtension APIs as your background script. They can even directly access variables in the background page using <a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/runtime/getBackgroundPage"><code>runtime.getBackgroundPage()</code></a>.</p>
<h2 id="extension-pages"><a class="markdownIt-Anchor" href="#extension-pages"></a> Extension pages</h2>
<p>You can also include HTML documents in your extension which are not attached to some predefined user interface component. Unlike the documents you might provide for sidebars, popups, or options pages, these don’t have an entry in manifest.json. However, they do also get access to all the same privileged WebExtension APIs as your background script.</p>
<p>You’d typically load a page like this using <a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/windows/create"><code>windows.create()</code></a> or <a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs/create"><code>tabs.create()</code></a>.</p>
<p>See <a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/user_interface/Extension_pages">Extension pages</a> to learn more.</p>
<h2 id="content-scripts"><a class="markdownIt-Anchor" href="#content-scripts"></a> Content scripts</h2>
<p>Use content scripts to access and manipulate web pages. Content scripts are loaded into web pages and run in the context of that particular page.</p>
<p>Content scripts are extension-provided scripts which run in the context of a web page; this differs from scripts which are loaded by the page itself, including those which are provided in <a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/script">``</a> elements within the page.</p>
<p>Content scripts can see and manipulate the page’s DOM, just like normal scripts loaded by the page.</p>
<p>Unlike normal page scripts, they can:</p>
<ul>
<li>Make cross-domain XHR requests.</li>
<li>Use a small subset of the <a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API">WebExtension APIs</a>.</li>
<li>Exchange messages with their background scripts and can in this way indirectly access all the WebExtension APIs.</li>
</ul>
<p>Content scripts cannot directly access normal page scripts but can exchange messages with them using the standard <code>window.postMessage()</code> API.</p>
<p>Usually, when we talk about content scripts, we are referring to JavaScript, but you can inject CSS into web pages using the same mechanism.</p>
<p>See the <a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/Content_scripts">content scripts</a> article to learn more.</p>
<h2 id="web-accessible-resources"><a class="markdownIt-Anchor" href="#web-accessible-resources"></a> Web accessible resources</h2>
<p>Web accessible resources are resources such as images, HTML, CSS, and JavaScript that you include in the extension and want to make accessible to content scripts and page scripts. Resources which are made web-accessible can be referenced by page scripts and content scripts using a special URI scheme.</p>
<p>For example, if a content script wants to insert some images into web pages, you could include them in the extension and make them web accessible. Then the content script could create and append <code>img</code> tags which reference the images via the <code>src</code> attribute.</p>
<p>To learn more, see the documentation for the <a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/web_accessible_resources">web_accessible_resources</a> manifest.json key.</p>
<h2 id="developing-from-the-command-line"><a class="markdownIt-Anchor" href="#developing-from-the-command-line"></a> Developing from the command line</h2>
<p>You can automate the temporary installation step by using the <a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/Add-ons/WebExtensions/Getting_started_with_web-ext">web-ext</a> tool. Try this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> beastify</span><br><span class="line">web-ext run</span><br></pre></td></tr></table></figure>
<h3 id="references"><a class="markdownIt-Anchor" href="#references"></a> REFERENCES</h3>
<ul>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions">https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions</a></li>
<li><a target="_blank" rel="noopener" href="https://developer.chrome.com/extensions">https://developer.chrome.com/extensions</a></li>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/Porting_a_Google_Chrome_extension">Porting a Google Chrome extension</a></li>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/Publishing_your_WebExtension">“Publishing your extension”</a></li>
</ul>
</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">Joaxin</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="https://u.pinsflora.com/web/tools/extensions/extensions/">https://u.pinsflora.com/web/tools/extensions/extensions/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="addtoany"><div class="a2a_kit a2a_kit_size_32 a2a_default_style"><a class="a2a_button_facebook"></a><a class="a2a_button_twitter"></a><a class="a2a_button_wechat"></a><a class="a2a_button_sina_weibo"></a><a class="a2a_button_facebook_messenger"></a><a class="a2a_button_email"></a><a class="a2a_button_copy_link"></a><a class="a2a_dd" target="_blank" rel="noopener" href="https://www.addtoany.com/share"></a></div></div><script async="async" src="https://static.addtoany.com/menu/page.js"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/web/tools/web_tools/"><img class="prev-cover" src="https://cdn.jsdelivr.net/gh/joaxin/img_bed/img/cover/cover_grass_in_the_snow.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">web前端插件</div></div></a></div><div class="next-post pull-right"><a href="/notes/sys/win_folder_notes/"><img class="next-cover" src="https://wx3.sinaimg.cn/mw1024/7afad494ly1ggtnjkmsl1g207301aaaj.gif" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">Windows 系统目录解析</div></div></a></div></nav><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> Comment</span></div></div><div class="comment-wrap"><div></div></div></div></article></main><footer id="footer" style="background-image: url(https://cdn.jsdelivr.net/gh/joaxin/img_bed/img/cover/cover_grass_in_the_snow.jpg)" data-type="photo"><div id="footer-wrap"><div class="copyright">&copy;2020 By Joaxin</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">Refine, the Life</div></div></footer></div><section id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="Switch Between Traditional Chinese And Simplified Chinese">繁</button><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="fas fa-adjust"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog"></i></button><a id="to_comment" href="#post-comment" title="Scroll To Comments"><i class="fas fa-comments"></i></a><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><button id="chat_btn" type="button" title="rightside.chat_btn"><i class="fas fa-sms"></i></button><button id="go-up" type="button" title="Back To Top"><i class="fas fa-arrow-up"></i></button></div></section><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">Local search</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts" type="text"/></div></div></div><hr/><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>Powered by</span> <a target="_blank" rel="noopener" href="https://github.com/wzpan/hexo-generator-search" style="color:#49B1F5;">hexo-generator-search</a></div></div></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div><div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>if (document.getElementsByClassName('mermaid').length) {
  if (window.mermaidJsLoad) mermaid.init()
  else {
    $.getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js', function () {
      window.mermaidJsLoad = true
      mermaid.initialize({
        theme: 'default',
      })
      false && mermaid.init()
    })
  }
}</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><script defer="defer" id="ribbon" src="/js/third-party/canvas-ribbon.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="fasle"></script><script src="/js/third-party/activate-power-mode.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
document.body.addEventListener('input', POWERMODE);
</script><script>(function(i,s,o,g,r,a,m){i["DaoVoiceObject"]=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;a.charset="utf-8";m.parentNode.insertBefore(a,m)})(window,document,"script",('https:' == document.location.protocol ? 'https:' : 'http:') + "//widget.daovoice.io/widget/fae45343.js","daovoice")
</script><script>var isChatBtn = true
daovoice('init', {
  app_id: 'fae45343',},{
  launcher: { 
     disableLauncherIcon: isChatBtn // 悬浮 ICON 是否显示
  },
});
daovoice('update');

if (isChatBtn) {
  var chatBtnFn = () => {
    var chatBtn = document.getElementById("chat_btn")
    chatBtn.addEventListener("click", function(){
      daovoice('show')
    });
  }
  chatBtnFn()
} else {
  if (true) {
    function chatBtnHide () {
      daovoice('update', {},{
        launcher: { 
        disableLauncherIcon: true // 悬浮 ICON 是否显示
        },
      });
    }
    function chatBtnShow () {
      daovoice('update', {},{
        launcher: { 
        disableLauncherIcon: false // 悬浮 ICON 是否显示
        },
      });
    }
  }
}</script></div></body></html>